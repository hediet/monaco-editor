import*as errors from"./errors.js";import*as platform from"./platform.js";import{URI}from"./uri.js";export var Schemas;!function(e){e.inMemory="inmemory",e.vscode="vscode",e.internal="private",e.walkThrough="walkThrough",e.walkThroughSnippet="walkThroughSnippet",e.http="http",e.https="https",e.file="file",e.mailto="mailto",e.untitled="untitled",e.data="data",e.command="command",e.vscodeRemote="vscode-remote",e.vscodeRemoteResource="vscode-remote-resource",e.vscodeUserData="vscode-userdata",e.vscodeCustomEditor="vscode-custom-editor",e.vscodeNotebookCell="vscode-notebook-cell",e.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",e.vscodeNotebookCellOutput="vscode-notebook-cell-output",e.vscodeInteractive="vscode-interactive",e.vscodeInteractiveInput="vscode-interactive-input",e.vscodeSettings="vscode-settings",e.vscodeWorkspaceTrust="vscode-workspace-trust",e.vscodeTerminal="vscode-terminal",e.webviewPanel="webview-panel",e.vscodeWebview="vscode-webview",e.extension="extension",e.vscodeFileResource="vscode-file",e.tmp="tmp",e.vsls="vsls",e.vscodeSourceControl="vscode-scm"}(Schemas||(Schemas={}));export const connectionTokenQueryName="tkn";class RemoteAuthoritiesImpl{constructor(){this._hosts=Object.create(null),this._ports=Object.create(null),this._connectionTokens=Object.create(null),this._preferredWebSchema="http",this._delegate=null,this._remoteResourcesPath=`/${Schemas.vscodeRemoteResource}`}setPreferredWebSchema(e){this._preferredWebSchema=e}rewrite(e){if(this._delegate)try{return this._delegate(e)}catch(o){return errors.onUnexpectedError(o),e}const o=e.authority;let t=this._hosts[o];t&&-1!==t.indexOf(":")&&-1===t.indexOf("[")&&(t=`[${t}]`);const s=this._ports[o],r=this._connectionTokens[o];let c=`path=${encodeURIComponent(e.path)}`;return"string"==typeof r&&(c+=`&tkn=${encodeURIComponent(r)}`),URI.from({scheme:platform.isWeb?this._preferredWebSchema:Schemas.vscodeRemoteResource,authority:`${t}:${s}`,path:this._remoteResourcesPath,query:c})}}export const RemoteAuthorities=new RemoteAuthoritiesImpl;class FileAccessImpl{uriToBrowserUri(e){return e.scheme===Schemas.vscodeRemote?RemoteAuthorities.rewrite(e):e.scheme===Schemas.file&&(platform.isNative||platform.isWebWorker&&platform.globals.origin===`${Schemas.vscodeFileResource}://${FileAccessImpl.FALLBACK_AUTHORITY}`)?e.with({scheme:Schemas.vscodeFileResource,authority:e.authority||FileAccessImpl.FALLBACK_AUTHORITY,query:null,fragment:null}):e}}FileAccessImpl.FALLBACK_AUTHORITY="vscode-app";export const FileAccess=new FileAccessImpl;export var COI;!function(e){const o=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);e.CoopAndCoep=Object.freeze(o.get("3"));const t="vscode-coi";e.getHeadersFromQuery=function(e){let s;"string"==typeof e?s=new URL(e).searchParams:e instanceof URL?s=e.searchParams:URI.isUri(e)&&(s=new URL(e.toString(!0)).searchParams);const r=null==s?void 0:s.get(t);if(r)return o.get(r)},e.addSearchParam=function(e,o,s){if(!globalThis.crossOriginIsolated)return;const r=o&&s?"3":s?"2":"1";e instanceof URLSearchParams?e.set(t,r):e["vscode-coi"]=r}}(COI||(COI={}));