import{illegalArgument}from"./errors.js";import{escapeIcons}from"./iconLabels.js";import{escapeRegExpCharacters}from"./strings.js";export class MarkdownString{constructor(e="",t=!1){var s,r,n;if(this.value=e,"string"!=typeof this.value)throw illegalArgument("value");"boolean"==typeof t?(this.isTrusted=t,this.supportThemeIcons=!1,this.supportHtml=!1):(this.isTrusted=null!==(s=t.isTrusted)&&void 0!==s?s:void 0,this.supportThemeIcons=null!==(r=t.supportThemeIcons)&&void 0!==r&&r,this.supportHtml=null!==(n=t.supportHtml)&&void 0!==n&&n)}appendText(e,t=0){return this.value+=escapeMarkdownSyntaxTokens(this.supportThemeIcons?escapeIcons(e):e).replace(/([ \t]+)/g,((e,t)=>"&nbsp;".repeat(t.length))).replace(/\>/gm,"\\>").replace(/\n/g,1===t?"\\\n":"\n\n"),this}appendMarkdown(e){return this.value+=e,this}appendCodeblock(e,t){return this.value+="\n```",this.value+=e,this.value+="\n",this.value+=t,this.value+="\n```\n",this}appendLink(e,t,s){return this.value+="[",this.value+=this._escape(t,"]"),this.value+="](",this.value+=this._escape(String(e),")"),s&&(this.value+=` "${this._escape(this._escape(s,'"'),")")}"`),this.value+=")",this}_escape(e,t){const s=new RegExp(escapeRegExpCharacters(t),"g");return e.replace(s,((t,s)=>"\\"!==e.charAt(s-1)?`\\${t}`:t))}}export function isEmptyMarkdownString(e){return isMarkdownString(e)?!e.value:!Array.isArray(e)||e.every(isEmptyMarkdownString)}export function isMarkdownString(e){return e instanceof MarkdownString||!(!e||"object"!=typeof e)&&!("string"!=typeof e.value||"boolean"!=typeof e.isTrusted&&void 0!==e.isTrusted||"boolean"!=typeof e.supportThemeIcons&&void 0!==e.supportThemeIcons)}export function escapeMarkdownSyntaxTokens(e){return e.replace(/[\\`*_{}[\]()#+\-!~]/g,"\\$&")}export function escapeDoubleQuotes(e){return e.replace(/"/g,"&quot;")}export function removeMarkdownEscapes(e){return e?e.replace(/\\([\\`*_{}[\]()#+\-.!~])/g,"$1"):e}export function parseHrefAndDimensions(e){const t=[],s=e.split("|").map((e=>e.trim()));e=s[0];const r=s[1];if(r){const e=/height=(\d+)/.exec(r),s=/width=(\d+)/.exec(r),n=e?e[1]:"",i=s?s[1]:"",o=isFinite(parseInt(i)),p=isFinite(parseInt(n));o&&t.push(`width="${i}"`),p&&t.push(`height="${n}"`)}return{href:e,dimensions:t}}