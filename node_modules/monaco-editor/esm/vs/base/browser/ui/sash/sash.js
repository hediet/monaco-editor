var __decorate=this&&this.__decorate||function(t,e,s,o){var i,a=arguments.length,r=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,s,o);else for(var n=t.length-1;n>=0;n--)(i=t[n])&&(r=(a<3?i(r):a>3?i(e,s,r):i(e,s))||r);return a>3&&r&&Object.defineProperty(e,s,r),r};import{$,append,createStyleSheet,EventHelper}from"../../dom.js";import{DomEmitter}from"../../event.js";import{EventType,Gesture}from"../../touch.js";import{Delayer}from"../../../common/async.js";import{memoize}from"../../../common/decorators.js";import{Emitter}from"../../../common/event.js";import{Disposable,DisposableStore,toDisposable}from"../../../common/lifecycle.js";import{isMacintosh}from"../../../common/platform.js";import"./sash.css";const DEBUG=!1;export var OrthogonalEdge;!function(t){t.North="north",t.South="south",t.East="east",t.West="west"}(OrthogonalEdge||(OrthogonalEdge={}));let globalSize=4;const onDidChangeGlobalSize=new Emitter;let globalHoverDelay=300;const onDidChangeHoverDelay=new Emitter;class MouseEventFactory{constructor(){this.disposables=new DisposableStore}get onPointerMove(){return this.disposables.add(new DomEmitter(window,"mousemove")).event}get onPointerUp(){return this.disposables.add(new DomEmitter(window,"mouseup")).event}dispose(){this.disposables.dispose()}}__decorate([memoize],MouseEventFactory.prototype,"onPointerMove",null),__decorate([memoize],MouseEventFactory.prototype,"onPointerUp",null);class GestureEventFactory{get onPointerMove(){return this.disposables.add(new DomEmitter(this.el,EventType.Change)).event}get onPointerUp(){return this.disposables.add(new DomEmitter(this.el,EventType.End)).event}constructor(t){this.el=t,this.disposables=new DisposableStore}dispose(){this.disposables.dispose()}}__decorate([memoize],GestureEventFactory.prototype,"onPointerMove",null),__decorate([memoize],GestureEventFactory.prototype,"onPointerUp",null);class OrthogonalPointerEventFactory{get onPointerMove(){return this.factory.onPointerMove}get onPointerUp(){return this.factory.onPointerUp}constructor(t){this.factory=t}dispose(){}}__decorate([memoize],OrthogonalPointerEventFactory.prototype,"onPointerMove",null),__decorate([memoize],OrthogonalPointerEventFactory.prototype,"onPointerUp",null);const PointerEventsDisabledCssClass="pointer-events-disabled";export class Sash extends Disposable{get state(){return this._state}get orthogonalStartSash(){return this._orthogonalStartSash}get orthogonalEndSash(){return this._orthogonalEndSash}set state(t){this._state!==t&&(this.el.classList.toggle("disabled",0===t),this.el.classList.toggle("minimum",1===t),this.el.classList.toggle("maximum",2===t),this._state=t,this.onDidEnablementChange.fire(t))}set orthogonalStartSash(t){if(this.orthogonalStartDragHandleDisposables.clear(),this.orthogonalStartSashDisposables.clear(),t){const e=e=>{this.orthogonalStartDragHandleDisposables.clear(),0!==e&&(this._orthogonalStartDragHandle=append(this.el,$(".orthogonal-drag-handle.start")),this.orthogonalStartDragHandleDisposables.add(toDisposable((()=>this._orthogonalStartDragHandle.remove()))),this.orthogonalStartDragHandleDisposables.add(new DomEmitter(this._orthogonalStartDragHandle,"mouseenter")).event((()=>Sash.onMouseEnter(t)),void 0,this.orthogonalStartDragHandleDisposables),this.orthogonalStartDragHandleDisposables.add(new DomEmitter(this._orthogonalStartDragHandle,"mouseleave")).event((()=>Sash.onMouseLeave(t)),void 0,this.orthogonalStartDragHandleDisposables))};this.orthogonalStartSashDisposables.add(t.onDidEnablementChange.event(e,this)),e(t.state)}this._orthogonalStartSash=t}set orthogonalEndSash(t){if(this.orthogonalEndDragHandleDisposables.clear(),this.orthogonalEndSashDisposables.clear(),t){const e=e=>{this.orthogonalEndDragHandleDisposables.clear(),0!==e&&(this._orthogonalEndDragHandle=append(this.el,$(".orthogonal-drag-handle.end")),this.orthogonalEndDragHandleDisposables.add(toDisposable((()=>this._orthogonalEndDragHandle.remove()))),this.orthogonalEndDragHandleDisposables.add(new DomEmitter(this._orthogonalEndDragHandle,"mouseenter")).event((()=>Sash.onMouseEnter(t)),void 0,this.orthogonalEndDragHandleDisposables),this.orthogonalEndDragHandleDisposables.add(new DomEmitter(this._orthogonalEndDragHandle,"mouseleave")).event((()=>Sash.onMouseLeave(t)),void 0,this.orthogonalEndDragHandleDisposables))};this.orthogonalEndSashDisposables.add(t.onDidEnablementChange.event(e,this)),e(t.state)}this._orthogonalEndSash=t}constructor(t,e,s){super(),this.hoverDelay=globalHoverDelay,this.hoverDelayer=this._register(new Delayer(this.hoverDelay)),this._state=3,this.onDidEnablementChange=this._register(new Emitter),this._onDidStart=this._register(new Emitter),this._onDidChange=this._register(new Emitter),this._onDidReset=this._register(new Emitter),this._onDidEnd=this._register(new Emitter),this.orthogonalStartSashDisposables=this._register(new DisposableStore),this.orthogonalStartDragHandleDisposables=this._register(new DisposableStore),this.orthogonalEndSashDisposables=this._register(new DisposableStore),this.orthogonalEndDragHandleDisposables=this._register(new DisposableStore),this.onDidStart=this._onDidStart.event,this.onDidChange=this._onDidChange.event,this.onDidReset=this._onDidReset.event,this.onDidEnd=this._onDidEnd.event,this.linkedSash=void 0,this.el=append(t,$(".monaco-sash")),s.orthogonalEdge&&this.el.classList.add(`orthogonal-edge-${s.orthogonalEdge}`),isMacintosh&&this.el.classList.add("mac");const o=this._register(new DomEmitter(this.el,"mousedown")).event;this._register(o((t=>this.onPointerStart(t,new MouseEventFactory)),this));const i=this._register(new DomEmitter(this.el,"dblclick")).event;this._register(i(this.onPointerDoublePress,this));const a=this._register(new DomEmitter(this.el,"mouseenter")).event;this._register(a((()=>Sash.onMouseEnter(this))));const r=this._register(new DomEmitter(this.el,"mouseleave")).event;this._register(r((()=>Sash.onMouseLeave(this)))),this._register(Gesture.addTarget(this.el));const n=this._register(new DomEmitter(this.el,EventType.Start)).event;this._register(n((t=>this.onPointerStart(t,new GestureEventFactory(this.el))),this));const h=this._register(new DomEmitter(this.el,EventType.Tap)).event;let l;this._register(h((t=>{if(l)return clearTimeout(l),l=void 0,void this.onPointerDoublePress(t);clearTimeout(l),l=setTimeout((()=>l=void 0),250)}),this)),"number"==typeof s.size?(this.size=s.size,0===s.orientation?this.el.style.width=`${this.size}px`:this.el.style.height=`${this.size}px`):(this.size=globalSize,this._register(onDidChangeGlobalSize.event((t=>{this.size=t,this.layout()})))),this._register(onDidChangeHoverDelay.event((t=>this.hoverDelay=t))),this.layoutProvider=e,this.orthogonalStartSash=s.orthogonalStartSash,this.orthogonalEndSash=s.orthogonalEndSash,this.orientation=s.orientation||0,1===this.orientation?(this.el.classList.add("horizontal"),this.el.classList.remove("vertical")):(this.el.classList.remove("horizontal"),this.el.classList.add("vertical")),this.el.classList.toggle("debug",!1),this.layout()}onPointerStart(t,e){EventHelper.stop(t);let s=!1;if(!t.__orthogonalSashEvent){const o=this.getOrthogonalSash(t);o&&(s=!0,t.__orthogonalSashEvent=!0,o.onPointerStart(t,new OrthogonalPointerEventFactory(e)))}if(this.linkedSash&&!t.__linkedSashEvent&&(t.__linkedSashEvent=!0,this.linkedSash.onPointerStart(t,new OrthogonalPointerEventFactory(e))),!this.state)return;const o=document.getElementsByTagName("iframe");for(const t of o)t.classList.add("pointer-events-disabled");const i=t.pageX,a=t.pageY,r=t.altKey,n={startX:i,currentX:i,startY:a,currentY:a,altKey:r};this.el.classList.add("active"),this._onDidStart.fire(n);const h=createStyleSheet(this.el),l=()=>{let t="";t=s?"all-scroll":1===this.orientation?1===this.state?"s-resize":2===this.state?"n-resize":isMacintosh?"row-resize":"ns-resize":1===this.state?"e-resize":2===this.state?"w-resize":isMacintosh?"col-resize":"ew-resize",h.textContent=`* { cursor: ${t} !important; }`},d=new DisposableStore;l(),s||this.onDidEnablementChange.event(l,null,d),e.onPointerMove((t=>{EventHelper.stop(t,!1);const e={startX:i,currentX:t.pageX,startY:a,currentY:t.pageY,altKey:r};this._onDidChange.fire(e)}),null,d),e.onPointerUp((t=>{EventHelper.stop(t,!1),this.el.removeChild(h),this.el.classList.remove("active"),this._onDidEnd.fire(),d.dispose();for(const t of o)t.classList.remove("pointer-events-disabled")}),null,d),d.add(e)}onPointerDoublePress(t){const e=this.getOrthogonalSash(t);e&&e._onDidReset.fire(),this.linkedSash&&this.linkedSash._onDidReset.fire(),this._onDidReset.fire()}static onMouseEnter(t,e=!1){t.el.classList.contains("active")?(t.hoverDelayer.cancel(),t.el.classList.add("hover")):t.hoverDelayer.trigger((()=>t.el.classList.add("hover")),t.hoverDelay).then(void 0,(()=>{})),!e&&t.linkedSash&&Sash.onMouseEnter(t.linkedSash,!0)}static onMouseLeave(t,e=!1){t.hoverDelayer.cancel(),t.el.classList.remove("hover"),!e&&t.linkedSash&&Sash.onMouseLeave(t.linkedSash,!0)}clearSashHoverState(){Sash.onMouseLeave(this)}layout(){if(0===this.orientation){const t=this.layoutProvider;this.el.style.left=t.getVerticalSashLeft(this)-this.size/2+"px",t.getVerticalSashTop&&(this.el.style.top=t.getVerticalSashTop(this)+"px"),t.getVerticalSashHeight&&(this.el.style.height=t.getVerticalSashHeight(this)+"px")}else{const t=this.layoutProvider;this.el.style.top=t.getHorizontalSashTop(this)-this.size/2+"px",t.getHorizontalSashLeft&&(this.el.style.left=t.getHorizontalSashLeft(this)+"px"),t.getHorizontalSashWidth&&(this.el.style.width=t.getHorizontalSashWidth(this)+"px")}}getOrthogonalSash(t){var e;const s=null!==(e=t.initialTarget)&&void 0!==e?e:t.target;if(s&&s instanceof HTMLElement)return s.classList.contains("orthogonal-drag-handle")?s.classList.contains("start")?this.orthogonalStartSash:this.orthogonalEndSash:void 0}dispose(){super.dispose(),this.el.remove()}}