var TypeNavigationControllerState,__decorate=this&&this.__decorate||function(e,t,o,i){var s,n=arguments.length,r=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,i);else for(var l=e.length-1;l>=0;l--)(s=e[l])&&(r=(n<3?s(r):n>3?s(t,o,r):s(t,o))||r);return n>3&&r&&Object.defineProperty(t,o,r),r},__awaiter=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(s,n){function r(e){try{a(i.next(e))}catch(e){n(e)}}function l(e){try{a(i.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,l)}a((i=i.apply(e,t||[])).next())}))};import{asCssValueWithDefault,createStyleSheet,EventHelper}from"../../dom.js";import{DomEmitter}from"../../event.js";import{StandardKeyboardEvent}from"../../keyboardEvent.js";import{Gesture}from"../../touch.js";import{alert}from"../aria/aria.js";import{CombinedSpliceable}from"./splice.js";import{binarySearch,firstOrDefault,range}from"../../../common/arrays.js";import{timeout}from"../../../common/async.js";import{Color}from"../../../common/color.js";import{memoize}from"../../../common/decorators.js";import{Emitter,Event,EventBufferer}from"../../../common/event.js";import{matchesPrefix}from"../../../common/filters.js";import{DisposableStore,dispose}from"../../../common/lifecycle.js";import{clamp}from"../../../common/numbers.js";import*as platform from"../../../common/platform.js";import{isNumber}from"../../../common/types.js";import"./list.css";import{ListError}from"./list.js";import{ListView}from"./listView.js";class TraitRenderer{constructor(e){this.trait=e,this.renderedElements=[]}get templateId(){return`template:${this.trait.name}`}renderTemplate(e){return e}renderElement(e,t,o){const i=this.renderedElements.findIndex((e=>e.templateData===o));if(i>=0){const e=this.renderedElements[i];this.trait.unrender(o),e.index=t}else{const e={index:t,templateData:o};this.renderedElements.push(e)}this.trait.renderIndex(t,o)}splice(e,t,o){const i=[];for(const s of this.renderedElements)s.index<e?i.push(s):s.index>=e+t&&i.push({index:s.index+o-t,templateData:s.templateData});this.renderedElements=i}renderIndexes(e){for(const{index:t,templateData:o}of this.renderedElements)e.indexOf(t)>-1&&this.trait.renderIndex(t,o)}disposeTemplate(e){const t=this.renderedElements.findIndex((t=>t.templateData===e));t<0||this.renderedElements.splice(t,1)}}class Trait{get name(){return this._trait}get renderer(){return new TraitRenderer(this)}constructor(e){this._trait=e,this.length=0,this.indexes=[],this.sortedIndexes=[],this._onChange=new Emitter,this.onChange=this._onChange.event}splice(e,t,o){var i;t=Math.max(0,Math.min(t,this.length-e));const s=o.length-t,n=e+t,r=[...this.sortedIndexes.filter((t=>t<e)),...o.map(((t,o)=>t?o+e:-1)).filter((e=>-1!==e)),...this.sortedIndexes.filter((e=>e>=n)).map((e=>e+s))],l=this.length+s;if(this.sortedIndexes.length>0&&0===r.length&&l>0){const t=null!==(i=this.sortedIndexes.find((t=>t>=e)))&&void 0!==i?i:l-1;r.push(Math.min(t,l-1))}this.renderer.splice(e,t,o.length),this._set(r,r),this.length=l}renderIndex(e,t){t.classList.toggle(this._trait,this.contains(e))}unrender(e){e.classList.remove(this._trait)}set(e,t){return this._set(e,[...e].sort(numericSort),t)}_set(e,t,o){const i=this.indexes,s=this.sortedIndexes;this.indexes=e,this.sortedIndexes=t;const n=disjunction(s,e);return this.renderer.renderIndexes(n),this._onChange.fire({indexes:e,browserEvent:o}),i}get(){return this.indexes}contains(e){return binarySearch(this.sortedIndexes,e,numericSort)>=0}dispose(){dispose(this._onChange)}}__decorate([memoize],Trait.prototype,"renderer",null);class SelectionTrait extends Trait{constructor(e){super("selected"),this.setAriaSelected=e}renderIndex(e,t){super.renderIndex(e,t),this.setAriaSelected&&(this.contains(e)?t.setAttribute("aria-selected","true"):t.setAttribute("aria-selected","false"))}}class TraitSpliceable{constructor(e,t,o){this.trait=e,this.view=t,this.identityProvider=o}splice(e,t,o){if(!this.identityProvider)return this.trait.splice(e,t,o.map((()=>!1)));const i=this.trait.get().map((e=>this.identityProvider.getId(this.view.element(e)).toString())),s=o.map((e=>i.indexOf(this.identityProvider.getId(e).toString())>-1));this.trait.splice(e,t,s)}}export function isInputElement(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName}export function isMonacoEditor(e){return!!e.classList.contains("monaco-editor")||!e.classList.contains("monaco-list")&&!!e.parentElement&&isMonacoEditor(e.parentElement)}export function isButton(e){return!!("A"===e.tagName&&e.classList.contains("monaco-button")||"DIV"===e.tagName&&e.classList.contains("monaco-button-dropdown"))||!e.classList.contains("monaco-list")&&!!e.parentElement&&isButton(e.parentElement)}class KeyboardController{get onKeyDown(){return this.disposables.add(Event.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event).filter((e=>!isInputElement(e.target))).map((e=>new StandardKeyboardEvent(e))))}constructor(e,t,o){this.list=e,this.view=t,this.disposables=new DisposableStore,this.multipleSelectionDisposables=new DisposableStore,this.onKeyDown.filter((e=>3===e.keyCode)).on(this.onEnter,this,this.disposables),this.onKeyDown.filter((e=>16===e.keyCode)).on(this.onUpArrow,this,this.disposables),this.onKeyDown.filter((e=>18===e.keyCode)).on(this.onDownArrow,this,this.disposables),this.onKeyDown.filter((e=>11===e.keyCode)).on(this.onPageUpArrow,this,this.disposables),this.onKeyDown.filter((e=>12===e.keyCode)).on(this.onPageDownArrow,this,this.disposables),this.onKeyDown.filter((e=>9===e.keyCode)).on(this.onEscape,this,this.disposables),!1!==o.multipleSelectionSupport&&this.onKeyDown.filter((e=>(platform.isMacintosh?e.metaKey:e.ctrlKey)&&31===e.keyCode)).on(this.onCtrlA,this,this.multipleSelectionDisposables)}updateOptions(e){void 0!==e.multipleSelectionSupport&&(this.multipleSelectionDisposables.clear(),e.multipleSelectionSupport&&this.onKeyDown.filter((e=>(platform.isMacintosh?e.metaKey:e.ctrlKey)&&31===e.keyCode)).on(this.onCtrlA,this,this.multipleSelectionDisposables))}onEnter(e){e.preventDefault(),e.stopPropagation(),this.list.setSelection(this.list.getFocus(),e.browserEvent)}onUpArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusPrevious(1,!1,e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onDownArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusNext(1,!1,e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onPageUpArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusPreviousPage(e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onPageDownArrow(e){e.preventDefault(),e.stopPropagation(),this.list.focusNextPage(e.browserEvent);const t=this.list.getFocus()[0];this.list.setAnchor(t),this.list.reveal(t),this.view.domNode.focus()}onCtrlA(e){e.preventDefault(),e.stopPropagation(),this.list.setSelection(range(this.list.length),e.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus()}onEscape(e){this.list.getSelection().length&&(e.preventDefault(),e.stopPropagation(),this.list.setSelection([],e.browserEvent),this.list.setAnchor(void 0),this.view.domNode.focus())}dispose(){this.disposables.dispose(),this.multipleSelectionDisposables.dispose()}}__decorate([memoize],KeyboardController.prototype,"onKeyDown",null);export var TypeNavigationMode;!function(e){e[e.Automatic=0]="Automatic",e[e.Trigger=1]="Trigger"}(TypeNavigationMode||(TypeNavigationMode={})),function(e){e[e.Idle=0]="Idle",e[e.Typing=1]="Typing"}(TypeNavigationControllerState||(TypeNavigationControllerState={}));export const DefaultKeyboardNavigationDelegate=new class{mightProducePrintableCharacter(e){return!(e.ctrlKey||e.metaKey||e.altKey)&&(e.keyCode>=31&&e.keyCode<=56||e.keyCode>=21&&e.keyCode<=30||e.keyCode>=93&&e.keyCode<=102||e.keyCode>=80&&e.keyCode<=90)}};class TypeNavigationController{constructor(e,t,o,i,s){this.list=e,this.view=t,this.keyboardNavigationLabelProvider=o,this.keyboardNavigationEventFilter=i,this.delegate=s,this.enabled=!1,this.state=TypeNavigationControllerState.Idle,this.mode=TypeNavigationMode.Automatic,this.triggered=!1,this.previouslyFocused=-1,this.enabledDisposables=new DisposableStore,this.disposables=new DisposableStore,this.updateOptions(e.options)}updateOptions(e){var t,o;null===(t=e.typeNavigationEnabled)||void 0===t||t?this.enable():this.disable(),this.mode=null!==(o=e.typeNavigationMode)&&void 0!==o?o:TypeNavigationMode.Automatic}enable(){if(this.enabled)return;let e=!1;const t=this.enabledDisposables.add(Event.chain(this.enabledDisposables.add(new DomEmitter(this.view.domNode,"keydown")).event)).filter((e=>!isInputElement(e.target))).filter((()=>this.mode===TypeNavigationMode.Automatic||this.triggered)).map((e=>new StandardKeyboardEvent(e))).filter((t=>e||this.keyboardNavigationEventFilter(t))).filter((e=>this.delegate.mightProducePrintableCharacter(e))).forEach((e=>EventHelper.stop(e,!0))).map((e=>e.browserEvent.key)).event,o=Event.debounce(t,(()=>null),800,void 0,void 0,this.enabledDisposables);Event.reduce(Event.any(t,o),((e,t)=>null===t?null:(e||"")+t),void 0,this.enabledDisposables)(this.onInput,this,this.enabledDisposables),o(this.onClear,this,this.enabledDisposables),t((()=>e=!0),void 0,this.enabledDisposables),o((()=>e=!1),void 0,this.enabledDisposables),this.enabled=!0,this.triggered=!1}disable(){this.enabled&&(this.enabledDisposables.clear(),this.enabled=!1,this.triggered=!1)}onClear(){var e;const t=this.list.getFocus();if(t.length>0&&t[0]===this.previouslyFocused){const o=null===(e=this.list.options.accessibilityProvider)||void 0===e?void 0:e.getAriaLabel(this.list.element(t[0]));o&&alert(o)}this.previouslyFocused=-1}onInput(e){if(!e)return this.state=TypeNavigationControllerState.Idle,void(this.triggered=!1);const t=this.list.getFocus(),o=t.length>0?t[0]:0,i=this.state===TypeNavigationControllerState.Idle?1:0;this.state=TypeNavigationControllerState.Typing;for(let t=0;t<this.list.length;t++){const s=(o+t+i)%this.list.length,n=this.keyboardNavigationLabelProvider.getKeyboardNavigationLabel(this.view.element(s)),r=n&&n.toString();if(void 0===r||matchesPrefix(e,r))return this.previouslyFocused=o,this.list.setFocus([s]),void this.list.reveal(s)}}dispose(){this.disable(),this.enabledDisposables.dispose(),this.disposables.dispose()}}class DOMFocusController{constructor(e,t){this.list=e,this.view=t,this.disposables=new DisposableStore,this.disposables.add(Event.chain(this.disposables.add(new DomEmitter(t.domNode,"keydown")).event)).filter((e=>!isInputElement(e.target))).map((e=>new StandardKeyboardEvent(e))).filter((e=>!(2!==e.keyCode||e.ctrlKey||e.metaKey||e.shiftKey||e.altKey))).on(this.onTab,this,this.disposables)}onTab(e){if(e.target!==this.view.domNode)return;const t=this.list.getFocus();if(0===t.length)return;const o=this.view.domElement(t[0]);if(!o)return;const i=o.querySelector("[tabIndex]");if(!(i&&i instanceof HTMLElement&&-1!==i.tabIndex))return;const s=window.getComputedStyle(i);"hidden"!==s.visibility&&"none"!==s.display&&(e.preventDefault(),e.stopPropagation(),i.focus())}dispose(){this.disposables.dispose()}}export function isSelectionSingleChangeEvent(e){return platform.isMacintosh?e.browserEvent.metaKey:e.browserEvent.ctrlKey}export function isSelectionRangeChangeEvent(e){return e.browserEvent.shiftKey}function isMouseRightClick(e){return e instanceof MouseEvent&&2===e.button}const DefaultMultipleSelectionController={isSelectionSingleChangeEvent,isSelectionRangeChangeEvent};export class MouseController{constructor(e){this.list=e,this.disposables=new DisposableStore,this._onPointer=new Emitter,this.onPointer=this._onPointer.event,!1!==e.options.multipleSelectionSupport&&(this.multipleSelectionController=this.list.options.multipleSelectionController||DefaultMultipleSelectionController),this.mouseSupport=void 0===e.options.mouseSupport||!!e.options.mouseSupport,this.mouseSupport&&(e.onMouseDown(this.onMouseDown,this,this.disposables),e.onContextMenu(this.onContextMenu,this,this.disposables),e.onMouseDblClick(this.onDoubleClick,this,this.disposables),e.onTouchStart(this.onMouseDown,this,this.disposables),this.disposables.add(Gesture.addTarget(e.getHTMLElement()))),Event.any(e.onMouseClick,e.onMouseMiddleClick,e.onTap)(this.onViewPointer,this,this.disposables)}updateOptions(e){void 0!==e.multipleSelectionSupport&&(this.multipleSelectionController=void 0,e.multipleSelectionSupport&&(this.multipleSelectionController=this.list.options.multipleSelectionController||DefaultMultipleSelectionController))}isSelectionSingleChangeEvent(e){return!!this.multipleSelectionController&&this.multipleSelectionController.isSelectionSingleChangeEvent(e)}isSelectionRangeChangeEvent(e){return!!this.multipleSelectionController&&this.multipleSelectionController.isSelectionRangeChangeEvent(e)}isSelectionChangeEvent(e){return this.isSelectionSingleChangeEvent(e)||this.isSelectionRangeChangeEvent(e)}onMouseDown(e){isMonacoEditor(e.browserEvent.target)||document.activeElement!==e.browserEvent.target&&this.list.domFocus()}onContextMenu(e){if(isInputElement(e.browserEvent.target)||isMonacoEditor(e.browserEvent.target))return;const t=void 0===e.index?[]:[e.index];this.list.setFocus(t,e.browserEvent)}onViewPointer(e){if(!this.mouseSupport)return;if(isInputElement(e.browserEvent.target)||isMonacoEditor(e.browserEvent.target))return;const t=e.index;return void 0===t?(this.list.setFocus([],e.browserEvent),this.list.setSelection([],e.browserEvent),void this.list.setAnchor(void 0)):this.isSelectionRangeChangeEvent(e)||this.isSelectionChangeEvent(e)?this.changeSelection(e):(this.list.setFocus([t],e.browserEvent),this.list.setAnchor(t),isMouseRightClick(e.browserEvent)||this.list.setSelection([t],e.browserEvent),void this._onPointer.fire(e))}onDoubleClick(e){if(isInputElement(e.browserEvent.target)||isMonacoEditor(e.browserEvent.target))return;if(this.isSelectionChangeEvent(e))return;const t=this.list.getFocus();this.list.setSelection(t,e.browserEvent)}changeSelection(e){const t=e.index;let o=this.list.getAnchor();if(this.isSelectionRangeChangeEvent(e)){if(void 0===o){const e=this.list.getFocus()[0];o=null!=e?e:t,this.list.setAnchor(o)}const i=Math.min(o,t),s=Math.max(o,t),n=range(i,s+1),r=this.list.getSelection(),l=getContiguousRangeContaining(disjunction(r,[o]),o);if(0===l.length)return;const a=disjunction(n,relativeComplement(r,l));this.list.setSelection(a,e.browserEvent),this.list.setFocus([t],e.browserEvent)}else if(this.isSelectionSingleChangeEvent(e)){const o=this.list.getSelection(),i=o.filter((e=>e!==t));this.list.setFocus([t]),this.list.setAnchor(t),o.length===i.length?this.list.setSelection([...i,t],e.browserEvent):this.list.setSelection(i,e.browserEvent)}}dispose(){this.disposables.dispose()}}export class DefaultStyleController{constructor(e,t){this.styleElement=e,this.selectorSuffix=t}style(e){var t,o;const i=this.selectorSuffix&&`.${this.selectorSuffix}`,s=[];e.listBackground&&s.push(`.monaco-list${i} .monaco-list-rows { background: ${e.listBackground}; }`),e.listFocusBackground&&(s.push(`.monaco-list${i}:focus .monaco-list-row.focused { background-color: ${e.listFocusBackground}; }`),s.push(`.monaco-list${i}:focus .monaco-list-row.focused:hover { background-color: ${e.listFocusBackground}; }`)),e.listFocusForeground&&s.push(`.monaco-list${i}:focus .monaco-list-row.focused { color: ${e.listFocusForeground}; }`),e.listActiveSelectionBackground&&(s.push(`.monaco-list${i}:focus .monaco-list-row.selected { background-color: ${e.listActiveSelectionBackground}; }`),s.push(`.monaco-list${i}:focus .monaco-list-row.selected:hover { background-color: ${e.listActiveSelectionBackground}; }`)),e.listActiveSelectionForeground&&s.push(`.monaco-list${i}:focus .monaco-list-row.selected { color: ${e.listActiveSelectionForeground}; }`),e.listActiveSelectionIconForeground&&s.push(`.monaco-list${i}:focus .monaco-list-row.selected .codicon { color: ${e.listActiveSelectionIconForeground}; }`),e.listFocusAndSelectionBackground&&s.push(`\n\t\t\t\t.monaco-drag-image,\n\t\t\t\t.monaco-list${i}:focus .monaco-list-row.selected.focused { background-color: ${e.listFocusAndSelectionBackground}; }\n\t\t\t`),e.listFocusAndSelectionForeground&&s.push(`\n\t\t\t\t.monaco-drag-image,\n\t\t\t\t.monaco-list${i}:focus .monaco-list-row.selected.focused { color: ${e.listFocusAndSelectionForeground}; }\n\t\t\t`),e.listInactiveFocusForeground&&(s.push(`.monaco-list${i} .monaco-list-row.focused { color:  ${e.listInactiveFocusForeground}; }`),s.push(`.monaco-list${i} .monaco-list-row.focused:hover { color:  ${e.listInactiveFocusForeground}; }`)),e.listInactiveSelectionIconForeground&&s.push(`.monaco-list${i} .monaco-list-row.focused .codicon { color:  ${e.listInactiveSelectionIconForeground}; }`),e.listInactiveFocusBackground&&(s.push(`.monaco-list${i} .monaco-list-row.focused { background-color:  ${e.listInactiveFocusBackground}; }`),s.push(`.monaco-list${i} .monaco-list-row.focused:hover { background-color:  ${e.listInactiveFocusBackground}; }`)),e.listInactiveSelectionBackground&&(s.push(`.monaco-list${i} .monaco-list-row.selected { background-color:  ${e.listInactiveSelectionBackground}; }`),s.push(`.monaco-list${i} .monaco-list-row.selected:hover { background-color:  ${e.listInactiveSelectionBackground}; }`)),e.listInactiveSelectionForeground&&s.push(`.monaco-list${i} .monaco-list-row.selected { color: ${e.listInactiveSelectionForeground}; }`),e.listHoverBackground&&s.push(`.monaco-list${i}:not(.drop-target):not(.dragging) .monaco-list-row:hover:not(.selected):not(.focused) { background-color: ${e.listHoverBackground}; }`),e.listHoverForeground&&s.push(`.monaco-list${i}:not(.drop-target):not(.dragging) .monaco-list-row:hover:not(.selected):not(.focused) { color:  ${e.listHoverForeground}; }`);const n=asCssValueWithDefault(e.listFocusAndSelectionOutline,asCssValueWithDefault(e.listSelectionOutline,null!==(t=e.listFocusOutline)&&void 0!==t?t:""));n&&s.push(`.monaco-list${i}:focus .monaco-list-row.focused.selected { outline: 1px solid ${n}; outline-offset: -1px;}`),e.listFocusOutline&&s.push(`\n\t\t\t\t.monaco-drag-image,\n\t\t\t\t.monaco-list${i}:focus .monaco-list-row.focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }\n\t\t\t\t.monaco-workbench.context-menu-visible .monaco-list${i}.last-focused .monaco-list-row.focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }\n\t\t\t`);const r=asCssValueWithDefault(e.listSelectionOutline,null!==(o=e.listInactiveFocusOutline)&&void 0!==o?o:"");r&&s.push(`.monaco-list${i} .monaco-list-row.focused.selected { outline: 1px dotted ${r}; outline-offset: -1px; }`),e.listSelectionOutline&&s.push(`.monaco-list${i} .monaco-list-row.selected { outline: 1px dotted ${e.listSelectionOutline}; outline-offset: -1px; }`),e.listInactiveFocusOutline&&s.push(`.monaco-list${i} .monaco-list-row.focused { outline: 1px dotted ${e.listInactiveFocusOutline}; outline-offset: -1px; }`),e.listHoverOutline&&s.push(`.monaco-list${i} .monaco-list-row:hover { outline: 1px dashed ${e.listHoverOutline}; outline-offset: -1px; }`),e.listDropBackground&&s.push(`\n\t\t\t\t.monaco-list${i}.drop-target,\n\t\t\t\t.monaco-list${i} .monaco-list-rows.drop-target,\n\t\t\t\t.monaco-list${i} .monaco-list-row.drop-target { background-color: ${e.listDropBackground} !important; color: inherit !important; }\n\t\t\t`),e.tableColumnsBorder&&s.push(`\n\t\t\t\t.monaco-table > .monaco-split-view2,\n\t\t\t\t.monaco-table > .monaco-split-view2 .monaco-sash.vertical::before,\n\t\t\t\t.monaco-workbench:not(.reduce-motion) .monaco-table:hover > .monaco-split-view2,\n\t\t\t\t.monaco-workbench:not(.reduce-motion) .monaco-table:hover > .monaco-split-view2 .monaco-sash.vertical::before {\n\t\t\t\t\tborder-color: ${e.tableColumnsBorder};\n\t\t\t\t}\n\n\t\t\t\t.monaco-workbench:not(.reduce-motion) .monaco-table > .monaco-split-view2,\n\t\t\t\t.monaco-workbench:not(.reduce-motion) .monaco-table > .monaco-split-view2 .monaco-sash.vertical::before {\n\t\t\t\t\tborder-color: transparent;\n\t\t\t\t}\n\t\t\t`),e.tableOddRowsBackgroundColor&&s.push(`\n\t\t\t\t.monaco-table .monaco-list-row[data-parity=odd]:not(.focused):not(.selected):not(:hover) .monaco-table-tr,\n\t\t\t\t.monaco-table .monaco-list:not(:focus) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr,\n\t\t\t\t.monaco-table .monaco-list:not(.focused) .monaco-list-row[data-parity=odd].focused:not(.selected):not(:hover) .monaco-table-tr {\n\t\t\t\t\tbackground-color: ${e.tableOddRowsBackgroundColor};\n\t\t\t\t}\n\t\t\t`),this.styleElement.textContent=s.join("\n")}}export const unthemedListStyles={listFocusBackground:"#7FB0D0",listActiveSelectionBackground:"#0E639C",listActiveSelectionForeground:"#FFFFFF",listActiveSelectionIconForeground:"#FFFFFF",listFocusAndSelectionOutline:"#90C2F9",listFocusAndSelectionBackground:"#094771",listFocusAndSelectionForeground:"#FFFFFF",listInactiveSelectionBackground:"#3F3F46",listInactiveSelectionIconForeground:"#FFFFFF",listHoverBackground:"#2A2D2E",listDropBackground:"#383B3D",treeIndentGuidesStroke:"#a9a9a9",treeInactiveIndentGuidesStroke:Color.fromHex("#a9a9a9").transparent(.4).toString(),tableColumnsBorder:Color.fromHex("#cccccc").transparent(.2).toString(),tableOddRowsBackgroundColor:Color.fromHex("#cccccc").transparent(.04).toString(),listBackground:void 0,listFocusForeground:void 0,listInactiveSelectionForeground:void 0,listInactiveFocusForeground:void 0,listInactiveFocusBackground:void 0,listHoverForeground:void 0,listFocusOutline:void 0,listInactiveFocusOutline:void 0,listSelectionOutline:void 0,listHoverOutline:void 0};const DefaultOptions={keyboardSupport:!0,mouseSupport:!0,multipleSelectionSupport:!0,dnd:{getDragURI:()=>null,onDragStart(){},onDragOver:()=>!1,drop(){}}};function getContiguousRangeContaining(e,t){const o=e.indexOf(t);if(-1===o)return[];const i=[];let s=o-1;for(;s>=0&&e[s]===t-(o-s);)i.push(e[s--]);for(i.reverse(),s=o;s<e.length&&e[s]===t+(s-o);)i.push(e[s++]);return i}function disjunction(e,t){const o=[];let i=0,s=0;for(;i<e.length||s<t.length;)if(i>=e.length)o.push(t[s++]);else if(s>=t.length)o.push(e[i++]);else{if(e[i]===t[s]){o.push(e[i]),i++,s++;continue}e[i]<t[s]?o.push(e[i++]):o.push(t[s++])}return o}function relativeComplement(e,t){const o=[];let i=0,s=0;for(;i<e.length||s<t.length;)if(i>=e.length)o.push(t[s++]);else if(s>=t.length)o.push(e[i++]);else{if(e[i]===t[s]){i++,s++;continue}e[i]<t[s]?o.push(e[i++]):s++}return o}const numericSort=(e,t)=>e-t;class PipelineRenderer{constructor(e,t){this._templateId=e,this.renderers=t}get templateId(){return this._templateId}renderTemplate(e){return this.renderers.map((t=>t.renderTemplate(e)))}renderElement(e,t,o,i){let s=0;for(const n of this.renderers)n.renderElement(e,t,o[s++],i)}disposeElement(e,t,o,i){var s;let n=0;for(const r of this.renderers)null===(s=r.disposeElement)||void 0===s||s.call(r,e,t,o[n],i),n+=1}disposeTemplate(e){let t=0;for(const o of this.renderers)o.disposeTemplate(e[t++])}}class AccessibiltyRenderer{constructor(e){this.accessibilityProvider=e,this.templateId="a18n"}renderTemplate(e){return e}renderElement(e,t,o){const i=this.accessibilityProvider.getAriaLabel(e);i?o.setAttribute("aria-label",i):o.removeAttribute("aria-label");const s=this.accessibilityProvider.getAriaLevel&&this.accessibilityProvider.getAriaLevel(e);"number"==typeof s?o.setAttribute("aria-level",`${s}`):o.removeAttribute("aria-level")}disposeTemplate(e){}}class ListViewDragAndDrop{constructor(e,t){this.list=e,this.dnd=t}getDragElements(e){const t=this.list.getSelectedElements();return t.indexOf(e)>-1?t:[e]}getDragURI(e){return this.dnd.getDragURI(e)}getDragLabel(e,t){if(this.dnd.getDragLabel)return this.dnd.getDragLabel(e,t)}onDragStart(e,t){var o,i;null===(i=(o=this.dnd).onDragStart)||void 0===i||i.call(o,e,t)}onDragOver(e,t,o,i){return this.dnd.onDragOver(e,t,o,i)}onDragLeave(e,t,o,i){var s,n;null===(n=(s=this.dnd).onDragLeave)||void 0===n||n.call(s,e,t,o,i)}onDragEnd(e){var t,o;null===(o=(t=this.dnd).onDragEnd)||void 0===o||o.call(t,e)}drop(e,t,o,i){this.dnd.drop(e,t,o,i)}}export class List{get onDidChangeFocus(){return Event.map(this.eventBufferer.wrapEvent(this.focus.onChange),(e=>this.toListEvent(e)),this.disposables)}get onDidChangeSelection(){return Event.map(this.eventBufferer.wrapEvent(this.selection.onChange),(e=>this.toListEvent(e)),this.disposables)}get domId(){return this.view.domId}get onMouseClick(){return this.view.onMouseClick}get onMouseDblClick(){return this.view.onMouseDblClick}get onMouseMiddleClick(){return this.view.onMouseMiddleClick}get onPointer(){return this.mouseController.onPointer}get onMouseDown(){return this.view.onMouseDown}get onMouseOver(){return this.view.onMouseOver}get onTouchStart(){return this.view.onTouchStart}get onTap(){return this.view.onTap}get onContextMenu(){let e=!1;const t=this.disposables.add(Event.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event)).map((e=>new StandardKeyboardEvent(e))).filter((t=>e=58===t.keyCode||t.shiftKey&&68===t.keyCode)).map((e=>EventHelper.stop(e,!0))).filter((()=>!1)).event,o=this.disposables.add(Event.chain(this.disposables.add(new DomEmitter(this.view.domNode,"keyup")).event)).forEach((()=>e=!1)).map((e=>new StandardKeyboardEvent(e))).filter((e=>58===e.keyCode||e.shiftKey&&68===e.keyCode)).map((e=>EventHelper.stop(e,!0))).map((({browserEvent:e})=>{const t=this.getFocus(),o=t.length?t[0]:void 0;return{index:o,element:void 0!==o?this.view.element(o):void 0,anchor:void 0!==o?this.view.domElement(o):this.view.domNode,browserEvent:e}})).event,i=this.disposables.add(Event.chain(this.view.onContextMenu)).filter((t=>!e)).map((({element:e,index:t,browserEvent:o})=>({element:e,index:t,anchor:{x:o.pageX+1,y:o.pageY},browserEvent:o}))).event;return Event.any(t,o,i)}get onKeyDown(){return this.disposables.add(new DomEmitter(this.view.domNode,"keydown")).event}get onDidFocus(){return Event.signal(this.disposables.add(new DomEmitter(this.view.domNode,"focus",!0)).event)}constructor(e,t,o,i,s=DefaultOptions){var n,r,l,a;this.user=e,this._options=s,this.focus=new Trait("focused"),this.anchor=new Trait("anchor"),this.eventBufferer=new EventBufferer,this._ariaLabel="",this.disposables=new DisposableStore,this._onDidDispose=new Emitter,this.onDidDispose=this._onDidDispose.event;const c=this._options.accessibilityProvider&&this._options.accessibilityProvider.getWidgetRole?null===(n=this._options.accessibilityProvider)||void 0===n?void 0:n.getWidgetRole():"list";this.selection=new SelectionTrait("listbox"!==c);const d=[this.focus.renderer,this.selection.renderer];this.accessibilityProvider=s.accessibilityProvider,this.accessibilityProvider&&(d.push(new AccessibiltyRenderer(this.accessibilityProvider)),null===(l=(r=this.accessibilityProvider).onDidChangeActiveDescendant)||void 0===l||l.call(r,this.onDidChangeActiveDescendant,this,this.disposables)),i=i.map((e=>new PipelineRenderer(e.templateId,[...d,e])));const h=Object.assign(Object.assign({},s),{dnd:s.dnd&&new ListViewDragAndDrop(this,s.dnd)});if(this.view=this.createListView(t,o,i,h),this.view.domNode.setAttribute("role",c),s.styleController)this.styleController=s.styleController(this.view.domId);else{const e=createStyleSheet(this.view.domNode);this.styleController=new DefaultStyleController(e,this.view.domId)}if(this.spliceable=new CombinedSpliceable([new TraitSpliceable(this.focus,this.view,s.identityProvider),new TraitSpliceable(this.selection,this.view,s.identityProvider),new TraitSpliceable(this.anchor,this.view,s.identityProvider),this.view]),this.disposables.add(this.focus),this.disposables.add(this.selection),this.disposables.add(this.anchor),this.disposables.add(this.view),this.disposables.add(this._onDidDispose),this.disposables.add(new DOMFocusController(this,this.view)),("boolean"!=typeof s.keyboardSupport||s.keyboardSupport)&&(this.keyboardController=new KeyboardController(this,this.view,s),this.disposables.add(this.keyboardController)),s.keyboardNavigationLabelProvider){const e=s.keyboardNavigationDelegate||DefaultKeyboardNavigationDelegate;this.typeNavigationController=new TypeNavigationController(this,this.view,s.keyboardNavigationLabelProvider,null!==(a=s.keyboardNavigationEventFilter)&&void 0!==a?a:()=>!0,e),this.disposables.add(this.typeNavigationController)}this.mouseController=this.createMouseController(s),this.disposables.add(this.mouseController),this.onDidChangeFocus(this._onFocusChange,this,this.disposables),this.onDidChangeSelection(this._onSelectionChange,this,this.disposables),this.accessibilityProvider&&(this.ariaLabel=this.accessibilityProvider.getWidgetAriaLabel()),!1!==this._options.multipleSelectionSupport&&this.view.domNode.setAttribute("aria-multiselectable","true")}createListView(e,t,o,i){return new ListView(e,t,o,i)}createMouseController(e){return new MouseController(this)}updateOptions(e={}){var t,o;this._options=Object.assign(Object.assign({},this._options),e),null===(t=this.typeNavigationController)||void 0===t||t.updateOptions(this._options),void 0!==this._options.multipleSelectionController&&(this._options.multipleSelectionSupport?this.view.domNode.setAttribute("aria-multiselectable","true"):this.view.domNode.removeAttribute("aria-multiselectable")),this.mouseController.updateOptions(e),null===(o=this.keyboardController)||void 0===o||o.updateOptions(e),this.view.updateOptions(e)}get options(){return this._options}splice(e,t,o=[]){if(e<0||e>this.view.length)throw new ListError(this.user,`Invalid start index: ${e}`);if(t<0)throw new ListError(this.user,`Invalid delete count: ${t}`);0===t&&0===o.length||this.eventBufferer.bufferEvents((()=>this.spliceable.splice(e,t,o)))}rerender(){this.view.rerender()}element(e){return this.view.element(e)}get length(){return this.view.length}get contentHeight(){return this.view.contentHeight}get scrollTop(){return this.view.getScrollTop()}set scrollTop(e){this.view.setScrollTop(e)}get scrollHeight(){return this.view.scrollHeight}get firstVisibleIndex(){return this.view.firstVisibleIndex}get ariaLabel(){return this._ariaLabel}set ariaLabel(e){this._ariaLabel=e,this.view.domNode.setAttribute("aria-label",e)}domFocus(){this.view.domNode.focus({preventScroll:!0})}layout(e,t){this.view.layout(e,t)}setSelection(e,t){for(const t of e)if(t<0||t>=this.length)throw new ListError(this.user,`Invalid index ${t}`);this.selection.set(e,t)}getSelection(){return this.selection.get()}getSelectedElements(){return this.getSelection().map((e=>this.view.element(e)))}setAnchor(e){if(void 0!==e){if(e<0||e>=this.length)throw new ListError(this.user,`Invalid index ${e}`);this.anchor.set([e])}else this.anchor.set([])}getAnchor(){return firstOrDefault(this.anchor.get(),void 0)}getAnchorElement(){const e=this.getAnchor();return void 0===e?void 0:this.element(e)}setFocus(e,t){for(const t of e)if(t<0||t>=this.length)throw new ListError(this.user,`Invalid index ${t}`);this.focus.set(e,t)}focusNext(e=1,t=!1,o,i){if(0===this.length)return;const s=this.focus.get(),n=this.findNextIndex(s.length>0?s[0]+e:0,t,i);n>-1&&this.setFocus([n],o)}focusPrevious(e=1,t=!1,o,i){if(0===this.length)return;const s=this.focus.get(),n=this.findPreviousIndex(s.length>0?s[0]-e:0,t,i);n>-1&&this.setFocus([n],o)}focusNextPage(e,t){return __awaiter(this,void 0,void 0,(function*(){let o=this.view.indexAt(this.view.getScrollTop()+this.view.renderHeight);o=0===o?0:o-1;const i=this.getFocus()[0];if(i!==o&&(void 0===i||o>i)){const s=this.findPreviousIndex(o,!1,t);s>-1&&i!==s?this.setFocus([s],e):this.setFocus([o],e)}else{const s=this.view.getScrollTop();let n=s+this.view.renderHeight;o>i&&(n-=this.view.elementHeight(o)),this.view.setScrollTop(n),this.view.getScrollTop()!==s&&(this.setFocus([]),yield timeout(0),yield this.focusNextPage(e,t))}}))}focusPreviousPage(e,t){return __awaiter(this,void 0,void 0,(function*(){let o;const i=this.view.getScrollTop();o=0===i?this.view.indexAt(i):this.view.indexAfter(i-1);const s=this.getFocus()[0];if(s!==o&&(void 0===s||s>=o)){const i=this.findNextIndex(o,!1,t);i>-1&&s!==i?this.setFocus([i],e):this.setFocus([o],e)}else{const o=i;this.view.setScrollTop(i-this.view.renderHeight),this.view.getScrollTop()!==o&&(this.setFocus([]),yield timeout(0),yield this.focusPreviousPage(e,t))}}))}focusLast(e,t){if(0===this.length)return;const o=this.findPreviousIndex(this.length-1,!1,t);o>-1&&this.setFocus([o],e)}focusFirst(e,t){this.focusNth(0,e,t)}focusNth(e,t,o){if(0===this.length)return;const i=this.findNextIndex(e,!1,o);i>-1&&this.setFocus([i],t)}findNextIndex(e,t=!1,o){for(let i=0;i<this.length;i++){if(e>=this.length&&!t)return-1;if(e%=this.length,!o||o(this.element(e)))return e;e++}return-1}findPreviousIndex(e,t=!1,o){for(let i=0;i<this.length;i++){if(e<0&&!t)return-1;if(e=(this.length+e%this.length)%this.length,!o||o(this.element(e)))return e;e--}return-1}getFocus(){return this.focus.get()}getFocusedElements(){return this.getFocus().map((e=>this.view.element(e)))}reveal(e,t){if(e<0||e>=this.length)throw new ListError(this.user,`Invalid index ${e}`);const o=this.view.getScrollTop(),i=this.view.elementTop(e),s=this.view.elementHeight(e);if(isNumber(t)){const e=s-this.view.renderHeight;this.view.setScrollTop(e*clamp(t,0,1)+i)}else{const e=i+s,t=o+this.view.renderHeight;i<o&&e>=t||(i<o||e>=t&&s>=this.view.renderHeight?this.view.setScrollTop(i):e>=t&&this.view.setScrollTop(e-this.view.renderHeight))}}getHTMLElement(){return this.view.domNode}getElementID(e){return this.view.getElementDomId(e)}style(e){this.styleController.style(e)}toListEvent({indexes:e,browserEvent:t}){return{indexes:e,elements:e.map((e=>this.view.element(e))),browserEvent:t}}_onFocusChange(){const e=this.focus.get();this.view.domNode.classList.toggle("element-focused",e.length>0),this.onDidChangeActiveDescendant()}onDidChangeActiveDescendant(){var e;const t=this.focus.get();if(t.length>0){let o;(null===(e=this.accessibilityProvider)||void 0===e?void 0:e.getActiveDescendantId)&&(o=this.accessibilityProvider.getActiveDescendantId(this.view.element(t[0]))),this.view.domNode.setAttribute("aria-activedescendant",o||this.view.getElementDomId(t[0]))}else this.view.domNode.removeAttribute("aria-activedescendant")}_onSelectionChange(){const e=this.selection.get();this.view.domNode.classList.toggle("selection-none",0===e.length),this.view.domNode.classList.toggle("selection-single",1===e.length),this.view.domNode.classList.toggle("selection-multiple",e.length>1)}dispose(){this._onDidDispose.fire(),this.disposables.dispose(),this._onDidDispose.dispose()}}__decorate([memoize],List.prototype,"onDidChangeFocus",null),__decorate([memoize],List.prototype,"onDidChangeSelection",null),__decorate([memoize],List.prototype,"onContextMenu",null),__decorate([memoize],List.prototype,"onKeyDown",null),__decorate([memoize],List.prototype,"onDidFocus",null);