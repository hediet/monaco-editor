import*as dom from"../../dom.js";import{EventType,Gesture}from"../../touch.js";import*as arrays from"../../../common/arrays.js";import{Emitter}from"../../../common/event.js";import{Disposable}from"../../../common/lifecycle.js";import{isMacintosh}from"../../../common/platform.js";export class SelectBoxNative extends Disposable{constructor(e,t,s,i){super(),this.selected=0,this.selectBoxOptions=i||Object.create(null),this.options=[],this.selectElement=document.createElement("select"),this.selectElement.className="monaco-select-box","string"==typeof this.selectBoxOptions.ariaLabel&&this.selectElement.setAttribute("aria-label",this.selectBoxOptions.ariaLabel),"string"==typeof this.selectBoxOptions.ariaDescription&&this.selectElement.setAttribute("aria-description",this.selectBoxOptions.ariaDescription),this._onDidSelect=this._register(new Emitter),this.styles=s,this.registerListeners(),this.setOptions(e,t)}registerListeners(){this._register(Gesture.addTarget(this.selectElement)),[EventType.Tap].forEach((e=>{this._register(dom.addDisposableListener(this.selectElement,e,(e=>{this.selectElement.focus()})))})),this._register(dom.addStandardDisposableListener(this.selectElement,"click",(e=>{dom.EventHelper.stop(e,!0)}))),this._register(dom.addStandardDisposableListener(this.selectElement,"change",(e=>{this.selectElement.title=e.target.value,this._onDidSelect.fire({index:e.target.selectedIndex,selected:e.target.value})}))),this._register(dom.addStandardDisposableListener(this.selectElement,"keydown",(e=>{let t=!1;isMacintosh?18!==e.keyCode&&16!==e.keyCode&&10!==e.keyCode||(t=!0):(18===e.keyCode&&e.altKey||10===e.keyCode||3===e.keyCode)&&(t=!0),t&&e.stopPropagation()})))}get onDidSelect(){return this._onDidSelect.event}setOptions(e,t){this.options&&arrays.equals(this.options,e)||(this.options=e,this.selectElement.options.length=0,this.options.forEach(((e,t)=>{this.selectElement.add(this.createOption(e.text,t,e.isDisabled))}))),void 0!==t&&this.select(t)}select(e){0===this.options.length?this.selected=0:e>=0&&e<this.options.length?this.selected=e:e>this.options.length-1?this.select(this.options.length-1):this.selected<0&&(this.selected=0),this.selectElement.selectedIndex=this.selected,this.selected<this.options.length&&"string"==typeof this.options[this.selected].text?this.selectElement.title=this.options[this.selected].text:this.selectElement.title=""}focus(){this.selectElement&&(this.selectElement.tabIndex=0,this.selectElement.focus())}blur(){this.selectElement&&(this.selectElement.tabIndex=-1,this.selectElement.blur())}setFocusable(e){this.selectElement.tabIndex=e?0:-1}render(e){e.classList.add("select-container"),e.appendChild(this.selectElement),this.setOptions(this.options,this.selected),this.applyStyles()}applyStyles(){var e,t,s;this.selectElement&&(this.selectElement.style.backgroundColor=null!==(e=this.styles.selectBackground)&&void 0!==e?e:"",this.selectElement.style.color=null!==(t=this.styles.selectForeground)&&void 0!==t?t:"",this.selectElement.style.borderColor=null!==(s=this.styles.selectBorder)&&void 0!==s?s:"")}createOption(e,t,s){const i=document.createElement("option");return i.value=e,i.text=e,i.disabled=!!s,i}}