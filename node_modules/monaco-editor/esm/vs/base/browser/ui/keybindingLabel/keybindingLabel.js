import*as dom from"../../dom.js";import{UILabelProvider}from"../../../common/keybindingLabels.js";import{equals}from"../../../common/objects.js";import"./keybindingLabel.css";import{localize}from"../../../../nls.js";const $=dom.$;export class KeybindingLabel{constructor(e,o,t){this.os=o,this.keyElements=new Set,this.options=t||Object.create(null),this.labelBackground=this.options.keybindingLabelBackground,this.labelBorder=this.options.keybindingLabelBorder,this.labelBottomBorder=this.options.keybindingLabelBottomBorder,this.labelShadow=this.options.keybindingLabelShadow;const i=this.options.keybindingLabelForeground;this.domNode=dom.append(e,$(".monaco-keybinding")),i&&(this.domNode.style.color=i),this.didEverRender=!1,e.appendChild(this.domNode)}get element(){return this.domNode}set(e,o){this.didEverRender&&this.keybinding===e&&KeybindingLabel.areSame(this.matches,o)||(this.keybinding=e,this.matches=o,this.render())}render(){var e;if(this.clear(),this.keybinding){const[o,t]=this.keybinding.getChords();o&&this.renderChord(this.domNode,o,this.matches?this.matches.firstPart:null),t&&(dom.append(this.domNode,$("span.monaco-keybinding-key-chord-separator",void 0," ")),this.renderChord(this.domNode,t,this.matches?this.matches.chordPart:null));const i=null!==(e=this.options.disableTitle)&&void 0!==e&&e?void 0:this.keybinding.getAriaLabel()||void 0;void 0!==i?this.domNode.title=i:this.domNode.removeAttribute("title")}else this.options&&this.options.renderUnboundKeybindings&&this.renderUnbound(this.domNode);this.didEverRender=!0}clear(){dom.clearNode(this.domNode),this.keyElements.clear()}renderChord(e,o,t){const i=UILabelProvider.modifierLabels[this.os];o.ctrlKey&&this.renderKey(e,i.ctrlKey,Boolean(null==t?void 0:t.ctrlKey),i.separator),o.shiftKey&&this.renderKey(e,i.shiftKey,Boolean(null==t?void 0:t.shiftKey),i.separator),o.altKey&&this.renderKey(e,i.altKey,Boolean(null==t?void 0:t.altKey),i.separator),o.metaKey&&this.renderKey(e,i.metaKey,Boolean(null==t?void 0:t.metaKey),i.separator);const d=o.keyLabel;d&&this.renderKey(e,d,Boolean(null==t?void 0:t.keyCode),"")}renderKey(e,o,t,i){dom.append(e,this.createKeyElement(o,t?".highlight":"")),i&&dom.append(e,$("span.monaco-keybinding-key-separator",void 0,i))}renderUnbound(e){dom.append(e,this.createKeyElement(localize("unbound","Unbound")))}createKeyElement(e,o=""){const t=$("span.monaco-keybinding-key"+o,void 0,e);return this.keyElements.add(t),this.labelBackground&&(t.style.backgroundColor=this.labelBackground),this.labelBorder&&(t.style.borderColor=this.labelBorder),this.labelBottomBorder&&(t.style.borderBottomColor=this.labelBottomBorder),this.labelShadow&&(t.style.boxShadow=`inset 0 -1px 0 ${this.labelShadow}`),t}static areSame(e,o){return e===o||!e&&!o||!!e&&!!o&&equals(e.firstPart,o.firstPart)&&equals(e.chordPart,o.chordPart)}}