var __decorate=this&&this.__decorate||function(e,t,o,i){var n,s=arguments.length,r=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,i);else for(var c=e.length-1;c>=0;c--)(n=e[c])&&(r=(s<3?n(r):s>3?n(t,o,r):n(t,o))||r);return s>3&&r&&Object.defineProperty(t,o,r),r},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};import{addDisposableListener}from"../../../base/browser/dom.js";import{ToolBar}from"../../../base/browser/ui/toolbar/toolbar.js";import{Separator,toAction}from"../../../base/common/actions.js";import{coalesceInPlace}from"../../../base/common/arrays.js";import{DisposableStore}from"../../../base/common/lifecycle.js";import{localize}from"../../../nls.js";import{IMenuService,MenuItemAction,SubmenuItemAction}from"../common/actions.js";import{IContextKeyService}from"../../contextkey/common/contextkey.js";import{IContextMenuService}from"../../contextview/browser/contextView.js";import{IKeybindingService}from"../../keybinding/common/keybinding.js";import{ITelemetryService}from"../../telemetry/common/telemetry.js";let WorkbenchToolBar=class extends ToolBar{constructor(e,t,o,i,n,s,r){super(e,n,Object.assign(Object.assign({getKeyBinding:e=>{var t;return null!==(t=s.lookupKeybinding(e.id))&&void 0!==t?t:void 0}},t),{allowContextMenu:!0})),this._options=t,this._menuService=o,this._contextKeyService=i,this._contextMenuService=n,this._sessionDisposables=this._store.add(new DisposableStore),(null==t?void 0:t.telemetrySource)&&this._store.add(this.actionBar.onDidRun((e=>r.publicLog2("workbenchActionExecuted",{id:e.action.id,from:t.telemetrySource}))))}setActions(e,t=[],o){var i,n,s;this._sessionDisposables.clear();const r=e.slice(),c=t.slice(),a=[];let l=0;const d=[];let m=!1;if(-1!==(null===(i=this._options)||void 0===i?void 0:i.hiddenItemStrategy))for(let e=0;e<r.length;e++){const t=r[e];(t instanceof MenuItemAction||t instanceof SubmenuItemAction)&&t.hideActions&&(a.push(t.hideActions.toggle),t.hideActions.toggle.checked&&l++,t.hideActions.isHidden&&(m=!0,r[e]=void 0,0!==(null===(n=this._options)||void 0===n?void 0:n.hiddenItemStrategy)&&(d[e]=t)))}if(void 0!==(null===(s=this._options)||void 0===s?void 0:s.maxNumberOfItems)){let e=0;for(let t=0;t<r.length;t++){const o=r[t];o&&++e>=this._options.maxNumberOfItems&&(r[t]=void 0,d[t]=o)}}coalesceInPlace(r),coalesceInPlace(d),super.setActions(r,Separator.join(d,c)),a.length>0&&this._sessionDisposables.add(addDisposableListener(this.getElement(),"contextmenu",(e=>{var t,i,n,s;const r=this.getItemAction(e.target);if(!r)return;e.preventDefault(),e.stopPropagation();let c,d=!1;if(1===l&&0===(null===(t=this._options)||void 0===t?void 0:t.hiddenItemStrategy)){d=!0;for(let e=0;e<a.length;e++)if(a[e].checked){a[e]=toAction({id:r.id,label:r.label,checked:!0,enabled:!1,run(){}});break}}if(!d&&(r instanceof MenuItemAction||r instanceof SubmenuItemAction)){if(!r.hideActions)return;c=r.hideActions.hide}else c=toAction({id:"label",label:localize("hide","Hide"),enabled:!1,run(){}});const u=Separator.join([c],a);(null===(i=this._options)||void 0===i?void 0:i.resetMenu)&&!o&&(o=[this._options.resetMenu]),m&&o&&(u.push(new Separator),u.push(toAction({id:"resetThisMenu",label:localize("resetThisMenu","Reset Menu"),run:()=>this._menuService.resetHiddenStates(o)}))),this._contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>u,menuId:null===(n=this._options)||void 0===n?void 0:n.contextMenu,menuActionOptions:Object.assign({renderShortTitle:!0},null===(s=this._options)||void 0===s?void 0:s.menuOptions),contextKeyService:this._contextKeyService})})))}};WorkbenchToolBar=__decorate([__param(2,IMenuService),__param(3,IContextKeyService),__param(4,IContextMenuService),__param(5,IKeybindingService),__param(6,ITelemetryService)],WorkbenchToolBar);export{WorkbenchToolBar};