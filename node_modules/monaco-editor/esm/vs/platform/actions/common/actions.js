var __decorate=this&&this.__decorate||function(e,n,t,o){var u,i=arguments.length,d=i<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,t):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)d=Reflect.decorate(e,n,t,o);else for(var r=e.length-1;r>=0;r--)(u=e[r])&&(d=(i<3?u(d):i>3?u(n,t,d):u(n,t))||d);return i>3&&d&&Object.defineProperty(n,t,d),d},__param=this&&this.__param||function(e,n){return function(t,o){n(t,o,e)}},__rest=this&&this.__rest||function(e,n){var t={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(t[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var u=0;for(o=Object.getOwnPropertySymbols(e);u<o.length;u++)n.indexOf(o[u])<0&&Object.prototype.propertyIsEnumerable.call(e,o[u])&&(t[o[u]]=e[o[u]])}return t};import{SubmenuAction}from"../../../base/common/actions.js";import{ThemeIcon}from"../../../base/common/themables.js";import{MicrotaskEmitter}from"../../../base/common/event.js";import{DisposableStore,toDisposable}from"../../../base/common/lifecycle.js";import{LinkedList}from"../../../base/common/linkedList.js";import{CommandsRegistry,ICommandService}from"../../commands/common/commands.js";import{ContextKeyExpr,IContextKeyService}from"../../contextkey/common/contextkey.js";import{createDecorator}from"../../instantiation/common/instantiation.js";import{KeybindingsRegistry}from"../../keybinding/common/keybindingsRegistry.js";export function isIMenuItem(e){return void 0!==e.command}export function isISubmenuItem(e){return void 0!==e.submenu}class MenuId{constructor(e){if(MenuId._instances.has(e))throw new TypeError(`MenuId with identifier '${e}' already exists. Use MenuId.for(ident) or a unique identifier`);MenuId._instances.set(e,this),this.id=e}}MenuId._instances=new Map,MenuId.CommandPalette=new MenuId("CommandPalette"),MenuId.DebugBreakpointsContext=new MenuId("DebugBreakpointsContext"),MenuId.DebugCallStackContext=new MenuId("DebugCallStackContext"),MenuId.DebugConsoleContext=new MenuId("DebugConsoleContext"),MenuId.DebugVariablesContext=new MenuId("DebugVariablesContext"),MenuId.DebugWatchContext=new MenuId("DebugWatchContext"),MenuId.DebugToolBar=new MenuId("DebugToolBar"),MenuId.DebugToolBarStop=new MenuId("DebugToolBarStop"),MenuId.EditorContext=new MenuId("EditorContext"),MenuId.SimpleEditorContext=new MenuId("SimpleEditorContext"),MenuId.EditorContent=new MenuId("EditorContent"),MenuId.EditorContextCopy=new MenuId("EditorContextCopy"),MenuId.EditorContextPeek=new MenuId("EditorContextPeek"),MenuId.EditorContextShare=new MenuId("EditorContextShare"),MenuId.EditorTitle=new MenuId("EditorTitle"),MenuId.EditorTitleRun=new MenuId("EditorTitleRun"),MenuId.EditorTitleContext=new MenuId("EditorTitleContext"),MenuId.EmptyEditorGroup=new MenuId("EmptyEditorGroup"),MenuId.EmptyEditorGroupContext=new MenuId("EmptyEditorGroupContext"),MenuId.ExplorerContext=new MenuId("ExplorerContext"),MenuId.ExtensionContext=new MenuId("ExtensionContext"),MenuId.GlobalActivity=new MenuId("GlobalActivity"),MenuId.CommandCenter=new MenuId("CommandCenter"),MenuId.LayoutControlMenuSubmenu=new MenuId("LayoutControlMenuSubmenu"),MenuId.LayoutControlMenu=new MenuId("LayoutControlMenu"),MenuId.MenubarMainMenu=new MenuId("MenubarMainMenu"),MenuId.MenubarAppearanceMenu=new MenuId("MenubarAppearanceMenu"),MenuId.MenubarDebugMenu=new MenuId("MenubarDebugMenu"),MenuId.MenubarEditMenu=new MenuId("MenubarEditMenu"),MenuId.MenubarCopy=new MenuId("MenubarCopy"),MenuId.MenubarFileMenu=new MenuId("MenubarFileMenu"),MenuId.MenubarGoMenu=new MenuId("MenubarGoMenu"),MenuId.MenubarHelpMenu=new MenuId("MenubarHelpMenu"),MenuId.MenubarLayoutMenu=new MenuId("MenubarLayoutMenu"),MenuId.MenubarNewBreakpointMenu=new MenuId("MenubarNewBreakpointMenu"),MenuId.PanelAlignmentMenu=new MenuId("PanelAlignmentMenu"),MenuId.PanelPositionMenu=new MenuId("PanelPositionMenu"),MenuId.MenubarPreferencesMenu=new MenuId("MenubarPreferencesMenu"),MenuId.MenubarRecentMenu=new MenuId("MenubarRecentMenu"),MenuId.MenubarSelectionMenu=new MenuId("MenubarSelectionMenu"),MenuId.MenubarShare=new MenuId("MenubarShare"),MenuId.MenubarSwitchEditorMenu=new MenuId("MenubarSwitchEditorMenu"),MenuId.MenubarSwitchGroupMenu=new MenuId("MenubarSwitchGroupMenu"),MenuId.MenubarTerminalMenu=new MenuId("MenubarTerminalMenu"),MenuId.MenubarViewMenu=new MenuId("MenubarViewMenu"),MenuId.MenubarHomeMenu=new MenuId("MenubarHomeMenu"),MenuId.OpenEditorsContext=new MenuId("OpenEditorsContext"),MenuId.ProblemsPanelContext=new MenuId("ProblemsPanelContext"),MenuId.SCMChangeContext=new MenuId("SCMChangeContext"),MenuId.SCMResourceContext=new MenuId("SCMResourceContext"),MenuId.SCMResourceFolderContext=new MenuId("SCMResourceFolderContext"),MenuId.SCMResourceGroupContext=new MenuId("SCMResourceGroupContext"),MenuId.SCMSourceControl=new MenuId("SCMSourceControl"),MenuId.SCMTitle=new MenuId("SCMTitle"),MenuId.SearchContext=new MenuId("SearchContext"),MenuId.SearchActionMenu=new MenuId("SearchActionContext"),MenuId.StatusBarWindowIndicatorMenu=new MenuId("StatusBarWindowIndicatorMenu"),MenuId.StatusBarRemoteIndicatorMenu=new MenuId("StatusBarRemoteIndicatorMenu"),MenuId.StickyScrollContext=new MenuId("StickyScrollContext"),MenuId.TestItem=new MenuId("TestItem"),MenuId.TestItemGutter=new MenuId("TestItemGutter"),MenuId.TestPeekElement=new MenuId("TestPeekElement"),MenuId.TestPeekTitle=new MenuId("TestPeekTitle"),MenuId.TouchBarContext=new MenuId("TouchBarContext"),MenuId.TitleBarContext=new MenuId("TitleBarContext"),MenuId.TitleBarTitleContext=new MenuId("TitleBarTitleContext"),MenuId.TunnelContext=new MenuId("TunnelContext"),MenuId.TunnelPrivacy=new MenuId("TunnelPrivacy"),MenuId.TunnelProtocol=new MenuId("TunnelProtocol"),MenuId.TunnelPortInline=new MenuId("TunnelInline"),MenuId.TunnelTitle=new MenuId("TunnelTitle"),MenuId.TunnelLocalAddressInline=new MenuId("TunnelLocalAddressInline"),MenuId.TunnelOriginInline=new MenuId("TunnelOriginInline"),MenuId.ViewItemContext=new MenuId("ViewItemContext"),MenuId.ViewContainerTitle=new MenuId("ViewContainerTitle"),MenuId.ViewContainerTitleContext=new MenuId("ViewContainerTitleContext"),MenuId.ViewTitle=new MenuId("ViewTitle"),MenuId.ViewTitleContext=new MenuId("ViewTitleContext"),MenuId.CommentEditorActions=new MenuId("CommentEditorActions"),MenuId.CommentThreadTitle=new MenuId("CommentThreadTitle"),MenuId.CommentThreadActions=new MenuId("CommentThreadActions"),MenuId.CommentThreadAdditionalActions=new MenuId("CommentThreadAdditionalActions"),MenuId.CommentThreadTitleContext=new MenuId("CommentThreadTitleContext"),MenuId.CommentThreadCommentContext=new MenuId("CommentThreadCommentContext"),MenuId.CommentTitle=new MenuId("CommentTitle"),MenuId.CommentActions=new MenuId("CommentActions"),MenuId.InteractiveToolbar=new MenuId("InteractiveToolbar"),MenuId.InteractiveCellTitle=new MenuId("InteractiveCellTitle"),MenuId.InteractiveCellDelete=new MenuId("InteractiveCellDelete"),MenuId.InteractiveCellExecute=new MenuId("InteractiveCellExecute"),MenuId.InteractiveInputExecute=new MenuId("InteractiveInputExecute"),MenuId.NotebookToolbar=new MenuId("NotebookToolbar"),MenuId.NotebookCellTitle=new MenuId("NotebookCellTitle"),MenuId.NotebookCellDelete=new MenuId("NotebookCellDelete"),MenuId.NotebookCellInsert=new MenuId("NotebookCellInsert"),MenuId.NotebookCellBetween=new MenuId("NotebookCellBetween"),MenuId.NotebookCellListTop=new MenuId("NotebookCellTop"),MenuId.NotebookCellExecute=new MenuId("NotebookCellExecute"),MenuId.NotebookCellExecutePrimary=new MenuId("NotebookCellExecutePrimary"),MenuId.NotebookDiffCellInputTitle=new MenuId("NotebookDiffCellInputTitle"),MenuId.NotebookDiffCellMetadataTitle=new MenuId("NotebookDiffCellMetadataTitle"),MenuId.NotebookDiffCellOutputsTitle=new MenuId("NotebookDiffCellOutputsTitle"),MenuId.NotebookOutputToolbar=new MenuId("NotebookOutputToolbar"),MenuId.NotebookEditorLayoutConfigure=new MenuId("NotebookEditorLayoutConfigure"),MenuId.NotebookKernelSource=new MenuId("NotebookKernelSource"),MenuId.BulkEditTitle=new MenuId("BulkEditTitle"),MenuId.BulkEditContext=new MenuId("BulkEditContext"),MenuId.TimelineItemContext=new MenuId("TimelineItemContext"),MenuId.TimelineTitle=new MenuId("TimelineTitle"),MenuId.TimelineTitleContext=new MenuId("TimelineTitleContext"),MenuId.TimelineFilterSubMenu=new MenuId("TimelineFilterSubMenu"),MenuId.AccountsContext=new MenuId("AccountsContext"),MenuId.PanelTitle=new MenuId("PanelTitle"),MenuId.AuxiliaryBarTitle=new MenuId("AuxiliaryBarTitle"),MenuId.TerminalInstanceContext=new MenuId("TerminalInstanceContext"),MenuId.TerminalEditorInstanceContext=new MenuId("TerminalEditorInstanceContext"),MenuId.TerminalNewDropdownContext=new MenuId("TerminalNewDropdownContext"),MenuId.TerminalTabContext=new MenuId("TerminalTabContext"),MenuId.TerminalTabEmptyAreaContext=new MenuId("TerminalTabEmptyAreaContext"),MenuId.TerminalInlineTabContext=new MenuId("TerminalInlineTabContext"),MenuId.WebviewContext=new MenuId("WebviewContext"),MenuId.InlineCompletionsActions=new MenuId("InlineCompletionsActions"),MenuId.NewFile=new MenuId("NewFile"),MenuId.MergeInput1Toolbar=new MenuId("MergeToolbar1Toolbar"),MenuId.MergeInput2Toolbar=new MenuId("MergeToolbar2Toolbar"),MenuId.MergeBaseToolbar=new MenuId("MergeBaseToolbar"),MenuId.MergeInputResultToolbar=new MenuId("MergeToolbarResultToolbar"),MenuId.InlineSuggestionToolbar=new MenuId("InlineSuggestionToolbar");export{MenuId};export const IMenuService=createDecorator("menuService");class MenuRegistryChangeEvent{static for(e){let n=this._all.get(e);return n||(n=new MenuRegistryChangeEvent(e),this._all.set(e,n)),n}static merge(e){const n=new Set;for(const t of e)t instanceof MenuRegistryChangeEvent&&n.add(t.id);return n}constructor(e){this.id=e,this.has=n=>n===e}}MenuRegistryChangeEvent._all=new Map;export const MenuRegistry=new class{constructor(){this._commands=new Map,this._menuItems=new Map,this._onDidChangeMenu=new MicrotaskEmitter({merge:MenuRegistryChangeEvent.merge}),this.onDidChangeMenu=this._onDidChangeMenu.event}addCommand(e){return this._commands.set(e.id,e),this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(MenuId.CommandPalette)),toDisposable((()=>{this._commands.delete(e.id)&&this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(MenuId.CommandPalette))}))}getCommand(e){return this._commands.get(e)}getCommands(){const e=new Map;return this._commands.forEach(((n,t)=>e.set(t,n))),e}appendMenuItem(e,n){let t=this._menuItems.get(e);t||(t=new LinkedList,this._menuItems.set(e,t));const o=t.push(n);return this._onDidChangeMenu.fire(MenuRegistryChangeEvent.for(e)),toDisposable(o)}appendMenuItems(e){const n=new DisposableStore;for(const{id:t,item:o}of e)n.add(this.appendMenuItem(t,o));return n}getMenuItems(e){let n;return n=this._menuItems.has(e)?[...this._menuItems.get(e)]:[],e===MenuId.CommandPalette&&this._appendImplicitItems(n),n}_appendImplicitItems(e){const n=new Set;for(const t of e)isIMenuItem(t)&&(n.add(t.command.id),t.alt&&n.add(t.alt.id));this._commands.forEach(((t,o)=>{n.has(o)||e.push({command:t})}))}};export class SubmenuItemAction extends SubmenuAction{constructor(e,n,t){super(`submenuitem.${e.submenu.id}`,"string"==typeof e.title?e.title:e.title.value,t,"submenu"),this.item=e,this.hideActions=n}}let MenuItemAction=class e{static label(e,n){return(null==n?void 0:n.renderShortTitle)&&e.shortTitle?"string"==typeof e.shortTitle?e.shortTitle:e.shortTitle.value:"string"==typeof e.title?e.title:e.title.value}constructor(n,t,o,u,i,d){var r,M;if(this.hideActions=u,this._commandService=d,this.id=n.id,this.label=e.label(n,o),this.tooltip=null!==(M="string"==typeof n.tooltip?n.tooltip:null===(r=n.tooltip)||void 0===r?void 0:r.value)&&void 0!==M?M:"",this.enabled=!n.precondition||i.contextMatchesRules(n.precondition),this.checked=void 0,n.toggled){const e=n.toggled.condition?n.toggled:{condition:n.toggled};this.checked=i.contextMatchesRules(e.condition),this.checked&&e.tooltip&&(this.tooltip="string"==typeof e.tooltip?e.tooltip:e.tooltip.value),e.title&&(this.label="string"==typeof e.title?e.title:e.title.value)}this.item=n,this.alt=t?new e(t,void 0,o,u,i,d):void 0,this._options=o,ThemeIcon.isThemeIcon(n.icon)&&(this.class=ThemeIcon.asClassName(n.icon))}run(...e){var n,t;let o=[];return(null===(n=this._options)||void 0===n?void 0:n.arg)&&(o=[...o,this._options.arg]),(null===(t=this._options)||void 0===t?void 0:t.shouldForwardArgs)&&(o=[...o,...e]),this._commandService.executeCommand(this.id,...o)}};MenuItemAction=__decorate([__param(4,IContextKeyService),__param(5,ICommandService)],MenuItemAction);export{MenuItemAction};export class Action2{constructor(e){this.desc=e}}export function registerAction2(e){const n=new DisposableStore,t=new e,o=t.desc,{f1:u,menu:i,keybinding:d,description:r}=o,M=__rest(o,["f1","menu","keybinding","description"]);if(n.add(CommandsRegistry.registerCommand({id:M.id,handler:(e,...n)=>t.run(e,...n),description:r})),Array.isArray(i))for(const e of i)n.add(MenuRegistry.appendMenuItem(e.id,Object.assign({command:Object.assign(Object.assign({},M),{precondition:null===e.precondition?void 0:M.precondition})},e)));else i&&n.add(MenuRegistry.appendMenuItem(i.id,Object.assign({command:Object.assign(Object.assign({},M),{precondition:null===i.precondition?void 0:M.precondition})},i)));if(u&&(n.add(MenuRegistry.appendMenuItem(MenuId.CommandPalette,{command:M,when:M.precondition})),n.add(MenuRegistry.addCommand(M))),Array.isArray(d))for(const e of d)n.add(KeybindingsRegistry.registerKeybindingRule(Object.assign(Object.assign({},e),{id:M.id,when:M.precondition?ContextKeyExpr.and(M.precondition,e.when):e.when})));else d&&n.add(KeybindingsRegistry.registerKeybindingRule(Object.assign(Object.assign({},d),{id:M.id,when:M.precondition?ContextKeyExpr.and(M.precondition,d.when):d.when})));return n}