var __decorate=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},__param=this&&this.__param||function(e,t){return function(i,o){t(i,o,e)}};import{FindInput}from"../../../base/browser/ui/findinput/findInput.js";import{ReplaceInput}from"../../../base/browser/ui/findinput/replaceInput.js";import{ContextKeyExpr,IContextKeyService,RawContextKey}from"../../contextkey/common/contextkey.js";import{KeybindingsRegistry}from"../../keybinding/common/keybindingsRegistry.js";import{localize}from"../../../nls.js";import{DisposableStore,toDisposable}from"../../../base/common/lifecycle.js";export const historyNavigationVisible=new RawContextKey("suggestWidgetVisible",!1,localize("suggestWidgetVisible","Whether suggestion are visible"));const HistoryNavigationWidgetFocusContext="historyNavigationWidgetFocus",HistoryNavigationForwardsEnablementContext="historyNavigationForwardsEnabled",HistoryNavigationBackwardsEnablementContext="historyNavigationBackwardsEnabled";let lastFocusedWidget;const widgets=[];export function registerAndCreateHistoryNavigationContext(e,t){if(widgets.includes(t))throw new Error("Cannot register the same widget multiple times");widgets.push(t);const i=new DisposableStore,o=new RawContextKey("historyNavigationWidgetFocus",!1).bindTo(e),n=new RawContextKey("historyNavigationForwardsEnabled",!0).bindTo(e),s=new RawContextKey("historyNavigationBackwardsEnabled",!0).bindTo(e),r=()=>{o.set(!0),lastFocusedWidget=t},a=()=>{o.set(!1),lastFocusedWidget===t&&(lastFocusedWidget=void 0)};return t.element===document.activeElement&&r(),i.add(t.onDidFocus((()=>r()))),i.add(t.onDidBlur((()=>a()))),i.add(toDisposable((()=>{widgets.splice(widgets.indexOf(t),1),a()}))),{historyNavigationForwardsEnablement:n,historyNavigationBackwardsEnablement:s,dispose(){i.dispose()}}}let ContextScopedFindInput=class extends FindInput{constructor(e,t,i,o){super(e,t,i);const n=this._register(o.createScoped(this.inputBox.element));this._register(registerAndCreateHistoryNavigationContext(n,this.inputBox))}};ContextScopedFindInput=__decorate([__param(3,IContextKeyService)],ContextScopedFindInput);export{ContextScopedFindInput};let ContextScopedReplaceInput=class extends ReplaceInput{constructor(e,t,i,o,n=!1){super(e,t,n,i);const s=this._register(o.createScoped(this.inputBox.element));this._register(registerAndCreateHistoryNavigationContext(s,this.inputBox))}};ContextScopedReplaceInput=__decorate([__param(3,IContextKeyService)],ContextScopedReplaceInput);export{ContextScopedReplaceInput};KeybindingsRegistry.registerCommandAndKeybindingRule({id:"history.showPrevious",weight:200,when:ContextKeyExpr.and(ContextKeyExpr.has("historyNavigationWidgetFocus"),ContextKeyExpr.equals("historyNavigationBackwardsEnabled",!0),historyNavigationVisible.isEqualTo(!1)),primary:16,secondary:[528],handler:e=>{null==lastFocusedWidget||lastFocusedWidget.showPreviousValue()}}),KeybindingsRegistry.registerCommandAndKeybindingRule({id:"history.showNext",weight:200,when:ContextKeyExpr.and(ContextKeyExpr.has("historyNavigationWidgetFocus"),ContextKeyExpr.equals("historyNavigationForwardsEnabled",!0),historyNavigationVisible.isEqualTo(!1)),primary:18,secondary:[530],handler:e=>{null==lastFocusedWidget||lastFocusedWidget.showNextValue()}});