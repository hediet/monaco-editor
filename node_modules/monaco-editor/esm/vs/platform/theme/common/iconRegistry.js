import{RunOnceScheduler}from"../../../base/common/async.js";import{Codicon,getCodiconFontCharacters}from"../../../base/common/codicons.js";import{ThemeIcon}from"../../../base/common/themables.js";import{Emitter}from"../../../base/common/event.js";import{isString}from"../../../base/common/types.js";import{URI}from"../../../base/common/uri.js";import{localize}from"../../../nls.js";import{Extensions as JSONExtensions}from"../../jsonschemas/common/jsonContributionRegistry.js";import*as platform from"../../registry/common/platform.js";export const Extensions={IconContribution:"base.contributions.icons"};export var IconContribution;!function(o){o.getDefinition=function(o,e){let i=o.defaults;for(;ThemeIcon.isThemeIcon(i);){const o=iconRegistry.getIcon(i.id);if(!o)return;i=o.defaults}return i}}(IconContribution||(IconContribution={}));export var IconFontDefinition;!function(o){o.toJSONObject=function(o){return{weight:o.weight,style:o.style,src:o.src.map((o=>({format:o.format,location:o.location.toString()})))}},o.fromJSONObject=function(o){const e=o=>isString(o)?o:void 0;if(o&&Array.isArray(o.src)&&o.src.every((o=>isString(o.format)&&isString(o.location))))return{weight:e(o.weight),style:e(o.style),src:o.src.map((o=>({format:o.format,location:URI.parse(o.location)})))}}}(IconFontDefinition||(IconFontDefinition={}));class IconRegistry{constructor(){this._onDidChange=new Emitter,this.onDidChange=this._onDidChange.event,this.iconSchema={definitions:{icons:{type:"object",properties:{fontId:{type:"string",description:localize("iconDefinition.fontId","The id of the font to use. If not set, the font that is defined first is used.")},fontCharacter:{type:"string",description:localize("iconDefinition.fontCharacter","The font character associated with the icon definition.")}},additionalProperties:!1,defaultSnippets:[{body:{fontCharacter:"\\\\e030"}}]}},type:"object",properties:{}},this.iconReferenceSchema={type:"string",pattern:`^${ThemeIcon.iconNameExpression}$`,enum:[],enumDescriptions:[]},this.iconsById={},this.iconFontsById={}}registerIcon(o,e,i,n){const t=this.iconsById[o];if(t){if(i&&!t.description){t.description=i,this.iconSchema.properties[o].markdownDescription=`${i} $(${o})`;const e=this.iconReferenceSchema.enum.indexOf(o);-1!==e&&(this.iconReferenceSchema.enumDescriptions[e]=i),this._onDidChange.fire()}return t}const s={id:o,description:i,defaults:e,deprecationMessage:n};this.iconsById[o]=s;const c={$ref:"#/definitions/icons"};return n&&(c.deprecationMessage=n),i&&(c.markdownDescription=`${i}: $(${o})`),this.iconSchema.properties[o]=c,this.iconReferenceSchema.enum.push(o),this.iconReferenceSchema.enumDescriptions.push(i||""),this._onDidChange.fire(),{id:o}}getIcons(){return Object.keys(this.iconsById).map((o=>this.iconsById[o]))}getIcon(o){return this.iconsById[o]}getIconSchema(){return this.iconSchema}toString(){const o=(o,e)=>o.id.localeCompare(e.id),e=o=>{for(;ThemeIcon.isThemeIcon(o.defaults);)o=this.iconsById[o.defaults.id];return`codicon codicon-${o?o.id:""}`},i=[];i.push("| preview     | identifier                        | default codicon ID                | description"),i.push("| ----------- | --------------------------------- | --------------------------------- | --------------------------------- |");const n=Object.keys(this.iconsById).map((o=>this.iconsById[o]));for(const t of n.filter((o=>!!o.description)).sort(o))i.push(`|<i class="${e(t)}"></i>|${t.id}|${ThemeIcon.isThemeIcon(t.defaults)?t.defaults.id:t.id}|${t.description||""}|`);i.push("| preview     | identifier                        "),i.push("| ----------- | --------------------------------- |");for(const t of n.filter((o=>!ThemeIcon.isThemeIcon(o.defaults))).sort(o))i.push(`|<i class="${e(t)}"></i>|${t.id}|`);return i.join("\n")}}const iconRegistry=new IconRegistry;platform.Registry.add(Extensions.IconContribution,iconRegistry);export function registerIcon(o,e,i,n){return iconRegistry.registerIcon(o,e,i,n)}export function getIconRegistry(){return iconRegistry}function initialize(){const o=getCodiconFontCharacters();for(const e in o){const i="\\"+o[e].toString(16);iconRegistry.registerIcon(e,{fontCharacter:i})}}initialize();export const iconsSchemaId="vscode://schemas/icons";const schemaRegistry=platform.Registry.as(JSONExtensions.JSONContribution);schemaRegistry.registerSchema(iconsSchemaId,iconRegistry.getIconSchema());const delayer=new RunOnceScheduler((()=>schemaRegistry.notifySchemaChanged(iconsSchemaId)),200);iconRegistry.onDidChange((()=>{delayer.isScheduled()||delayer.schedule()}));export const widgetClose=registerIcon("widget-close",Codicon.close,localize("widgetClose","Icon for the close action in widgets."));export const gotoPreviousLocation=registerIcon("goto-previous-location",Codicon.arrowUp,localize("previousChangeIcon","Icon for goto previous editor location."));export const gotoNextLocation=registerIcon("goto-next-location",Codicon.arrowDown,localize("nextChangeIcon","Icon for goto next editor location."));export const syncing=ThemeIcon.modify(Codicon.sync,"spin");export const spinningLoading=ThemeIcon.modify(Codicon.loading,"spin");