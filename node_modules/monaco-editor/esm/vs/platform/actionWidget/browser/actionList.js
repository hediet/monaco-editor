var __decorate=this&&this.__decorate||function(e,t,i,n){var o,s=arguments.length,l=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,i,n);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(l=(s<3?o(l):s>3?o(t,i,l):o(t,i))||l);return s>3&&l&&Object.defineProperty(t,i,l),l},__param=this&&this.__param||function(e,t){return function(i,n){t(i,n,e)}};import*as dom from"../../../base/browser/dom.js";import{HighlightedLabel}from"../../../base/browser/ui/highlightedlabel/highlightedLabel.js";import{KeybindingLabel}from"../../../base/browser/ui/keybindingLabel/keybindingLabel.js";import{List}from"../../../base/browser/ui/list/listWidget.js";import{Codicon}from"../../../base/common/codicons.js";import{ThemeIcon}from"../../../base/common/themables.js";import{Disposable}from"../../../base/common/lifecycle.js";import{OS}from"../../../base/common/platform.js";import"./actionWidget.css";import{localize}from"../../../nls.js";import{IContextViewService}from"../../contextview/browser/contextView.js";import{IKeybindingService}from"../../keybinding/common/keybinding.js";import{defaultListStyles}from"../../theme/browser/defaultStyles.js";import{asCssVariable}from"../../theme/common/colorRegistry.js";export const acceptSelectedActionCommand="acceptSelectedCodeAction";export const previewSelectedActionCommand="previewSelectedCodeAction";class HeaderRenderer{get templateId(){return"header"}renderTemplate(e){e.classList.add("group-header");const t=document.createElement("span");return e.append(t),{container:e,text:t}}renderElement(e,t,i){var n,o;i.text.textContent=null!==(o=null===(n=e.group)||void 0===n?void 0:n.title)&&void 0!==o?o:""}disposeTemplate(e){}}let ActionItemRenderer=class{get templateId(){return"action"}constructor(e,t){this._supportsPreview=e,this._keybindingService=t}renderTemplate(e){e.classList.add(this.templateId);const t=document.createElement("div");t.className="icon",e.append(t);const i=document.createElement("span");return i.className="title",e.append(i),{container:e,icon:t,text:i,keybinding:new KeybindingLabel(e,OS)}}renderElement(e,t,i){var n,o,s;if((null===(n=e.group)||void 0===n?void 0:n.icon)?(i.icon.className=ThemeIcon.asClassName(e.group.icon),e.group.icon.color&&(i.icon.style.color=asCssVariable(e.group.icon.color.id))):(i.icon.className=ThemeIcon.asClassName(Codicon.lightBulb),i.icon.style.color="var(--vscode-editorLightBulb-foreground)"),!e.item||!e.label)return;i.text.textContent=stripNewlines(e.label),e.keybinding?(i.keybinding.set(e.keybinding),dom.show(i.keybinding.element)):dom.hide(i.keybinding.element);const l=null===(o=this._keybindingService.lookupKeybinding("acceptSelectedCodeAction"))||void 0===o?void 0:o.getLabel(),r=null===(s=this._keybindingService.lookupKeybinding("previewSelectedCodeAction"))||void 0===s?void 0:s.getLabel();if(i.container.classList.toggle("option-disabled",e.disabled),e.disabled?i.container.title=e.label:l&&r?this._supportsPreview?i.container.title=localize({key:"label-preview",comment:['placeholders are keybindings, e.g "F2 to apply, Shift+F2 to preview"']},"{0} to apply, {1} to preview",l,r):i.container.title=localize({key:"label",comment:['placeholder is a keybinding, e.g "F2 to apply"']},"{0} to apply",l):i.container.title="",e.description){const t=new HighlightedLabel(dom.append(i.container,dom.$("span.label-description")));t.element.classList.add("action-list-description"),t.set(e.description)}}disposeTemplate(e){}};ActionItemRenderer=__decorate([__param(1,IKeybindingService)],ActionItemRenderer);class AcceptSelectedEvent extends UIEvent{constructor(){super("acceptSelectedAction")}}class PreviewSelectedEvent extends UIEvent{constructor(){super("previewSelectedAction")}}let ActionList=class extends Disposable{constructor(e,t,i,n,o,s){super(),this._delegate=n,this._contextViewService=o,this._keybindingService=s,this._actionLineHeight=24,this._headerLineHeight=26,this.domNode=document.createElement("div"),this.domNode.classList.add("actionList");const l={getHeight:e=>"header"===e.kind?this._headerLineHeight:this._actionLineHeight,getTemplateId:e=>e.kind};this._list=this._register(new List(e,this.domNode,l,[new ActionItemRenderer(t,this._keybindingService),new HeaderRenderer],{keyboardSupport:!1,accessibilityProvider:{getAriaLabel:e=>{if("action"===e.kind){let t=e.label?stripNewlines(null==e?void 0:e.label):"";return e.disabled&&(t=localize({key:"customQuickFixWidget.labels",comment:["Action widget labels for accessibility."]},"{0}, Disabled Reason: {1}",t,e.disabled)),t}return null},getWidgetAriaLabel:()=>localize({key:"customQuickFixWidget",comment:["An action widget option"]},"Action Widget"),getRole:e=>"action"===e.kind?"option":"separator",getWidgetRole:()=>"listbox"}})),this._list.style(defaultListStyles),this._register(this._list.onMouseClick((e=>this.onListClick(e)))),this._register(this._list.onMouseOver((e=>this.onListHover(e)))),this._register(this._list.onDidChangeFocus((()=>this._list.domFocus()))),this._register(this._list.onDidChangeSelection((e=>this.onListSelection(e)))),this._allMenuItems=i,this._list.splice(0,this._list.length,this._allMenuItems),this._list.length&&this.focusNext()}focusCondition(e){return!e.disabled&&"action"===e.kind}hide(e){this._delegate.onHide(e),this._contextViewService.hideContextView()}layout(e){const t=this._allMenuItems.filter((e=>"header"===e.kind)).length,i=this._allMenuItems.length*this._actionLineHeight+t*this._headerLineHeight-t*this._actionLineHeight;this._list.layout(i);const n=this._allMenuItems.map(((e,t)=>{const i=document.getElementById(this._list.getElementID(t));if(i){i.style.width="auto";const e=i.getBoundingClientRect().width;return i.style.width="",e}return 0})),o=Math.max(...n,e),s=Math.min(i,.7*document.body.clientHeight);return this._list.layout(s,o),this.domNode.style.height=`${s}px`,this._list.domFocus(),o}focusPrevious(){this._list.focusPrevious(1,!0,void 0,this.focusCondition)}focusNext(){this._list.focusNext(1,!0,void 0,this.focusCondition)}acceptSelected(e){const t=this._list.getFocus();if(0===t.length)return;const i=t[0],n=this._list.element(i);if(!this.focusCondition(n))return;const o=e?new PreviewSelectedEvent:new AcceptSelectedEvent;this._list.setSelection([i],o)}onListSelection(e){if(!e.elements.length)return;const t=e.elements[0];t.item&&this.focusCondition(t)?this._delegate.onSelect(t.item,e.browserEvent instanceof PreviewSelectedEvent):this._list.setSelection([])}onListHover(e){this._list.setFocus("number"==typeof e.index?[e.index]:[])}onListClick(e){e.element&&this.focusCondition(e.element)&&this._list.setFocus([])}};ActionList=__decorate([__param(4,IContextViewService),__param(5,IKeybindingService)],ActionList);export{ActionList};function stripNewlines(e){return e.replace(/\r\n|\r|\n/g," ")}