var __awaiter=this&&this.__awaiter||function(e,o,r,t){return new(r||(r=Promise))((function(n,i){function s(e){try{a(t.next(e))}catch(e){i(e)}}function c(e){try{a(t.throw(e))}catch(e){i(e)}}function a(e){var o;e.done?n(e.value):(o=e.value,o instanceof r?o:new r((function(e){e(o)}))).then(s,c)}a((t=t.apply(e,o||[])).next())}))};import{AsyncIterableObject}from"../../../../base/common/async.js";import{CancellationToken}from"../../../../base/common/cancellation.js";import{onUnexpectedExternalError}from"../../../../base/common/errors.js";import{registerModelAndPositionCommand}from"../../../browser/editorExtensions.js";import{ILanguageFeaturesService}from"../../../common/services/languageFeatures.js";export class HoverProviderResult{constructor(e,o,r){this.provider=e,this.hover=o,this.ordinal=r}}function executeProvider(e,o,r,t,n){return __awaiter(this,void 0,void 0,(function*(){try{const i=yield Promise.resolve(e.provideHover(r,t,n));if(i&&isValid(i))return new HoverProviderResult(e,i,o)}catch(e){onUnexpectedExternalError(e)}}))}export function getHover(e,o,r,t){const n=e.ordered(o).map(((e,n)=>executeProvider(e,n,o,r,t)));return AsyncIterableObject.fromPromises(n).coalesce()}export function getHoverPromise(e,o,r,t){return getHover(e,o,r,t).map((e=>e.hover)).toPromise()}function isValid(e){const o=void 0!==e.range,r=void 0!==e.contents&&e.contents&&e.contents.length>0;return o&&r}registerModelAndPositionCommand("_executeHoverProvider",((e,o,r)=>getHoverPromise(e.get(ILanguageFeaturesService).hoverProvider,o,r,CancellationToken.None)));