var __decorate=this&&this.__decorate||function(e,t,i,r){var a,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,r);else for(var n=e.length-1;n>=0;n--)(a=e[n])&&(s=(o<3?a(s):o>3?a(t,i,s):a(t,i))||s);return o>3&&s&&Object.defineProperty(t,i,s),s},__param=this&&this.__param||function(e,t){return function(i,r){t(i,r,e)}};import{normalizeDriveLetter}from"../../../../base/common/labels.js";import*as path from"../../../../base/common/path.js";import{dirname}from"../../../../base/common/resources.js";import{commonPrefixLength,getLeadingWhitespace,isFalsyOrWhitespace,splitLines}from"../../../../base/common/strings.js";import{generateUuid}from"../../../../base/common/uuid.js";import{ILanguageConfigurationService}from"../../../common/languages/languageConfigurationRegistry.js";import{Text}from"./snippetParser.js";import*as nls from"../../../../nls.js";import{WORKSPACE_EXTENSION,isSingleFolderWorkspaceIdentifier,toWorkspaceIdentifier,isEmptyWorkspaceIdentifier}from"../../../../platform/workspace/common/workspace.js";export const KnownSnippetVariableNames=Object.freeze({CURRENT_YEAR:!0,CURRENT_YEAR_SHORT:!0,CURRENT_MONTH:!0,CURRENT_DATE:!0,CURRENT_HOUR:!0,CURRENT_MINUTE:!0,CURRENT_SECOND:!0,CURRENT_DAY_NAME:!0,CURRENT_DAY_NAME_SHORT:!0,CURRENT_MONTH_NAME:!0,CURRENT_MONTH_NAME_SHORT:!0,CURRENT_SECONDS_UNIX:!0,SELECTION:!0,CLIPBOARD:!0,TM_SELECTED_TEXT:!0,TM_CURRENT_LINE:!0,TM_CURRENT_WORD:!0,TM_LINE_INDEX:!0,TM_LINE_NUMBER:!0,TM_FILENAME:!0,TM_FILENAME_BASE:!0,TM_DIRECTORY:!0,TM_FILEPATH:!0,CURSOR_INDEX:!0,CURSOR_NUMBER:!0,RELATIVE_FILEPATH:!0,BLOCK_COMMENT_START:!0,BLOCK_COMMENT_END:!0,LINE_COMMENT:!0,WORKSPACE_NAME:!0,WORKSPACE_FOLDER:!0,RANDOM:!0,RANDOM_HEX:!0,UUID:!0});export class CompositeSnippetVariableResolver{constructor(e){this._delegates=e}resolve(e){for(const t of this._delegates){const i=t.resolve(e);if(void 0!==i)return i}}}export class SelectionBasedVariableResolver{constructor(e,t,i,r){this._model=e,this._selection=t,this._selectionIdx=i,this._overtypingCapturer=r}resolve(e){const{name:t}=e;if("SELECTION"===t||"TM_SELECTED_TEXT"===t){let t=this._model.getValueInRange(this._selection)||void 0,i=this._selection.startLineNumber!==this._selection.endLineNumber;if(!t&&this._overtypingCapturer){const e=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);e&&(t=e.value,i=e.multiline)}if(t&&i&&e.snippet){const i=this._model.getLineContent(this._selection.startLineNumber),r=getLeadingWhitespace(i,0,this._selection.startColumn-1);let a=r;e.snippet.walk((t=>t!==e&&(t instanceof Text&&(a=getLeadingWhitespace(splitLines(t.value).pop())),!0)));const o=commonPrefixLength(a,r);t=t.replace(/(\r\n|\r|\n)(.*)/g,((e,t,i)=>`${t}${a.substr(o)}${i}`))}return t}if("TM_CURRENT_LINE"===t)return this._model.getLineContent(this._selection.positionLineNumber);if("TM_CURRENT_WORD"===t){const e=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return e&&e.word||void 0}return"TM_LINE_INDEX"===t?String(this._selection.positionLineNumber-1):"TM_LINE_NUMBER"===t?String(this._selection.positionLineNumber):"CURSOR_INDEX"===t?String(this._selectionIdx):"CURSOR_NUMBER"===t?String(this._selectionIdx+1):void 0}}export class ModelBasedVariableResolver{constructor(e,t){this._labelService=e,this._model=t}resolve(e){const{name:t}=e;if("TM_FILENAME"===t)return path.basename(this._model.uri.fsPath);if("TM_FILENAME_BASE"===t){const e=path.basename(this._model.uri.fsPath),t=e.lastIndexOf(".");return t<=0?e:e.slice(0,t)}return"TM_DIRECTORY"===t?"."===path.dirname(this._model.uri.fsPath)?"":this._labelService.getUriLabel(dirname(this._model.uri)):"TM_FILEPATH"===t?this._labelService.getUriLabel(this._model.uri):"RELATIVE_FILEPATH"===t?this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0}):void 0}}export class ClipboardBasedVariableResolver{constructor(e,t,i,r){this._readClipboardText=e,this._selectionIdx=t,this._selectionCount=i,this._spread=r}resolve(e){if("CLIPBOARD"!==e.name)return;const t=this._readClipboardText();if(t){if(this._spread){const e=t.split(/\r\n|\n|\r/).filter((e=>!isFalsyOrWhitespace(e)));if(e.length===this._selectionCount)return e[this._selectionIdx]}return t}}}let CommentBasedVariableResolver=class{constructor(e,t,i){this._model=e,this._selection=t,this._languageConfigurationService=i}resolve(e){const{name:t}=e,i=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),r=this._languageConfigurationService.getLanguageConfiguration(i).comments;if(r)return"LINE_COMMENT"===t?r.lineCommentToken||void 0:"BLOCK_COMMENT_START"===t?r.blockCommentStartToken||void 0:"BLOCK_COMMENT_END"===t&&r.blockCommentEndToken||void 0}};CommentBasedVariableResolver=__decorate([__param(2,ILanguageConfigurationService)],CommentBasedVariableResolver);export{CommentBasedVariableResolver};class TimeBasedVariableResolver{constructor(){this._date=new Date}resolve(e){const{name:t}=e;return"CURRENT_YEAR"===t?String(this._date.getFullYear()):"CURRENT_YEAR_SHORT"===t?String(this._date.getFullYear()).slice(-2):"CURRENT_MONTH"===t?String(this._date.getMonth().valueOf()+1).padStart(2,"0"):"CURRENT_DATE"===t?String(this._date.getDate().valueOf()).padStart(2,"0"):"CURRENT_HOUR"===t?String(this._date.getHours().valueOf()).padStart(2,"0"):"CURRENT_MINUTE"===t?String(this._date.getMinutes().valueOf()).padStart(2,"0"):"CURRENT_SECOND"===t?String(this._date.getSeconds().valueOf()).padStart(2,"0"):"CURRENT_DAY_NAME"===t?TimeBasedVariableResolver.dayNames[this._date.getDay()]:"CURRENT_DAY_NAME_SHORT"===t?TimeBasedVariableResolver.dayNamesShort[this._date.getDay()]:"CURRENT_MONTH_NAME"===t?TimeBasedVariableResolver.monthNames[this._date.getMonth()]:"CURRENT_MONTH_NAME_SHORT"===t?TimeBasedVariableResolver.monthNamesShort[this._date.getMonth()]:"CURRENT_SECONDS_UNIX"===t?String(Math.floor(this._date.getTime()/1e3)):void 0}}TimeBasedVariableResolver.dayNames=[nls.localize("Sunday","Sunday"),nls.localize("Monday","Monday"),nls.localize("Tuesday","Tuesday"),nls.localize("Wednesday","Wednesday"),nls.localize("Thursday","Thursday"),nls.localize("Friday","Friday"),nls.localize("Saturday","Saturday")],TimeBasedVariableResolver.dayNamesShort=[nls.localize("SundayShort","Sun"),nls.localize("MondayShort","Mon"),nls.localize("TuesdayShort","Tue"),nls.localize("WednesdayShort","Wed"),nls.localize("ThursdayShort","Thu"),nls.localize("FridayShort","Fri"),nls.localize("SaturdayShort","Sat")],TimeBasedVariableResolver.monthNames=[nls.localize("January","January"),nls.localize("February","February"),nls.localize("March","March"),nls.localize("April","April"),nls.localize("May","May"),nls.localize("June","June"),nls.localize("July","July"),nls.localize("August","August"),nls.localize("September","September"),nls.localize("October","October"),nls.localize("November","November"),nls.localize("December","December")],TimeBasedVariableResolver.monthNamesShort=[nls.localize("JanuaryShort","Jan"),nls.localize("FebruaryShort","Feb"),nls.localize("MarchShort","Mar"),nls.localize("AprilShort","Apr"),nls.localize("MayShort","May"),nls.localize("JuneShort","Jun"),nls.localize("JulyShort","Jul"),nls.localize("AugustShort","Aug"),nls.localize("SeptemberShort","Sep"),nls.localize("OctoberShort","Oct"),nls.localize("NovemberShort","Nov"),nls.localize("DecemberShort","Dec")];export{TimeBasedVariableResolver};export class WorkspaceBasedVariableResolver{constructor(e){this._workspaceService=e}resolve(e){if(!this._workspaceService)return;const t=toWorkspaceIdentifier(this._workspaceService.getWorkspace());return isEmptyWorkspaceIdentifier(t)?void 0:"WORKSPACE_NAME"===e.name?this._resolveWorkspaceName(t):"WORKSPACE_FOLDER"===e.name?this._resoveWorkspacePath(t):void 0}_resolveWorkspaceName(e){if(isSingleFolderWorkspaceIdentifier(e))return path.basename(e.uri.path);let t=path.basename(e.configPath.path);return t.endsWith(WORKSPACE_EXTENSION)&&(t=t.substr(0,t.length-WORKSPACE_EXTENSION.length-1)),t}_resoveWorkspacePath(e){if(isSingleFolderWorkspaceIdentifier(e))return normalizeDriveLetter(e.uri.fsPath);const t=path.basename(e.configPath.path);let i=e.configPath.fsPath;return i.endsWith(t)&&(i=i.substr(0,i.length-t.length-1)),i?normalizeDriveLetter(i):"/"}}export class RandomBasedVariableResolver{resolve(e){const{name:t}=e;return"RANDOM"===t?Math.random().toString().slice(-6):"RANDOM_HEX"===t?Math.random().toString(16).slice(-6):"UUID"===t?generateUuid():void 0}}