var __awaiter=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function d(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,d)}c((i=i.apply(e,t||[])).next())}))};import*as browser from"../../../../base/browser/browser.js";import*as platform from"../../../../base/common/platform.js";import{CopyOptions,InMemoryClipboardMetadataManager}from"../../../browser/controller/textAreaInput.js";import{EditorAction,MultiCommand,registerEditorAction}from"../../../browser/editorExtensions.js";import{ICodeEditorService}from"../../../browser/services/codeEditorService.js";import{EditorContextKeys}from"../../../common/editorContextKeys.js";import*as nls from"../../../../nls.js";import{MenuId,MenuRegistry}from"../../../../platform/actions/common/actions.js";import{IClipboardService}from"../../../../platform/clipboard/common/clipboardService.js";const CLIPBOARD_CONTEXT_MENU_GROUP="9_cutcopypaste",supportsCut=platform.isNative||document.queryCommandSupported("cut"),supportsCopy=platform.isNative||document.queryCommandSupported("copy"),supportsPaste=void 0!==navigator.clipboard&&!browser.isFirefox||document.queryCommandSupported("paste");function registerCommand(e){return e.register(),e}export const CutAction=supportsCut?registerCommand(new MultiCommand({id:"editor.action.clipboardCutAction",precondition:void 0,kbOpts:platform.isNative?{primary:2102,win:{primary:2102,secondary:[1044]},weight:100}:void 0,menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"2_ccp",title:nls.localize({key:"miCut",comment:["&& denotes a mnemonic"]},"Cu&&t"),order:1},{menuId:MenuId.EditorContext,group:"9_cutcopypaste",title:nls.localize("actions.clipboard.cutLabel","Cut"),when:EditorContextKeys.writable,order:1},{menuId:MenuId.CommandPalette,group:"",title:nls.localize("actions.clipboard.cutLabel","Cut"),order:1},{menuId:MenuId.SimpleEditorContext,group:"9_cutcopypaste",title:nls.localize("actions.clipboard.cutLabel","Cut"),when:EditorContextKeys.writable,order:1}]})):void 0;export const CopyAction=supportsCopy?registerCommand(new MultiCommand({id:"editor.action.clipboardCopyAction",precondition:void 0,kbOpts:platform.isNative?{primary:2081,win:{primary:2081,secondary:[2067]},weight:100}:void 0,menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"2_ccp",title:nls.localize({key:"miCopy",comment:["&& denotes a mnemonic"]},"&&Copy"),order:2},{menuId:MenuId.EditorContext,group:"9_cutcopypaste",title:nls.localize("actions.clipboard.copyLabel","Copy"),order:2},{menuId:MenuId.CommandPalette,group:"",title:nls.localize("actions.clipboard.copyLabel","Copy"),order:1},{menuId:MenuId.SimpleEditorContext,group:"9_cutcopypaste",title:nls.localize("actions.clipboard.copyLabel","Copy"),order:2}]})):void 0;MenuRegistry.appendMenuItem(MenuId.MenubarEditMenu,{submenu:MenuId.MenubarCopy,title:{value:nls.localize("copy as","Copy As"),original:"Copy As"},group:"2_ccp",order:3}),MenuRegistry.appendMenuItem(MenuId.EditorContext,{submenu:MenuId.EditorContextCopy,title:{value:nls.localize("copy as","Copy As"),original:"Copy As"},group:"9_cutcopypaste",order:3}),MenuRegistry.appendMenuItem(MenuId.EditorContext,{submenu:MenuId.EditorContextShare,title:{value:nls.localize("share","Share"),original:"Share"},group:"11_share",order:-1});export const PasteAction=supportsPaste?registerCommand(new MultiCommand({id:"editor.action.clipboardPasteAction",precondition:void 0,kbOpts:platform.isNative?{primary:2100,win:{primary:2100,secondary:[1043]},linux:{primary:2100,secondary:[1043]},weight:100}:void 0,menuOpts:[{menuId:MenuId.MenubarEditMenu,group:"2_ccp",title:nls.localize({key:"miPaste",comment:["&& denotes a mnemonic"]},"&&Paste"),order:4},{menuId:MenuId.EditorContext,group:"9_cutcopypaste",title:nls.localize("actions.clipboard.pasteLabel","Paste"),when:EditorContextKeys.writable,order:4},{menuId:MenuId.CommandPalette,group:"",title:nls.localize("actions.clipboard.pasteLabel","Paste"),order:1},{menuId:MenuId.SimpleEditorContext,group:"9_cutcopypaste",title:nls.localize("actions.clipboard.pasteLabel","Paste"),when:EditorContextKeys.writable,order:4}]})):void 0;class ExecCommandCopyWithSyntaxHighlightingAction extends EditorAction{constructor(){super({id:"editor.action.clipboardCopyWithSyntaxHighlightingAction",label:nls.localize("actions.clipboard.copyWithSyntaxHighlightingLabel","Copy With Syntax Highlighting"),alias:"Copy With Syntax Highlighting",precondition:void 0,kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:0,weight:100}})}run(e,t){t.hasModel()&&(!t.getOption(34)&&t.getSelection().isEmpty()||(CopyOptions.forceCopyWithSyntaxHighlighting=!0,t.focus(),document.execCommand("copy"),CopyOptions.forceCopyWithSyntaxHighlighting=!1))}}function registerExecCommandImpl(e,t){e&&(e.addImplementation(1e4,"code-editor",((e,o)=>{const i=e.get(ICodeEditorService).getFocusedCodeEditor();if(i&&i.hasTextFocus()){const e=i.getOption(34),o=i.getSelection();return o&&o.isEmpty()&&!e||document.execCommand(t),!0}return!1})),e.addImplementation(0,"generic-dom",((e,o)=>(document.execCommand(t),!0))))}registerExecCommandImpl(CutAction,"cut"),registerExecCommandImpl(CopyAction,"copy"),PasteAction&&(PasteAction.addImplementation(1e4,"code-editor",((e,t)=>{const o=e.get(ICodeEditorService),i=e.get(IClipboardService),n=o.getFocusedCodeEditor();return!(!n||!n.hasTextFocus())&&(!(!document.execCommand("paste")&&platform.isWeb)||__awaiter(void 0,void 0,void 0,(function*(){const e=yield i.readText();if(""!==e){const t=InMemoryClipboardMetadataManager.INSTANCE.get(e);let o=!1,i=null,r=null;t&&(o=n.getOption(34)&&!!t.isFromEmptySelection,i=void 0!==t.multicursorText?t.multicursorText:null,r=t.mode),n.trigger("keyboard","paste",{text:e,pasteOnNewLine:o,multicursorText:i,mode:r})}})))})),PasteAction.addImplementation(0,"generic-dom",((e,t)=>(document.execCommand("paste"),!0)))),supportsCopy&&registerEditorAction(ExecCommandCopyWithSyntaxHighlightingAction);