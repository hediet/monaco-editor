import{CancellationToken}from"../../../../base/common/cancellation.js";import{illegalArgument}from"../../../../base/common/errors.js";import{URI}from"../../../../base/common/uri.js";import{Range}from"../../../common/core/range.js";import{IModelService}from"../../../common/services/model.js";import{CommandsRegistry}from"../../../../platform/commands/common/commands.js";import{ILanguageFeaturesService}from"../../../common/services/languageFeatures.js";export function getColors(e,r,o){const n=[],t=e.ordered(r).reverse().map((e=>Promise.resolve(e.provideDocumentColors(r,o)).then((r=>{if(Array.isArray(r))for(const o of r)n.push({colorInfo:o,provider:e})}))));return Promise.all(t).then((()=>n))}export function getColorPresentations(e,r,o,n){return Promise.resolve(o.provideColorPresentations(e,r,n))}CommandsRegistry.registerCommand("_executeDocumentColorProvider",(function(e,...r){const[o]=r;if(!(o instanceof URI))throw illegalArgument();const{colorProvider:n}=e.get(ILanguageFeaturesService),t=e.get(IModelService).getModel(o);if(!t)throw illegalArgument();const s=[],a=n.ordered(t).reverse().map((e=>Promise.resolve(e.provideDocumentColors(t,CancellationToken.None)).then((e=>{if(Array.isArray(e))for(const r of e)s.push({range:r.range,color:[r.color.red,r.color.green,r.color.blue,r.color.alpha]})}))));return Promise.all(a).then((()=>s))})),CommandsRegistry.registerCommand("_executeColorPresentationProvider",(function(e,...r){const[o,n]=r,{uri:t,range:s}=n;if(!(t instanceof URI&&Array.isArray(o)&&4===o.length&&Range.isIRange(s)))throw illegalArgument();const[a,i,l,m]=o,{colorProvider:c}=e.get(ILanguageFeaturesService),g=e.get(IModelService).getModel(t);if(!g)throw illegalArgument();const u={range:s,color:{red:a,green:i,blue:l,alpha:m}},d=[],f=c.ordered(g).reverse().map((e=>Promise.resolve(e.provideColorPresentations(g,u,CancellationToken.None)).then((e=>{Array.isArray(e)&&d.push(...e)}))));return Promise.all(f).then((()=>d))}));