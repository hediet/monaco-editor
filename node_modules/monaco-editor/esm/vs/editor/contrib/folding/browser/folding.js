var __decorate=this&&this.__decorate||function(e,t,o,i){var n,s=arguments.length,l=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,o,i);else for(var r=e.length-1;r>=0;r--)(n=e[r])&&(l=(s<3?n(l):s>3?n(t,o,l):n(t,o))||l);return s>3&&l&&Object.defineProperty(t,o,l),l},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};import{createCancelablePromise,Delayer,RunOnceScheduler}from"../../../../base/common/async.js";import{onUnexpectedError}from"../../../../base/common/errors.js";import{KeyChord}from"../../../../base/common/keyCodes.js";import{Disposable,DisposableStore}from"../../../../base/common/lifecycle.js";import{escapeRegExpCharacters}from"../../../../base/common/strings.js";import*as types from"../../../../base/common/types.js";import"./folding.css";import{StableEditorScrollState}from"../../../browser/stableEditorScroll.js";import{EditorAction,registerEditorAction,registerEditorContribution,registerInstantiatedEditorAction}from"../../../browser/editorExtensions.js";import{EditorContextKeys}from"../../../common/editorContextKeys.js";import{FoldingRangeKind}from"../../../common/languages.js";import{ILanguageConfigurationService}from"../../../common/languages/languageConfigurationRegistry.js";import{FoldingModel,getNextFoldLine,getParentFoldLine,getPreviousFoldLine,setCollapseStateAtLevel,setCollapseStateForMatchingLines,setCollapseStateForRest,setCollapseStateForType,setCollapseStateLevelsDown,setCollapseStateLevelsUp,setCollapseStateUp,toggleCollapseState}from"./foldingModel.js";import{HiddenRangeModel}from"./hiddenRangeModel.js";import{IndentRangeProvider}from"./indentRangeProvider.js";import*as nls from"../../../../nls.js";import{IContextKeyService,RawContextKey}from"../../../../platform/contextkey/common/contextkey.js";import{FoldingDecorationProvider}from"./foldingDecorations.js";import{FoldingRegions}from"./foldingRanges.js";import{SyntaxRangeProvider}from"./syntaxRangeProvider.js";import{INotificationService}from"../../../../platform/notification/common/notification.js";import{ILanguageFeatureDebounceService}from"../../../common/services/languageFeatureDebounce.js";import{StopWatch}from"../../../../base/common/stopwatch.js";import{ILanguageFeaturesService}from"../../../common/services/languageFeatures.js";import{Emitter}from"../../../../base/common/event.js";const CONTEXT_FOLDING_ENABLED=new RawContextKey("foldingEnabled",!1);let FoldingController=class e extends Disposable{static get(t){return t.getContribution(e.ID)}constructor(e,t,o,i,n,s){super(),this.contextKeyService=t,this.languageConfigurationService=o,this.languageFeaturesService=s,this.localToDispose=this._register(new DisposableStore),this._onDidChangeFoldingLimit=new Emitter,this.editor=e;const l=this.editor.getOptions();this._isEnabled=l.get(40),this._useFoldingProviders="indentation"!==l.get(41),this._unfoldOnClickAfterEndOfLine=l.get(45),this._restoringViewState=!1,this._currentModelHasFoldedImports=!1,this._foldingImportsByDefault=l.get(43),this._foldingLimitReporter={get limit(){return e.getOptions().get(44)},report:e=>{this._foldingLimitInfo&&e.limited===this._foldingLimitInfo.limited||(this._foldingLimitInfo=e,this._onDidChangeFoldingLimit.fire(e))}},this.updateDebounceInfo=n.for(s.foldingRangeProvider,"Folding",{min:200}),this.foldingModel=null,this.hiddenRangeModel=null,this.rangeProvider=null,this.foldingRegionPromise=null,this.foldingModelPromise=null,this.updateScheduler=null,this.cursorChangedScheduler=null,this.mouseDownInfo=null,this.foldingDecorationProvider=new FoldingDecorationProvider(e),this.foldingDecorationProvider.showFoldingControls=l.get(104),this.foldingDecorationProvider.showFoldingHighlights=l.get(42),this.foldingEnabled=CONTEXT_FOLDING_ENABLED.bindTo(this.contextKeyService),this.foldingEnabled.set(this._isEnabled),this._register(this.editor.onDidChangeModel((()=>this.onModelChanged()))),this._register(this.editor.onDidChangeConfiguration((e=>{if(e.hasChanged(40)&&(this._isEnabled=this.editor.getOptions().get(40),this.foldingEnabled.set(this._isEnabled),this.onModelChanged()),e.hasChanged(44)&&this.onModelChanged(),e.hasChanged(104)||e.hasChanged(42)){const e=this.editor.getOptions();this.foldingDecorationProvider.showFoldingControls=e.get(104),this.foldingDecorationProvider.showFoldingHighlights=e.get(42),this.triggerFoldingModelChanged()}e.hasChanged(41)&&(this._useFoldingProviders="indentation"!==this.editor.getOptions().get(41),this.onFoldingStrategyChanged()),e.hasChanged(45)&&(this._unfoldOnClickAfterEndOfLine=this.editor.getOptions().get(45)),e.hasChanged(43)&&(this._foldingImportsByDefault=this.editor.getOptions().get(43))}))),this.onModelChanged()}saveViewState(){const e=this.editor.getModel();if(!e||!this._isEnabled||e.isTooLargeForTokenization())return{};if(this.foldingModel){const t=this.foldingModel.getMemento(),o=this.rangeProvider?this.rangeProvider.id:void 0;return{collapsedRegions:t,lineCount:e.getLineCount(),provider:o,foldedImports:this._currentModelHasFoldedImports}}}restoreViewState(e){const t=this.editor.getModel();if(t&&this._isEnabled&&!t.isTooLargeForTokenization()&&this.hiddenRangeModel&&e&&(this._currentModelHasFoldedImports=!!e.foldedImports,e.collapsedRegions&&e.collapsedRegions.length>0&&this.foldingModel)){this._restoringViewState=!0;try{this.foldingModel.applyMemento(e.collapsedRegions)}finally{this._restoringViewState=!1}}}onModelChanged(){this.localToDispose.clear();const e=this.editor.getModel();this._isEnabled&&e&&!e.isTooLargeForTokenization()&&(this._currentModelHasFoldedImports=!1,this.foldingModel=new FoldingModel(e,this.foldingDecorationProvider),this.localToDispose.add(this.foldingModel),this.hiddenRangeModel=new HiddenRangeModel(this.foldingModel),this.localToDispose.add(this.hiddenRangeModel),this.localToDispose.add(this.hiddenRangeModel.onDidChange((e=>this.onHiddenRangesChanges(e)))),this.updateScheduler=new Delayer(this.updateDebounceInfo.get(e)),this.cursorChangedScheduler=new RunOnceScheduler((()=>this.revealCursor()),200),this.localToDispose.add(this.cursorChangedScheduler),this.localToDispose.add(this.languageFeaturesService.foldingRangeProvider.onDidChange((()=>this.onFoldingStrategyChanged()))),this.localToDispose.add(this.editor.onDidChangeModelLanguageConfiguration((()=>this.onFoldingStrategyChanged()))),this.localToDispose.add(this.editor.onDidChangeModelContent((e=>this.onDidChangeModelContent(e)))),this.localToDispose.add(this.editor.onDidChangeCursorPosition((()=>this.onCursorPositionChanged()))),this.localToDispose.add(this.editor.onMouseDown((e=>this.onEditorMouseDown(e)))),this.localToDispose.add(this.editor.onMouseUp((e=>this.onEditorMouseUp(e)))),this.localToDispose.add({dispose:()=>{var e,t;this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),null===(e=this.updateScheduler)||void 0===e||e.cancel(),this.updateScheduler=null,this.foldingModel=null,this.foldingModelPromise=null,this.hiddenRangeModel=null,this.cursorChangedScheduler=null,null===(t=this.rangeProvider)||void 0===t||t.dispose(),this.rangeProvider=null}}),this.triggerFoldingModelChanged())}onFoldingStrategyChanged(){var e;null===(e=this.rangeProvider)||void 0===e||e.dispose(),this.rangeProvider=null,this.triggerFoldingModelChanged()}getRangeProvider(t){var o,i;if(this.rangeProvider)return this.rangeProvider;const n=new IndentRangeProvider(t,this.languageConfigurationService,this._foldingLimitReporter);if(this.rangeProvider=n,this._useFoldingProviders&&this.foldingModel){const s=this.languageFeaturesService.foldingRangeProvider.ordered(this.foldingModel.textModel),l=null!==(i=null===(o=e._foldingRangeSelector)||void 0===o?void 0:o.call(e,s,t))&&void 0!==i?i:s;l.length>0&&(this.rangeProvider=new SyntaxRangeProvider(t,l,(()=>this.triggerFoldingModelChanged()),this._foldingLimitReporter,n))}return this.rangeProvider}getFoldingModel(){return this.foldingModelPromise}onDidChangeModelContent(e){var t;null===(t=this.hiddenRangeModel)||void 0===t||t.notifyChangeModelContent(e),this.triggerFoldingModelChanged()}triggerFoldingModelChanged(){this.updateScheduler&&(this.foldingRegionPromise&&(this.foldingRegionPromise.cancel(),this.foldingRegionPromise=null),this.foldingModelPromise=this.updateScheduler.trigger((()=>{const e=this.foldingModel;if(!e)return null;const t=new StopWatch(!0),o=this.getRangeProvider(e.textModel),i=this.foldingRegionPromise=createCancelablePromise((e=>o.compute(e)));return i.then((o=>{if(o&&i===this.foldingRegionPromise){let i;if(this._foldingImportsByDefault&&!this._currentModelHasFoldedImports){const e=o.setCollapsedAllOfType(FoldingRangeKind.Imports.value,!0);e&&(i=StableEditorScrollState.capture(this.editor),this._currentModelHasFoldedImports=e)}const n=this.editor.getSelections(),s=n?n.map((e=>e.startLineNumber)):[];e.update(o,s),null==i||i.restore(this.editor);const l=this.updateDebounceInfo.update(e.textModel,t.elapsed());this.updateScheduler&&(this.updateScheduler.defaultDelay=l)}return e}))})).then(void 0,(e=>(onUnexpectedError(e),null))))}onHiddenRangesChanges(e){if(this.hiddenRangeModel&&e.length&&!this._restoringViewState){const e=this.editor.getSelections();e&&this.hiddenRangeModel.adjustSelections(e)&&this.editor.setSelections(e)}this.editor.setHiddenAreas(e,this)}onCursorPositionChanged(){this.hiddenRangeModel&&this.hiddenRangeModel.hasRanges()&&this.cursorChangedScheduler.schedule()}revealCursor(){const e=this.getFoldingModel();e&&e.then((e=>{if(e){const t=this.editor.getSelections();if(t&&t.length>0){const o=[];for(const i of t){const t=i.selectionStartLineNumber;this.hiddenRangeModel&&this.hiddenRangeModel.isHidden(t)&&o.push(...e.getAllRegionsAtLine(t,(e=>e.isCollapsed&&t>e.startLineNumber)))}o.length&&(e.toggleCollapseState(o),this.reveal(t[0].getPosition()))}}})).then(void 0,onUnexpectedError)}onEditorMouseDown(e){if(this.mouseDownInfo=null,!this.hiddenRangeModel||!e.target||!e.target.range)return;if(!e.event.leftButton&&!e.event.middleButton)return;const t=e.target.range;let o=!1;switch(e.target.type){case 4:{const t=e.target.detail,i=e.target.element.offsetLeft;if(t.offsetX-i<5)return;o=!0;break}case 7:if(this._unfoldOnClickAfterEndOfLine&&this.hiddenRangeModel.hasRanges()&&!e.target.detail.isAfterLines)break;return;case 6:if(this.hiddenRangeModel.hasRanges()){const e=this.editor.getModel();if(e&&t.startColumn===e.getLineMaxColumn(t.startLineNumber))break}return;default:return}this.mouseDownInfo={lineNumber:t.startLineNumber,iconClicked:o}}onEditorMouseUp(e){const t=this.foldingModel;if(!t||!this.mouseDownInfo||!e.target)return;const o=this.mouseDownInfo.lineNumber,i=this.mouseDownInfo.iconClicked,n=e.target.range;if(!n||n.startLineNumber!==o)return;if(i){if(4!==e.target.type)return}else{const e=this.editor.getModel();if(!e||n.startColumn!==e.getLineMaxColumn(o))return}const s=t.getRegionAtLine(o);if(s&&s.startLineNumber===o){const n=s.isCollapsed;if(i||n){let i=[];if(e.event.altKey){const e=e=>!e.containedBy(s)&&!s.containedBy(e),o=t.getRegionsInside(null,e);for(const e of o)e.isCollapsed&&i.push(e);0===i.length&&(i=o)}else{const o=e.event.middleButton||e.event.shiftKey;if(o)for(const e of t.getRegionsInside(s))e.isCollapsed===n&&i.push(e);!n&&o&&0!==i.length||i.push(s)}t.toggleCollapseState(i),this.reveal({lineNumber:o,column:1})}}}reveal(e){this.editor.revealPositionInCenterIfOutsideViewport(e,0)}};FoldingController.ID="editor.contrib.folding",FoldingController=__decorate([__param(1,IContextKeyService),__param(2,ILanguageConfigurationService),__param(3,INotificationService),__param(4,ILanguageFeatureDebounceService),__param(5,ILanguageFeaturesService)],FoldingController);export{FoldingController};class FoldingAction extends EditorAction{runEditorCommand(e,t,o){const i=e.get(ILanguageConfigurationService),n=FoldingController.get(t);if(!n)return;const s=n.getFoldingModel();return s?(this.reportTelemetry(e,t),s.then((e=>{if(e){this.invoke(n,e,t,o,i);const s=t.getSelection();s&&n.reveal(s.getStartPosition())}}))):void 0}getSelectedLines(e){const t=e.getSelections();return t?t.map((e=>e.startLineNumber)):[]}getLineNumbers(e,t){return e&&e.selectionLines?e.selectionLines.map((e=>e+1)):this.getSelectedLines(t)}run(e,t){}}function foldingArgumentsConstraint(e){if(!types.isUndefined(e)){if(!types.isObject(e))return!1;const t=e;if(!types.isUndefined(t.levels)&&!types.isNumber(t.levels))return!1;if(!types.isUndefined(t.direction)&&!types.isString(t.direction))return!1;if(!(types.isUndefined(t.selectionLines)||Array.isArray(t.selectionLines)&&t.selectionLines.every(types.isNumber)))return!1}return!0}class UnfoldAction extends FoldingAction{constructor(){super({id:"editor.unfold",label:nls.localize("unfoldAction.label","Unfold"),alias:"Unfold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3161,mac:{primary:2649},weight:100},description:{description:"Unfold the content in the editor",args:[{name:"Unfold editor argument",description:"Property-value pairs that can be passed through this argument:\n\t\t\t\t\t\t* 'levels': Number of levels to unfold. If not set, defaults to 1.\n\t\t\t\t\t\t* 'direction': If 'up', unfold given number of levels up otherwise unfolds down.\n\t\t\t\t\t\t* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the unfold action to. If not set, the active selection(s) will be used.\n\t\t\t\t\t\t",constraint:foldingArgumentsConstraint,schema:{type:"object",properties:{levels:{type:"number",default:1},direction:{type:"string",enum:["up","down"],default:"down"},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(e,t,o,i){const n=i&&i.levels||1,s=this.getLineNumbers(i,o);i&&"up"===i.direction?setCollapseStateLevelsUp(t,!1,n,s):setCollapseStateLevelsDown(t,!1,n,s)}}class UnFoldRecursivelyAction extends FoldingAction{constructor(){super({id:"editor.unfoldRecursively",label:nls.localize("unFoldRecursivelyAction.label","Unfold Recursively"),alias:"Unfold Recursively",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2137),weight:100}})}invoke(e,t,o,i){setCollapseStateLevelsDown(t,!1,Number.MAX_VALUE,this.getSelectedLines(o))}}class FoldAction extends FoldingAction{constructor(){super({id:"editor.fold",label:nls.localize("foldAction.label","Fold"),alias:"Fold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:3159,mac:{primary:2647},weight:100},description:{description:"Fold the content in the editor",args:[{name:"Fold editor argument",description:"Property-value pairs that can be passed through this argument:\n\t\t\t\t\t\t\t* 'levels': Number of levels to fold.\n\t\t\t\t\t\t\t* 'direction': If 'up', folds given number of levels up otherwise folds down.\n\t\t\t\t\t\t\t* 'selectionLines': Array of the start lines (0-based) of the editor selections to apply the fold action to. If not set, the active selection(s) will be used.\n\t\t\t\t\t\t\tIf no levels or direction is set, folds the region at the locations or if already collapsed, the first uncollapsed parent instead.\n\t\t\t\t\t\t",constraint:foldingArgumentsConstraint,schema:{type:"object",properties:{levels:{type:"number"},direction:{type:"string",enum:["up","down"]},selectionLines:{type:"array",items:{type:"number"}}}}}]}})}invoke(e,t,o,i){const n=this.getLineNumbers(i,o),s=i&&i.levels,l=i&&i.direction;"number"!=typeof s&&"string"!=typeof l?setCollapseStateUp(t,!0,n):"up"===l?setCollapseStateLevelsUp(t,!0,s||1,n):setCollapseStateLevelsDown(t,!0,s||1,n)}}class ToggleFoldAction extends FoldingAction{constructor(){super({id:"editor.toggleFold",label:nls.localize("toggleFoldAction.label","Toggle Fold"),alias:"Toggle Fold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2090),weight:100}})}invoke(e,t,o){const i=this.getSelectedLines(o);toggleCollapseState(t,1,i)}}class FoldRecursivelyAction extends FoldingAction{constructor(){super({id:"editor.foldRecursively",label:nls.localize("foldRecursivelyAction.label","Fold Recursively"),alias:"Fold Recursively",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2135),weight:100}})}invoke(e,t,o){const i=this.getSelectedLines(o);setCollapseStateLevelsDown(t,!0,Number.MAX_VALUE,i)}}class FoldAllBlockCommentsAction extends FoldingAction{constructor(){super({id:"editor.foldAllBlockComments",label:nls.localize("foldAllBlockComments.label","Fold All Block Comments"),alias:"Fold All Block Comments",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2133),weight:100}})}invoke(e,t,o,i,n){if(t.regions.hasTypes())setCollapseStateForType(t,FoldingRangeKind.Comment.value,!0);else{const e=o.getModel();if(!e)return;const i=n.getLanguageConfiguration(e.getLanguageId()).comments;if(i&&i.blockCommentStartToken){const e=new RegExp("^\\s*"+escapeRegExpCharacters(i.blockCommentStartToken));setCollapseStateForMatchingLines(t,e,!0)}}}}class FoldAllRegionsAction extends FoldingAction{constructor(){super({id:"editor.foldAllMarkerRegions",label:nls.localize("foldAllMarkerRegions.label","Fold All Regions"),alias:"Fold All Regions",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2077),weight:100}})}invoke(e,t,o,i,n){if(t.regions.hasTypes())setCollapseStateForType(t,FoldingRangeKind.Region.value,!0);else{const e=o.getModel();if(!e)return;const i=n.getLanguageConfiguration(e.getLanguageId()).foldingRules;if(i&&i.markers&&i.markers.start){const e=new RegExp(i.markers.start);setCollapseStateForMatchingLines(t,e,!0)}}}}class UnfoldAllRegionsAction extends FoldingAction{constructor(){super({id:"editor.unfoldAllMarkerRegions",label:nls.localize("unfoldAllMarkerRegions.label","Unfold All Regions"),alias:"Unfold All Regions",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2078),weight:100}})}invoke(e,t,o,i,n){if(t.regions.hasTypes())setCollapseStateForType(t,FoldingRangeKind.Region.value,!1);else{const e=o.getModel();if(!e)return;const i=n.getLanguageConfiguration(e.getLanguageId()).foldingRules;if(i&&i.markers&&i.markers.start){const e=new RegExp(i.markers.start);setCollapseStateForMatchingLines(t,e,!1)}}}}class FoldAllRegionsExceptAction extends FoldingAction{constructor(){super({id:"editor.foldAllExcept",label:nls.localize("foldAllExcept.label","Fold All Regions Except Selected"),alias:"Fold All Regions Except Selected",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2131),weight:100}})}invoke(e,t,o){const i=this.getSelectedLines(o);setCollapseStateForRest(t,!0,i)}}class UnfoldAllRegionsExceptAction extends FoldingAction{constructor(){super({id:"editor.unfoldAllExcept",label:nls.localize("unfoldAllExcept.label","Unfold All Regions Except Selected"),alias:"Unfold All Regions Except Selected",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2129),weight:100}})}invoke(e,t,o){const i=this.getSelectedLines(o);setCollapseStateForRest(t,!1,i)}}class FoldAllAction extends FoldingAction{constructor(){super({id:"editor.foldAll",label:nls.localize("foldAllAction.label","Fold All"),alias:"Fold All",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2069),weight:100}})}invoke(e,t,o){setCollapseStateLevelsDown(t,!0)}}class UnfoldAllAction extends FoldingAction{constructor(){super({id:"editor.unfoldAll",label:nls.localize("unfoldAllAction.label","Unfold All"),alias:"Unfold All",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2088),weight:100}})}invoke(e,t,o){setCollapseStateLevelsDown(t,!1)}}class FoldLevelAction extends FoldingAction{getFoldingLevel(){return parseInt(this.id.substr(FoldLevelAction.ID_PREFIX.length))}invoke(e,t,o){setCollapseStateAtLevel(t,this.getFoldingLevel(),!0,this.getSelectedLines(o))}}FoldLevelAction.ID_PREFIX="editor.foldLevel",FoldLevelAction.ID=e=>FoldLevelAction.ID_PREFIX+e;class GotoParentFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoParentFold",label:nls.localize("gotoParentFold.label","Go to Parent Fold"),alias:"Go to Parent Fold",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(e,t,o){const i=this.getSelectedLines(o);if(i.length>0){const e=getParentFoldLine(i[0],t);null!==e&&o.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}}class GotoPreviousFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoPreviousFold",label:nls.localize("gotoPreviousFold.label","Go to Previous Folding Range"),alias:"Go to Previous Folding Range",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(e,t,o){const i=this.getSelectedLines(o);if(i.length>0){const e=getPreviousFoldLine(i[0],t);null!==e&&o.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}}class GotoNextFoldAction extends FoldingAction{constructor(){super({id:"editor.gotoNextFold",label:nls.localize("gotoNextFold.label","Go to Next Folding Range"),alias:"Go to Next Folding Range",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,weight:100}})}invoke(e,t,o){const i=this.getSelectedLines(o);if(i.length>0){const e=getNextFoldLine(i[0],t);null!==e&&o.setSelection({startLineNumber:e,startColumn:1,endLineNumber:e,endColumn:1})}}}class FoldRangeFromSelectionAction extends FoldingAction{constructor(){super({id:"editor.createFoldingRangeFromSelection",label:nls.localize("createManualFoldRange.label","Create Folding Range from Selection"),alias:"Create Folding Range from Selection",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2130),weight:100}})}invoke(e,t,o){var i;const n=[],s=o.getSelections();if(s){for(const e of s){let t=e.endLineNumber;1===e.endColumn&&--t,t>e.startLineNumber&&(n.push({startLineNumber:e.startLineNumber,endLineNumber:t,type:void 0,isCollapsed:!0,source:1}),o.setSelection({startLineNumber:e.startLineNumber,startColumn:1,endLineNumber:e.startLineNumber,endColumn:1}))}if(n.length>0){n.sort(((e,t)=>e.startLineNumber-t.startLineNumber));const e=FoldingRegions.sanitizeAndMerge(t.regions,n,null===(i=o.getModel())||void 0===i?void 0:i.getLineCount());t.updatePost(FoldingRegions.fromFoldRanges(e))}}}}class RemoveFoldRangeFromSelectionAction extends FoldingAction{constructor(){super({id:"editor.removeManualFoldingRanges",label:nls.localize("removeManualFoldingRanges.label","Remove Manual Folding Ranges"),alias:"Remove Manual Folding Ranges",precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2132),weight:100}})}invoke(e,t,o){const i=o.getSelections();if(i){const o=[];for(const e of i){const{startLineNumber:t,endLineNumber:i}=e;o.push(i>=t?{startLineNumber:t,endLineNumber:i}:{endLineNumber:i,startLineNumber:t})}t.removeManualRanges(o),e.triggerFoldingModelChanged()}}}registerEditorContribution(FoldingController.ID,FoldingController,0),registerEditorAction(UnfoldAction),registerEditorAction(UnFoldRecursivelyAction),registerEditorAction(FoldAction),registerEditorAction(FoldRecursivelyAction),registerEditorAction(FoldAllAction),registerEditorAction(UnfoldAllAction),registerEditorAction(FoldAllBlockCommentsAction),registerEditorAction(FoldAllRegionsAction),registerEditorAction(UnfoldAllRegionsAction),registerEditorAction(FoldAllRegionsExceptAction),registerEditorAction(UnfoldAllRegionsExceptAction),registerEditorAction(ToggleFoldAction),registerEditorAction(GotoParentFoldAction),registerEditorAction(GotoPreviousFoldAction),registerEditorAction(GotoNextFoldAction),registerEditorAction(FoldRangeFromSelectionAction),registerEditorAction(RemoveFoldRangeFromSelectionAction);for(let e=1;e<=7;e++)registerInstantiatedEditorAction(new FoldLevelAction({id:FoldLevelAction.ID(e),label:nls.localize("foldLevelAction.label","Fold Level {0}",e),alias:`Fold Level ${e}`,precondition:CONTEXT_FOLDING_ENABLED,kbOpts:{kbExpr:EditorContextKeys.editorTextFocus,primary:KeyChord(2089,2048|21+e),weight:100}}));