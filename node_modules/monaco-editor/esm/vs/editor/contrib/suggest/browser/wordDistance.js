var __awaiter=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(i,s)}c((r=r.apply(e,n||[])).next())}))};import{binarySearch,isFalsyOrEmpty}from"../../../../base/common/arrays.js";import{Range}from"../../../common/core/range.js";import{BracketSelectionRangeProvider}from"../../smartSelect/browser/bracketSelections.js";class WordDistance{static create(e,n){return __awaiter(this,void 0,void 0,(function*(){if(!n.getOption(112).localityBonus)return WordDistance.None;if(!n.hasModel())return WordDistance.None;const t=n.getModel(),r=n.getPosition();if(!e.canComputeWordRanges(t.uri))return WordDistance.None;const[o]=yield(new BracketSelectionRangeProvider).provideSelectionRanges(t,[r]);if(0===o.length)return WordDistance.None;const a=yield e.computeWordRanges(t.uri,o[0].range);if(!a)return WordDistance.None;const i=t.getWordUntilPosition(r);return delete a[i.word],new class extends WordDistance{distance(e,t){if(!r.equals(n.getPosition()))return 0;if(17===t.kind)return 2<<20;const i="string"==typeof t.label?t.label:t.label.label,s=a[i];if(isFalsyOrEmpty(s))return 2<<20;const c=binarySearch(s,Range.fromPositions(e),Range.compareRangesUsingStarts),l=c>=0?s[c]:s[Math.max(0,~c-1)];let d=o.length;for(const e of o){if(!Range.containsRange(e.range,l))break;d-=1}return d}}}))}}WordDistance.None=new class extends WordDistance{distance(){return 0}};export{WordDistance};