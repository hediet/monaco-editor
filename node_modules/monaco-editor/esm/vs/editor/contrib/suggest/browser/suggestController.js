var __decorate=this&&this.__decorate||function(e,t,o,i){var s,r=arguments.length,n=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,o,i);else for(var g=e.length-1;g>=0;g--)(s=e[g])&&(n=(r<3?s(n):r>3?s(t,o,n):s(t,o))||n);return r>3&&n&&Object.defineProperty(t,o,n),n},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};import{alert}from"../../../../base/browser/ui/aria/aria.js";import{isNonEmptyArray}from"../../../../base/common/arrays.js";import{IdleValue}from"../../../../base/common/async.js";import{CancellationTokenSource}from"../../../../base/common/cancellation.js";import{onUnexpectedError}from"../../../../base/common/errors.js";import{Event}from"../../../../base/common/event.js";import{KeyCodeChord}from"../../../../base/common/keybindings.js";import{DisposableStore,dispose,MutableDisposable,toDisposable}from"../../../../base/common/lifecycle.js";import*as platform from"../../../../base/common/platform.js";import{StopWatch}from"../../../../base/common/stopwatch.js";import{assertType,isObject}from"../../../../base/common/types.js";import{StableEditorScrollState}from"../../../browser/stableEditorScroll.js";import{EditorAction,EditorCommand,registerEditorAction,registerEditorCommand,registerEditorContribution}from"../../../browser/editorExtensions.js";import{EditOperation}from"../../../common/core/editOperation.js";import{Position}from"../../../common/core/position.js";import{Range}from"../../../common/core/range.js";import{EditorContextKeys}from"../../../common/editorContextKeys.js";import{SnippetController2}from"../../snippet/browser/snippetController2.js";import{SnippetParser}from"../../snippet/browser/snippetParser.js";import{ISuggestMemoryService}from"./suggestMemory.js";import{WordContextKey}from"./wordContextKey.js";import*as nls from"../../../../nls.js";import{CommandsRegistry,ICommandService}from"../../../../platform/commands/common/commands.js";import{ContextKeyExpr,IContextKeyService}from"../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService}from"../../../../platform/instantiation/common/instantiation.js";import{ILogService}from"../../../../platform/log/common/log.js";import{Context as SuggestContext,suggestWidgetStatusbarMenu}from"./suggest.js";import{SuggestAlternatives}from"./suggestAlternatives.js";import{CommitCharacterController}from"./suggestCommitCharacters.js";import{SuggestModel}from"./suggestModel.js";import{OvertypingCapturer}from"./suggestOvertypingCapturer.js";import{SuggestWidget}from"./suggestWidget.js";import{ITelemetryService}from"../../../../platform/telemetry/common/telemetry.js";import{basename,extname}from"../../../../base/common/resources.js";import{hash}from"../../../../base/common/hash.js";const _sticky=!1;class LineSuffix{constructor(e,t){if(this._model=e,this._position=t,e.getLineMaxColumn(t.lineNumber)!==t.column){const o=e.getOffsetAt(t),i=e.getPositionAt(o+1);this._marker=e.deltaDecorations([],[{range:Range.fromPositions(t,i),options:{description:"suggest-line-suffix",stickiness:1}}])}}dispose(){this._marker&&!this._model.isDisposed()&&this._model.deltaDecorations(this._marker,[])}delta(e){if(this._model.isDisposed()||this._position.lineNumber!==e.lineNumber)return 0;if(this._marker){const t=this._model.getDecorationRange(this._marker[0]);return this._model.getOffsetAt(t.getStartPosition())-this._model.getOffsetAt(e)}return this._model.getLineMaxColumn(e.lineNumber)-e.column}}let SuggestController=class e{static get(t){return t.getContribution(e.ID)}constructor(e,t,o,i,s,r,n){this._memoryService=t,this._commandService=o,this._contextKeyService=i,this._instantiationService=s,this._logService=r,this._telemetryService=n,this._lineSuffix=new MutableDisposable,this._toDispose=new DisposableStore,this._selectors=new PriorityRegistry((e=>e.priority)),this._telemetryGate=0,this.editor=e,this.model=s.createInstance(SuggestModel,this.editor),this._selectors.register({priority:0,select:(e,t,o)=>this._memoryService.select(e,t,o)});const g=SuggestContext.InsertMode.bindTo(i);g.set(e.getOption(112).insertMode),this.model.onDidTrigger((()=>g.set(e.getOption(112).insertMode))),this.widget=this._toDispose.add(new IdleValue((()=>{const e=this._instantiationService.createInstance(SuggestWidget,this.editor);this._toDispose.add(e),this._toDispose.add(e.onDidSelect((e=>this._insertSuggestion(e,0)),this));const t=new CommitCharacterController(this.editor,e,this.model,(e=>this._insertSuggestion(e,2)));this._toDispose.add(t);const o=SuggestContext.MakesTextEdit.bindTo(this._contextKeyService),i=SuggestContext.HasInsertAndReplaceRange.bindTo(this._contextKeyService),s=SuggestContext.CanResolve.bindTo(this._contextKeyService);return this._toDispose.add(toDisposable((()=>{o.reset(),i.reset(),s.reset()}))),this._toDispose.add(e.onDidFocus((({item:e})=>{const t=this.editor.getPosition(),r=e.editStart.column,n=t.column;let g=!0;"smart"!==this.editor.getOption(1)||2!==this.model.state||e.completion.additionalTextEdits||4&e.completion.insertTextRules||n-r!==e.completion.insertText.length||(g=this.editor.getModel().getValueInRange({startLineNumber:t.lineNumber,startColumn:r,endLineNumber:t.lineNumber,endColumn:n})!==e.completion.insertText),o.set(g),i.set(!Position.equals(e.editInsertEnd,e.editReplaceEnd)),s.set(Boolean(e.provider.resolveCompletionItem)||Boolean(e.completion.documentation)||e.completion.detail!==e.completion.label)}))),this._toDispose.add(e.onDetailsKeyDown((e=>{e.toKeyCodeChord().equals(new KeyCodeChord(!0,!1,!1,!1,33))||platform.isMacintosh&&e.toKeyCodeChord().equals(new KeyCodeChord(!1,!1,!1,!0,33))?e.stopPropagation():e.toKeyCodeChord().isModifierKey()||this.editor.focus()}))),e}))),this._overtypingCapturer=this._toDispose.add(new IdleValue((()=>this._toDispose.add(new OvertypingCapturer(this.editor,this.model))))),this._alternatives=this._toDispose.add(new IdleValue((()=>this._toDispose.add(new SuggestAlternatives(this.editor,this._contextKeyService))))),this._toDispose.add(s.createInstance(WordContextKey,e)),this._toDispose.add(this.model.onDidTrigger((e=>{this.widget.value.showTriggered(e.auto,e.shy?250:50),this._lineSuffix.value=new LineSuffix(this.editor.getModel(),e.position)}))),this._toDispose.add(this.model.onDidSuggest((e=>{var t;if(e.triggerOptions.shy)return;let o=-1;for(const t of this._selectors.itemsOrderedByPriorityDesc)if(o=t.select(this.editor.getModel(),this.editor.getPosition(),e.completionModel.items),-1!==o)break;-1===o&&(o=0);let i=!1;if(e.triggerOptions.auto){const o=this.editor.getOption(112);o.snippetsPreventQuickSuggestions&&(null===(t=SnippetController2.get(this.editor))||void 0===t?void 0:t.isInSnippet())?i=!0:"never"===o.selectionMode||"always"===o.selectionMode?i="never"===o.selectionMode:"whenTriggerCharacter"===o.selectionMode?i=1!==e.triggerOptions.triggerKind:"whenQuickSuggestion"===o.selectionMode&&(i=1===e.triggerOptions.triggerKind&&!e.triggerOptions.refilter)}this.widget.value.showSuggestions(e.completionModel,o,e.isFrozen,e.triggerOptions.auto,i)}))),this._toDispose.add(this.model.onDidCancel((e=>{e.retrigger||this.widget.value.hideWidget()}))),this._toDispose.add(this.editor.onDidBlurEditorWidget((()=>{this.model.cancel(),this.model.clear()})));const a=SuggestContext.AcceptSuggestionsOnEnter.bindTo(i),d=()=>{const e=this.editor.getOption(1);a.set("on"===e||"smart"===e)};this._toDispose.add(this.editor.onDidChangeConfiguration((()=>d()))),d()}dispose(){this._alternatives.dispose(),this._toDispose.dispose(),this.widget.dispose(),this.model.dispose(),this._lineSuffix.dispose()}_insertSuggestion(e,t){if(!e||!e.item)return this._alternatives.value.reset(),this.model.cancel(),void this.model.clear();if(!this.editor.hasModel())return;const o=SnippetController2.get(this.editor);if(!o)return;const i=this.editor.getModel(),s=i.getAlternativeVersionId(),{item:r}=e,n=[],g=new CancellationTokenSource;1&t||this.editor.pushUndoStop();const a=this.getOverwriteInfo(r,Boolean(8&t));if(this._memoryService.memorize(i,this.editor.getPosition(),r),Array.isArray(r.completion.additionalTextEdits)){const e=StableEditorScrollState.capture(this.editor);this.editor.executeEdits("suggestController.additionalTextEdits.sync",r.completion.additionalTextEdits.map((e=>EditOperation.replaceMove(Range.lift(e.range),e.text)))),e.restoreRelativeVerticalPositionOfCursor(this.editor)}else if(!r.isResolved){const e=new StopWatch(!0);let o;const s=i.onDidChangeContent((e=>{if(e.isFlush)return g.cancel(),void s.dispose();for(const t of e.changes){const e=Range.getEndPosition(t.range);o&&!Position.isBefore(e,o)||(o=e)}})),a=t;t|=2;let d=!1;const l=this.editor.onWillType((()=>{l.dispose(),d=!0,2&a||this.editor.pushUndoStop()}));n.push(r.resolve(g.token).then((()=>{if(!r.completion.additionalTextEdits||g.token.isCancellationRequested)return!1;if(o&&r.completion.additionalTextEdits.some((e=>Position.isBefore(o,Range.getStartPosition(e.range)))))return!1;d&&this.editor.pushUndoStop();const e=StableEditorScrollState.capture(this.editor);return this.editor.executeEdits("suggestController.additionalTextEdits.async",r.completion.additionalTextEdits.map((e=>EditOperation.replaceMove(Range.lift(e.range),e.text)))),e.restoreRelativeVerticalPositionOfCursor(this.editor),!d&&2&a||this.editor.pushUndoStop(),!0})).then((t=>{this._logService.trace("[suggest] async resolving of edits DONE (ms, applied?)",e.elapsed(),t),s.dispose(),l.dispose()})))}let{insertText:d}=r.completion;4&r.completion.insertTextRules||(d=SnippetParser.escape(d)),this.model.cancel(),o.insert(d,{overwriteBefore:a.overwriteBefore,overwriteAfter:a.overwriteAfter,undoStopBefore:!1,undoStopAfter:!1,adjustWhitespace:!(1&r.completion.insertTextRules),clipboardText:e.model.clipboardText,overtypingCapturer:this._overtypingCapturer.value}),2&t||this.editor.pushUndoStop(),r.completion.command&&(r.completion.command.id===TriggerSuggestAction.id?this.model.trigger({auto:!0,retrigger:!0}):n.push(this._commandService.executeCommand(r.completion.command.id,...r.completion.command.arguments?[...r.completion.command.arguments]:[]).catch(onUnexpectedError))),4&t&&this._alternatives.value.set(e,(e=>{for(g.cancel();i.canUndo();){s!==i.getAlternativeVersionId()&&i.undo(),this._insertSuggestion(e,3|(8&t?8:0));break}})),this._alertCompletionItem(r),Promise.all(n).finally((()=>{this._reportSuggestionAcceptedTelemetry(r,i,e),this.model.clear(),g.dispose()}))}_reportSuggestionAcceptedTelemetry(e,t,o){var i;if(this._telemetryGate++%100!=0)return;const s=e.extensionId?e.extensionId.value:(null!==(i=o.item.provider._debugDisplayName)&&void 0!==i?i:"unknown").split("(",1)[0].toLowerCase();this._telemetryService.publicLog2("suggest.acceptedSuggestion",{providerId:s,kind:e.completion.kind,basenameHash:hash(basename(t.uri)).toString(16),languageId:t.getLanguageId(),fileExtension:extname(t.uri)})}getOverwriteInfo(e,t){assertType(this.editor.hasModel());let o="replace"===this.editor.getOption(112).insertMode;t&&(o=!o);const i=e.position.column-e.editStart.column,s=(o?e.editReplaceEnd.column:e.editInsertEnd.column)-e.position.column;return{overwriteBefore:i+(this.editor.getPosition().column-e.position.column),overwriteAfter:s+(this._lineSuffix.value?this._lineSuffix.value.delta(this.editor.getPosition()):0)}}_alertCompletionItem(e){if(isNonEmptyArray(e.completion.additionalTextEdits)){const t=nls.localize("aria.alert.snippet","Accepting '{0}' made {1} additional edits",e.textLabel,e.completion.additionalTextEdits.length);alert(t)}}triggerSuggest(e,t,o){this.editor.hasModel()&&(this.model.trigger({auto:null!=t&&t,completionOptions:{providerFilter:e,kindFilter:o?new Set:void 0}}),this.editor.revealPosition(this.editor.getPosition(),0),this.editor.focus())}triggerSuggestAndAcceptBest(e){if(!this.editor.hasModel())return;const t=this.editor.getPosition(),o=()=>{t.equals(this.editor.getPosition())&&this._commandService.executeCommand(e.fallback)},i=e=>{if(4&e.completion.insertTextRules||e.completion.additionalTextEdits)return!0;const t=this.editor.getPosition(),o=e.editStart.column,i=t.column;return i-o!==e.completion.insertText.length||this.editor.getModel().getValueInRange({startLineNumber:t.lineNumber,startColumn:o,endLineNumber:t.lineNumber,endColumn:i})!==e.completion.insertText};Event.once(this.model.onDidTrigger)((e=>{const t=[];Event.any(this.model.onDidTrigger,this.model.onDidCancel)((()=>{dispose(t),o()}),void 0,t),this.model.onDidSuggest((({completionModel:e})=>{if(dispose(t),0===e.items.length)return void o();const s=this._memoryService.select(this.editor.getModel(),this.editor.getPosition(),e.items),r=e.items[s];i(r)?(this.editor.pushUndoStop(),this._insertSuggestion({index:s,item:r,model:e},7)):o()}),void 0,t)})),this.model.trigger({auto:!1,shy:!0}),this.editor.revealPosition(t,0),this.editor.focus()}acceptSelectedSuggestion(e,t){const o=this.widget.value.getFocusedItem();let i=0;e&&(i|=4),t&&(i|=8),this._insertSuggestion(o,i)}acceptNextSuggestion(){this._alternatives.value.next()}acceptPrevSuggestion(){this._alternatives.value.prev()}cancelSuggestWidget(){this.model.cancel(),this.model.clear(),this.widget.value.hideWidget()}focusSuggestion(){this.widget.value.focusSelected()}selectNextSuggestion(){this.widget.value.selectNext()}selectNextPageSuggestion(){this.widget.value.selectNextPage()}selectLastSuggestion(){this.widget.value.selectLast()}selectPrevSuggestion(){this.widget.value.selectPrevious()}selectPrevPageSuggestion(){this.widget.value.selectPreviousPage()}selectFirstSuggestion(){this.widget.value.selectFirst()}toggleSuggestionDetails(){this.widget.value.toggleDetails()}toggleExplainMode(){this.widget.value.toggleExplainMode()}toggleSuggestionFocus(){this.widget.value.toggleDetailsFocus()}resetWidgetSize(){this.widget.value.resetPersistedSize()}forceRenderingAbove(){this.widget.value.forceRenderingAbove()}stopForceRenderingAbove(){this.widget.isInitialized&&this.widget.value.stopForceRenderingAbove()}registerSelector(e){return this._selectors.register(e)}};SuggestController.ID="editor.contrib.suggestController",SuggestController=__decorate([__param(1,ISuggestMemoryService),__param(2,ICommandService),__param(3,IContextKeyService),__param(4,IInstantiationService),__param(5,ILogService),__param(6,ITelemetryService)],SuggestController);export{SuggestController};class PriorityRegistry{constructor(e){this.prioritySelector=e,this._items=new Array}register(e){if(-1!==this._items.indexOf(e))throw new Error("Value is already registered");return this._items.push(e),this._items.sort(((e,t)=>this.prioritySelector(t)-this.prioritySelector(e))),{dispose:()=>{const t=this._items.indexOf(e);t>=0&&this._items.splice(t,1)}}}get itemsOrderedByPriorityDesc(){return this._items}}class TriggerSuggestAction extends EditorAction{constructor(){super({id:TriggerSuggestAction.id,label:nls.localize("suggest.trigger.label","Trigger Suggest"),alias:"Trigger Suggest",precondition:ContextKeyExpr.and(EditorContextKeys.writable,EditorContextKeys.hasCompletionItemProvider,SuggestContext.Visible.toNegated()),kbOpts:{kbExpr:EditorContextKeys.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[521,2087]},weight:100}})}run(e,t,o){const i=SuggestController.get(t);if(!i)return;let s;o&&"object"==typeof o&&!0===o.auto&&(s=!0),i.triggerSuggest(void 0,s,void 0)}}TriggerSuggestAction.id="editor.action.triggerSuggest";export{TriggerSuggestAction};registerEditorContribution(SuggestController.ID,SuggestController,2),registerEditorAction(TriggerSuggestAction);const weight=190,SuggestCommand=EditorCommand.bindToContribution(SuggestController.get);registerEditorCommand(new SuggestCommand({id:"acceptSelectedSuggestion",precondition:ContextKeyExpr.and(SuggestContext.Visible,SuggestContext.HasFocusedSuggestion),handler(e){e.acceptSelectedSuggestion(!0,!1)},kbOpts:[{primary:2,kbExpr:ContextKeyExpr.and(SuggestContext.Visible,EditorContextKeys.textInputFocus),weight:190},{primary:3,kbExpr:ContextKeyExpr.and(SuggestContext.Visible,EditorContextKeys.textInputFocus,SuggestContext.AcceptSuggestionsOnEnter,SuggestContext.MakesTextEdit),weight:190}],menuOpts:[{menuId:suggestWidgetStatusbarMenu,title:nls.localize("accept.insert","Insert"),group:"left",order:1,when:SuggestContext.HasInsertAndReplaceRange.toNegated()},{menuId:suggestWidgetStatusbarMenu,title:nls.localize("accept.insert","Insert"),group:"left",order:1,when:ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange,SuggestContext.InsertMode.isEqualTo("insert"))},{menuId:suggestWidgetStatusbarMenu,title:nls.localize("accept.replace","Replace"),group:"left",order:1,when:ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange,SuggestContext.InsertMode.isEqualTo("replace"))}]})),registerEditorCommand(new SuggestCommand({id:"acceptAlternativeSelectedSuggestion",precondition:ContextKeyExpr.and(SuggestContext.Visible,EditorContextKeys.textInputFocus,SuggestContext.HasFocusedSuggestion),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:1027,secondary:[1026]},handler(e){e.acceptSelectedSuggestion(!1,!0)},menuOpts:[{menuId:suggestWidgetStatusbarMenu,group:"left",order:2,when:ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange,SuggestContext.InsertMode.isEqualTo("insert")),title:nls.localize("accept.replace","Replace")},{menuId:suggestWidgetStatusbarMenu,group:"left",order:2,when:ContextKeyExpr.and(SuggestContext.HasInsertAndReplaceRange,SuggestContext.InsertMode.isEqualTo("replace")),title:nls.localize("accept.insert","Insert")}]})),CommandsRegistry.registerCommandAlias("acceptSelectedSuggestionOnEnter","acceptSelectedSuggestion"),registerEditorCommand(new SuggestCommand({id:"hideSuggestWidget",precondition:SuggestContext.Visible,handler:e=>e.cancelSuggestWidget(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}})),registerEditorCommand(new SuggestCommand({id:"selectNextSuggestion",precondition:ContextKeyExpr.and(SuggestContext.Visible,SuggestContext.MultipleSuggestions),handler:e=>e.selectNextSuggestion(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:18,secondary:[2066],mac:{primary:18,secondary:[2066,300]}}})),registerEditorCommand(new SuggestCommand({id:"selectNextPageSuggestion",precondition:ContextKeyExpr.and(SuggestContext.Visible,SuggestContext.MultipleSuggestions),handler:e=>e.selectNextPageSuggestion(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:12,secondary:[2060]}})),registerEditorCommand(new SuggestCommand({id:"selectLastSuggestion",precondition:ContextKeyExpr.and(SuggestContext.Visible,SuggestContext.MultipleSuggestions),handler:e=>e.selectLastSuggestion()})),registerEditorCommand(new SuggestCommand({id:"selectPrevSuggestion",precondition:ContextKeyExpr.and(SuggestContext.Visible,SuggestContext.MultipleSuggestions),handler:e=>e.selectPrevSuggestion(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:16,secondary:[2064],mac:{primary:16,secondary:[2064,302]}}})),registerEditorCommand(new SuggestCommand({id:"selectPrevPageSuggestion",precondition:ContextKeyExpr.and(SuggestContext.Visible,SuggestContext.MultipleSuggestions),handler:e=>e.selectPrevPageSuggestion(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:11,secondary:[2059]}})),registerEditorCommand(new SuggestCommand({id:"selectFirstSuggestion",precondition:ContextKeyExpr.and(SuggestContext.Visible,SuggestContext.MultipleSuggestions),handler:e=>e.selectFirstSuggestion()})),registerEditorCommand(new SuggestCommand({id:"focusSuggestion",precondition:ContextKeyExpr.and(SuggestContext.Visible,SuggestContext.HasFocusedSuggestion.negate(),ContextKeyExpr.equals("config.editor.suggest.selectQuickSuggestions",!1)),handler:e=>e.focusSuggestion(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}}})),registerEditorCommand(new SuggestCommand({id:"toggleSuggestionDetails",precondition:ContextKeyExpr.and(SuggestContext.Visible,SuggestContext.HasFocusedSuggestion),handler:e=>e.toggleSuggestionDetails(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:2058,secondary:[2087],mac:{primary:266,secondary:[2087]}},menuOpts:[{menuId:suggestWidgetStatusbarMenu,group:"right",order:1,when:ContextKeyExpr.and(SuggestContext.DetailsVisible,SuggestContext.CanResolve),title:nls.localize("detail.more","show less")},{menuId:suggestWidgetStatusbarMenu,group:"right",order:1,when:ContextKeyExpr.and(SuggestContext.DetailsVisible.toNegated(),SuggestContext.CanResolve),title:nls.localize("detail.less","show more")}]})),registerEditorCommand(new SuggestCommand({id:"toggleExplainMode",precondition:SuggestContext.Visible,handler:e=>e.toggleExplainMode(),kbOpts:{weight:100,primary:2133}})),registerEditorCommand(new SuggestCommand({id:"toggleSuggestionFocus",precondition:SuggestContext.Visible,handler:e=>e.toggleSuggestionFocus(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:2570,mac:{primary:778}}})),registerEditorCommand(new SuggestCommand({id:"insertBestCompletion",precondition:ContextKeyExpr.and(EditorContextKeys.textInputFocus,ContextKeyExpr.equals("config.editor.tabCompletion","on"),WordContextKey.AtEnd,SuggestContext.Visible.toNegated(),SuggestAlternatives.OtherSuggestions.toNegated(),SnippetController2.InSnippetMode.toNegated()),handler:(e,t)=>{e.triggerSuggestAndAcceptBest(isObject(t)?Object.assign({fallback:"tab"},t):{fallback:"tab"})},kbOpts:{weight:190,primary:2}})),registerEditorCommand(new SuggestCommand({id:"insertNextSuggestion",precondition:ContextKeyExpr.and(EditorContextKeys.textInputFocus,ContextKeyExpr.equals("config.editor.tabCompletion","on"),SuggestAlternatives.OtherSuggestions,SuggestContext.Visible.toNegated(),SnippetController2.InSnippetMode.toNegated()),handler:e=>e.acceptNextSuggestion(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:2}})),registerEditorCommand(new SuggestCommand({id:"insertPrevSuggestion",precondition:ContextKeyExpr.and(EditorContextKeys.textInputFocus,ContextKeyExpr.equals("config.editor.tabCompletion","on"),SuggestAlternatives.OtherSuggestions,SuggestContext.Visible.toNegated(),SnippetController2.InSnippetMode.toNegated()),handler:e=>e.acceptPrevSuggestion(),kbOpts:{weight:190,kbExpr:EditorContextKeys.textInputFocus,primary:1026}})),registerEditorAction(class extends EditorAction{constructor(){super({id:"editor.action.resetSuggestSize",label:nls.localize("suggest.reset.label","Reset Suggest Widget Size"),alias:"Reset Suggest Widget Size",precondition:void 0})}run(e,t){var o;null===(o=SuggestController.get(t))||void 0===o||o.resetWidgetSize()}});