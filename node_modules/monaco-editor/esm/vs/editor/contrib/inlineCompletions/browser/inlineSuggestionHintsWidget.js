var __decorate=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},__param=this&&this.__param||function(e,t){return function(i,o){t(i,o,e)}};import{h}from"../../../../base/browser/dom.js";import{ActionBar}from"../../../../base/browser/ui/actionbar/actionbar.js";import{KeybindingLabel}from"../../../../base/browser/ui/keybindingLabel/keybindingLabel.js";import{Action,Separator}from"../../../../base/common/actions.js";import{RunOnceScheduler}from"../../../../base/common/async.js";import{Codicon}from"../../../../base/common/codicons.js";import{Disposable}from"../../../../base/common/lifecycle.js";import{OS}from"../../../../base/common/platform.js";import{ThemeIcon}from"../../../../base/common/themables.js";import"./inlineSuggestionHintsWidget.css";import{showNextInlineSuggestionActionId,showPreviousInlineSuggestionActionId}from"./consts.js";import{localize}from"../../../../nls.js";import{createAndFillInActionBarActions,MenuEntryActionViewItem}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{WorkbenchToolBar}from"../../../../platform/actions/browser/toolbar.js";import{IMenuService,MenuId,MenuItemAction}from"../../../../platform/actions/common/actions.js";import{ICommandService}from"../../../../platform/commands/common/commands.js";import{IContextKeyService}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService}from"../../../../platform/keybinding/common/keybinding.js";import{ITelemetryService}from"../../../../platform/telemetry/common/telemetry.js";import{registerIcon}from"../../../../platform/theme/common/iconRegistry.js";const inlineSuggestionHintsNextIcon=registerIcon("inline-suggestion-hints-next",Codicon.chevronRight,localize("parameterHintsNextIcon","Icon for show next parameter hint.")),inlineSuggestionHintsPreviousIcon=registerIcon("inline-suggestion-hints-previous",Codicon.chevronLeft,localize("parameterHintsPreviousIcon","Icon for show previous parameter hint."));let InlineSuggestionHintsContentWidget=class e extends Disposable{static get dropDownVisible(){return this._dropDownVisible}createCommandAction(e,t,i){const o=new Action(e,t,i,!0,(()=>this._commandService.executeCommand(e))),n=this.keybindingService.lookupKeybinding(e,this._contextKeyService);let s=t;return n&&(s=localize({key:"content",comment:["A label","A keybinding"]},"{0} ({1})",t,n.getLabel())),o.tooltip=s,o}constructor(t,i,o,n,s,r,a){super(),this.editor=t,this.withBorder=i,this._commandService=o,this.keybindingService=s,this._contextKeyService=r,this._menuService=a,this.id="InlineSuggestionHintsContentWidget"+e.id++,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this.nodes=h("div.inlineSuggestionsHints",{className:this.withBorder?".withBorder":""},[h("div",{style:{display:"flex"}},[h("div@actionBar",{className:"custom-actions"}),h("div@toolBar")])]),this.position=null,this.previousAction=this.createCommandAction(showPreviousInlineSuggestionActionId,localize("previous","Previous"),ThemeIcon.asClassName(inlineSuggestionHintsPreviousIcon)),this.availableSuggestionCountAction=new Action("inlineSuggestionHints.availableSuggestionCount","",void 0,!1),this.nextAction=this.createCommandAction(showNextInlineSuggestionActionId,localize("next","Next"),ThemeIcon.asClassName(inlineSuggestionHintsNextIcon)),this.inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(MenuId.InlineCompletionsActions,this._contextKeyService)),this.clearAvailableSuggestionCountLabelDebounced=this._register(new RunOnceScheduler((()=>{this.availableSuggestionCountAction.label=""}),100)),this.disableButtonsDebounced=this._register(new RunOnceScheduler((()=>{this.previousAction.enabled=this.nextAction.enabled=!1}),100));const c=this._register(new ActionBar(this.nodes.actionBar));c.push(this.previousAction,{icon:!0,label:!1}),c.push(this.availableSuggestionCountAction),c.push(this.nextAction,{icon:!0,label:!1}),this.toolBar=this._register(n.createInstance(CustomizedMenuWorkbenchToolBar,this.nodes.toolBar,MenuId.InlineSuggestionToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:e=>e.startsWith("primary")},actionViewItemProvider:(e,t)=>e instanceof MenuItemAction?n.createInstance(StatusBarViewItem,e,void 0):void 0,telemetrySource:"InlineSuggestionToolbar"})),this._register(this.toolBar.onDidChangeDropdownVisibility((t=>{e._dropDownVisible=t})))}update(e,t,i,o){this.position=e,void 0!==i&&i>1?(this.disableButtonsDebounced.cancel(),this.previousAction.enabled=this.nextAction.enabled=!0):this.disableButtonsDebounced.schedule(),void 0!==i?(this.clearAvailableSuggestionCountLabelDebounced.cancel(),this.availableSuggestionCountAction.label=`${t+1}/${i}`):this.clearAvailableSuggestionCountLabelDebounced.schedule(),this.editor.layoutContentWidget(this);const n=o.map((e=>({class:void 0,id:e.id,enabled:!0,tooltip:e.tooltip||"",label:e.title,run:t=>this._commandService.executeCommand(e.id)})));for(const[e,t]of this.inlineCompletionsActionsMenus.getActions())for(const e of t)e instanceof MenuItemAction&&n.push(e);n.length>0&&n.unshift(new Separator),this.toolBar.setAdditionalSecondaryActions(n)}getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this.position,preference:[1,2],positionAffinity:3}}};InlineSuggestionHintsContentWidget._dropDownVisible=!1,InlineSuggestionHintsContentWidget.id=0,InlineSuggestionHintsContentWidget=__decorate([__param(2,ICommandService),__param(3,IInstantiationService),__param(4,IKeybindingService),__param(5,IContextKeyService),__param(6,IMenuService)],InlineSuggestionHintsContentWidget);export{InlineSuggestionHintsContentWidget};class StatusBarViewItem extends MenuEntryActionViewItem{updateLabel(){const e=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService);if(!e)return super.updateLabel();if(this.label){const t=h("div.keybinding").root;new KeybindingLabel(t,OS,{disableTitle:!0}).set(e),this.label.textContent=this._action.label,this.label.appendChild(t),this.label.classList.add("inlineSuggestionStatusBarItemLabel")}}}let CustomizedMenuWorkbenchToolBar=class extends WorkbenchToolBar{constructor(e,t,i,o,n,s,r,a){super(e,Object.assign({resetMenu:t},i),o,n,s,r,a),this.menuId=t,this.options2=i,this.menuService=o,this.contextKeyService=n,this.menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0})),this.additionalActions=[],this._store.add(this.menu.onDidChange((()=>this.updateToolbar()))),this.updateToolbar()}updateToolbar(){var e,t,i,o,n,s,r;const a=[],c=[];createAndFillInActionBarActions(this.menu,null===(e=this.options2)||void 0===e?void 0:e.menuOptions,{primary:a,secondary:c},null===(i=null===(t=this.options2)||void 0===t?void 0:t.toolbarOptions)||void 0===i?void 0:i.primaryGroup,null===(n=null===(o=this.options2)||void 0===o?void 0:o.toolbarOptions)||void 0===n?void 0:n.shouldInlineSubmenu,null===(r=null===(s=this.options2)||void 0===s?void 0:s.toolbarOptions)||void 0===r?void 0:r.useSeparatorsInPrimaryActions),c.push(...this.additionalActions),this.setActions(a,c)}setAdditionalSecondaryActions(e){this.additionalActions=e,this.updateToolbar()}};CustomizedMenuWorkbenchToolBar=__decorate([__param(3,IMenuService),__param(4,IContextKeyService),__param(5,IContextMenuService),__param(6,IKeybindingService),__param(7,ITelemetryService)],CustomizedMenuWorkbenchToolBar);export{CustomizedMenuWorkbenchToolBar};