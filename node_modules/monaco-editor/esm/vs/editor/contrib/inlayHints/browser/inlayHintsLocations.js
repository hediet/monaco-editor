var __awaiter=this&&this.__awaiter||function(e,o,t,i){return new(t||(t=Promise))((function(n,r){function a(e){try{m(i.next(e))}catch(e){r(e)}}function c(e){try{m(i.throw(e))}catch(e){r(e)}}function m(e){var o;e.done?n(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(a,c)}m((i=i.apply(e,o||[])).next())}))};import*as dom from"../../../../base/browser/dom.js";import{Action,Separator}from"../../../../base/common/actions.js";import{CancellationToken}from"../../../../base/common/cancellation.js";import{Range}from"../../../common/core/range.js";import{ITextModelService}from"../../../common/services/resolverService.js";import{DefinitionAction,SymbolNavigationAction,SymbolNavigationAnchor}from"../../gotoSymbol/browser/goToCommands.js";import{PeekContext}from"../../peekView/browser/peekView.js";import{isIMenuItem,MenuId,MenuItemAction,MenuRegistry}from"../../../../platform/actions/common/actions.js";import{ICommandService}from"../../../../platform/commands/common/commands.js";import{IContextKeyService}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService}from"../../../../platform/instantiation/common/instantiation.js";import{INotificationService,Severity}from"../../../../platform/notification/common/notification.js";export function showGoToContextMenu(e,o,t,i){var n;return __awaiter(this,void 0,void 0,(function*(){const r=e.get(ITextModelService),a=e.get(IContextMenuService),c=e.get(ICommandService),m=e.get(IInstantiationService),s=e.get(INotificationService);if(yield i.item.resolve(CancellationToken.None),!i.part.location)return;const d=i.part.location,l=[],f=new Set(MenuRegistry.getMenuItems(MenuId.EditorContext).map((e=>isIMenuItem(e)?e.command.id:"")));for(const e of SymbolNavigationAction.all())f.has(e.desc.id)&&l.push(new Action(e.desc.id,MenuItemAction.label(e.desc,{renderShortTitle:!0}),void 0,!0,(()=>__awaiter(this,void 0,void 0,(function*(){const t=yield r.createModelReference(d.uri);try{yield m.invokeFunction(e.run.bind(e),o,new SymbolNavigationAnchor(t.object.textEditorModel,Range.getStartPosition(d.range)))}finally{t.dispose()}})))));if(i.part.command){const{command:e}=i.part;l.push(new Separator),l.push(new Action(e.id,e.title,void 0,!0,(()=>__awaiter(this,void 0,void 0,(function*(){var o;try{yield c.executeCommand(e.id,...null!==(o=e.arguments)&&void 0!==o?o:[])}catch(e){s.notify({severity:Severity.Error,source:i.item.provider.displayName,message:e})}})))))}const u=o.getOption(121);a.showContextMenu({domForShadowRoot:u&&null!==(n=o.getDomNode())&&void 0!==n?n:void 0,getAnchor:()=>{const e=dom.getDomNodePagePosition(t);return{x:e.left,y:e.top+e.height+8}},getActions:()=>l,onHide:()=>{o.focus()},autoSelectFirstItem:!0})}))}export function goToDefinitionWithLocation(e,o,t,i){return __awaiter(this,void 0,void 0,(function*(){const n=e.get(ITextModelService),r=yield n.createModelReference(i.uri);yield t.invokeWithinContext((e=>__awaiter(this,void 0,void 0,(function*(){const n=o.hasSideBySideModifier,a=e.get(IContextKeyService),c=PeekContext.inPeekEditor.getValue(a),m=!n&&t.getOption(83)&&!c;return new DefinitionAction({openToSide:n,openInPeek:m,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(e,new SymbolNavigationAnchor(r.object.textEditorModel,Range.getStartPosition(i.range)),Range.lift(i.range))})))),r.dispose()}))}