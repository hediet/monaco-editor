var __decorate=this&&this.__decorate||function(e,t,r,n){var o,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(a=(i<3?o(a):i>3?o(t,r,a):o(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},__param=this&&this.__param||function(e,t){return function(r,n){t(r,n,e)}},__awaiter=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function a(e){try{l(n.next(e))}catch(e){i(e)}}function c(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,c)}l((n=n.apply(e,t||[])).next())}))},__asyncValues=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,o){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,o,(t=e[r](t)).done,t.value)}))}}};import{AsyncIterableObject}from"../../../../base/common/async.js";import{isEmptyMarkdownString,MarkdownString}from"../../../../base/common/htmlContent.js";import{Position}from"../../../common/core/position.js";import{ModelDecorationInjectedTextOptions}from"../../../common/model/textModel.js";import{HoverForeignElementAnchor}from"../../hover/browser/hoverTypes.js";import{ILanguageService}from"../../../common/languages/language.js";import{ITextModelService}from"../../../common/services/resolverService.js";import{getHover}from"../../hover/browser/getHover.js";import{MarkdownHover,MarkdownHoverParticipant}from"../../hover/browser/markdownHoverParticipant.js";import{RenderedInlayHintLabelPart,InlayHintsController}from"./inlayHintsController.js";import{IConfigurationService}from"../../../../platform/configuration/common/configuration.js";import{IOpenerService}from"../../../../platform/opener/common/opener.js";import{ILanguageFeaturesService}from"../../../common/services/languageFeatures.js";import{localize}from"../../../../nls.js";import*as platform from"../../../../base/common/platform.js";import{asCommandLink}from"./inlayHints.js";import{isNonEmptyArray}from"../../../../base/common/arrays.js";class InlayHintsHoverAnchor extends HoverForeignElementAnchor{constructor(e,t,r,n){super(10,t,e.item.anchor.range,r,n,!0),this.part=e}}let InlayHintsHover=class extends MarkdownHoverParticipant{constructor(e,t,r,n,o,i){super(e,t,r,n,i),this._resolverService=o,this.hoverOrdinal=6}suggestHoverAnchor(e){var t;if(!InlayHintsController.get(this._editor))return null;if(6!==e.target.type)return null;const r=null===(t=e.target.detail.injectedText)||void 0===t?void 0:t.options;return r instanceof ModelDecorationInjectedTextOptions&&r.attachedData instanceof RenderedInlayHintLabelPart?new InlayHintsHoverAnchor(r.attachedData,this,e.event.posx,e.event.posy):null}computeSync(){return[]}computeAsync(e,t,r){return e instanceof InlayHintsHoverAnchor?new AsyncIterableObject((t=>__awaiter(this,void 0,void 0,(function*(){var n,o,i,a;const{part:c}=e;if(yield c.item.resolve(r),r.isCancellationRequested)return;let l,s;if("string"==typeof c.item.hint.tooltip?l=(new MarkdownString).appendText(c.item.hint.tooltip):c.item.hint.tooltip&&(l=c.item.hint.tooltip),l&&t.emitOne(new MarkdownHover(this,e.range,[l],!1,0)),isNonEmptyArray(c.item.hint.textEdits)&&t.emitOne(new MarkdownHover(this,e.range,[(new MarkdownString).appendText(localize("hint.dbl","Double-click to insert"))],!1,10001)),"string"==typeof c.part.tooltip?s=(new MarkdownString).appendText(c.part.tooltip):c.part.tooltip&&(s=c.part.tooltip),s&&t.emitOne(new MarkdownHover(this,e.range,[s],!1,1)),c.part.location||c.part.command){let r;const n="altKey"===this._editor.getOption(74)?platform.isMacintosh?localize("links.navigate.kb.meta.mac","cmd + click"):localize("links.navigate.kb.meta","ctrl + click"):platform.isMacintosh?localize("links.navigate.kb.alt.mac","option + click"):localize("links.navigate.kb.alt","alt + click");c.part.location&&c.part.command?r=(new MarkdownString).appendText(localize("hint.defAndCommand","Go to Definition ({0}), right click for more",n)):c.part.location?r=(new MarkdownString).appendText(localize("hint.def","Go to Definition ({0})",n)):c.part.command&&(r=new MarkdownString(`[${localize("hint.cmd","Execute Command")}](${asCommandLink(c.part.command)} "${c.part.command.title}") (${n})`,{isTrusted:!0})),r&&t.emitOne(new MarkdownHover(this,e.range,[r],!1,1e4))}const m=yield this._resolveInlayHintLabelPartHover(c,r);try{for(var p,d=!0,v=__asyncValues(m);!(n=(p=yield v.next()).done);){a=p.value,d=!1;try{const e=a;t.emitOne(e)}finally{d=!0}}}catch(e){o={error:e}}finally{try{d||n||!(i=v.return)||(yield i.call(v))}finally{if(o)throw o.error}}})))):AsyncIterableObject.EMPTY}_resolveInlayHintLabelPartHover(e,t){return __awaiter(this,void 0,void 0,(function*(){if(!e.part.location)return AsyncIterableObject.EMPTY;const{uri:r,range:n}=e.part.location,o=yield this._resolverService.createModelReference(r);try{const r=o.object.textEditorModel;return this._languageFeaturesService.hoverProvider.has(r)?getHover(this._languageFeaturesService.hoverProvider,r,new Position(n.startLineNumber,n.startColumn),t).filter((e=>!isEmptyMarkdownString(e.hover.contents))).map((t=>new MarkdownHover(this,e.item.anchor.range,t.hover.contents,!1,2+t.ordinal))):AsyncIterableObject.EMPTY}finally{o.dispose()}}))}};InlayHintsHover=__decorate([__param(1,ILanguageService),__param(2,IOpenerService),__param(3,IConfigurationService),__param(4,ITextModelService),__param(5,ILanguageFeaturesService)],InlayHintsHover);export{InlayHintsHover};