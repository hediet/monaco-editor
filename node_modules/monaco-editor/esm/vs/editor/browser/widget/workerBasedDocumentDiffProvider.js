var __decorate=this&&this.__decorate||function(i,t,e,r){var o,n=arguments.length,f=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)f=Reflect.decorate(i,t,e,r);else for(var s=i.length-1;s>=0;s--)(o=i[s])&&(f=(n<3?o(f):n>3?o(t,e,f):o(t,e))||f);return n>3&&f&&Object.defineProperty(t,e,f),f},__param=this&&this.__param||function(i,t){return function(e,r){t(e,r,i)}},__awaiter=this&&this.__awaiter||function(i,t,e,r){return new(e||(e=Promise))((function(o,n){function f(i){try{h(r.next(i))}catch(i){n(i)}}function s(i){try{h(r.throw(i))}catch(i){n(i)}}function h(i){var t;i.done?o(i.value):(t=i.value,t instanceof e?t:new e((function(i){i(t)}))).then(f,s)}h((r=r.apply(i,t||[])).next())}))};import{Emitter}from"../../../base/common/event.js";import{IEditorWorkerService}from"../../common/services/editorWorker.js";let WorkerBasedDocumentDiffProvider=class{constructor(i,t){this.editorWorkerService=t,this.onDidChangeEventEmitter=new Emitter,this.onDidChange=this.onDidChangeEventEmitter.event,this.diffAlgorithm="smart",this.diffAlgorithmOnDidChangeSubscription=void 0,this.setOptions(i)}dispose(){var i;null===(i=this.diffAlgorithmOnDidChangeSubscription)||void 0===i||i.dispose()}computeDiff(i,t,e){return __awaiter(this,void 0,void 0,(function*(){if("string"!=typeof this.diffAlgorithm)return this.diffAlgorithm.computeDiff(i,t,e);const r=yield this.editorWorkerService.computeDiff(i.uri,t.uri,e,this.diffAlgorithm);if(!r)throw new Error("no diff result available");return r}))}setOptions(i){var t;let e=!1;i.diffAlgorithm&&this.diffAlgorithm!==i.diffAlgorithm&&(null===(t=this.diffAlgorithmOnDidChangeSubscription)||void 0===t||t.dispose(),this.diffAlgorithmOnDidChangeSubscription=void 0,this.diffAlgorithm=i.diffAlgorithm,"string"!=typeof i.diffAlgorithm&&(this.diffAlgorithmOnDidChangeSubscription=i.diffAlgorithm.onDidChange((()=>this.onDidChangeEventEmitter.fire()))),e=!0),e&&this.onDidChangeEventEmitter.fire()}};WorkerBasedDocumentDiffProvider=__decorate([__param(1,IEditorWorkerService)],WorkerBasedDocumentDiffProvider);export{WorkerBasedDocumentDiffProvider};