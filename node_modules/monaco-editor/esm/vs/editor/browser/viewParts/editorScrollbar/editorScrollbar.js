import*as dom from"../../../../base/browser/dom.js";import{createFastDomNode}from"../../../../base/browser/fastDomNode.js";import{SmoothScrollableElement}from"../../../../base/browser/ui/scrollbar/scrollableElement.js";import{PartFingerprints,ViewPart}from"../../view/viewPart.js";import{getThemeTypeSelector}from"../../../../platform/theme/common/themeService.js";export class EditorScrollbar extends ViewPart{constructor(e,o,t,r){super(e);const l=this._context.configuration.options,s=l.get(97),i=l.get(71),a=l.get(37),n=l.get(100),c={listenOnDomNode:t.domNode,className:"editor-scrollable "+getThemeTypeSelector(e.theme.type),useShadows:!1,lazyRender:!0,vertical:s.vertical,horizontal:s.horizontal,verticalHasArrows:s.verticalHasArrows,horizontalHasArrows:s.horizontalHasArrows,verticalScrollbarSize:s.verticalScrollbarSize,verticalSliderSize:s.verticalSliderSize,horizontalScrollbarSize:s.horizontalScrollbarSize,horizontalSliderSize:s.horizontalSliderSize,handleMouseWheel:s.handleMouseWheel,alwaysConsumeMouseWheel:s.alwaysConsumeMouseWheel,arrowSize:s.arrowSize,mouseWheelScrollSensitivity:i,fastScrollSensitivity:a,scrollPredominantAxis:n,scrollByPage:s.scrollByPage};this.scrollbar=this._register(new SmoothScrollableElement(o.domNode,c,this._context.viewLayout.getScrollable())),PartFingerprints.write(this.scrollbar.getDomNode(),5),this.scrollbarDomNode=createFastDomNode(this.scrollbar.getDomNode()),this.scrollbarDomNode.setPosition("absolute"),this._setLayout();const d=(e,o,t)=>{const r={};if(o){const o=e.scrollTop;o&&(r.scrollTop=this._context.viewLayout.getCurrentScrollTop()+o,e.scrollTop=0)}if(t){const o=e.scrollLeft;o&&(r.scrollLeft=this._context.viewLayout.getCurrentScrollLeft()+o,e.scrollLeft=0)}this._context.viewModel.viewLayout.setScrollPosition(r,1)};this._register(dom.addDisposableListener(t.domNode,"scroll",(e=>d(t.domNode,!0,!0)))),this._register(dom.addDisposableListener(o.domNode,"scroll",(e=>d(o.domNode,!0,!1)))),this._register(dom.addDisposableListener(r.domNode,"scroll",(e=>d(r.domNode,!0,!1)))),this._register(dom.addDisposableListener(this.scrollbarDomNode.domNode,"scroll",(e=>d(this.scrollbarDomNode.domNode,!0,!1))))}dispose(){super.dispose()}_setLayout(){const e=this._context.configuration.options,o=e.get(138);this.scrollbarDomNode.setLeft(o.contentLeft),"right"===e.get(69).side?this.scrollbarDomNode.setWidth(o.contentWidth+o.minimap.minimapWidth):this.scrollbarDomNode.setWidth(o.contentWidth),this.scrollbarDomNode.setHeight(o.height)}getOverviewRulerLayoutInfo(){return this.scrollbar.getOverviewRulerLayoutInfo()}getDomNode(){return this.scrollbarDomNode}delegateVerticalScrollbarPointerDown(e){this.scrollbar.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){this.scrollbar.delegateScrollFromMouseWheelEvent(e)}onConfigurationChanged(e){if(e.hasChanged(97)||e.hasChanged(71)||e.hasChanged(37)){const e=this._context.configuration.options,o=e.get(97),t=e.get(71),r=e.get(37),l=e.get(100),s={vertical:o.vertical,horizontal:o.horizontal,verticalScrollbarSize:o.verticalScrollbarSize,horizontalScrollbarSize:o.horizontalScrollbarSize,scrollByPage:o.scrollByPage,handleMouseWheel:o.handleMouseWheel,mouseWheelScrollSensitivity:t,fastScrollSensitivity:r,scrollPredominantAxis:l};this.scrollbar.updateOptions(s)}return e.hasChanged(138)&&this._setLayout(),!0}onScrollChanged(e){return!0}onThemeChanged(e){return this.scrollbar.updateClassName("editor-scrollable "+getThemeTypeSelector(this._context.theme.type)),!0}prepareRender(e){}render(e){this.scrollbar.renderNow()}}