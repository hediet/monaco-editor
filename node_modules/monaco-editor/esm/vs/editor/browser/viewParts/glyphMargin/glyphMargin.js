import"./glyphMargin.css";import{DynamicViewOverlay}from"../../view/dynamicViewOverlay.js";export class DecorationToRender{constructor(e,t,n){this._decorationToRenderBrand=void 0,this.startLineNumber=+e,this.endLineNumber=+t,this.className=String(n)}}export class DedupOverlay extends DynamicViewOverlay{_render(e,t,n){const r=[];for(let n=e;n<=t;n++)r[n-e]=[];if(0===n.length)return r;n.sort(((e,t)=>e.className===t.className?e.startLineNumber===t.startLineNumber?e.endLineNumber-t.endLineNumber:e.startLineNumber-t.startLineNumber:e.className<t.className?-1:1));let i=null,s=0;for(let o=0,a=n.length;o<a;o++){const a=n[o],h=a.className;let l=Math.max(a.startLineNumber,e)-e;const g=Math.min(a.endLineNumber,t)-e;i===h?(l=Math.max(s+1,l),s=Math.max(s,g)):(i=h,s=g);for(let e=l;e<=s;e++)r[e].push(i)}return r}}export class GlyphMarginOverlay extends DedupOverlay{constructor(e){super(),this._context=e;const t=this._context.configuration.options,n=t.get(138);this._lineHeight=t.get(63),this._glyphMargin=t.get(54),this._glyphMarginLeft=n.glyphMarginLeft,this._glyphMarginWidth=n.glyphMarginWidth,this._renderResult=null,this._context.addEventHandler(this)}dispose(){this._context.removeEventHandler(this),this._renderResult=null,super.dispose()}onConfigurationChanged(e){const t=this._context.configuration.options,n=t.get(138);return this._lineHeight=t.get(63),this._glyphMargin=t.get(54),this._glyphMarginLeft=n.glyphMarginLeft,this._glyphMarginWidth=n.glyphMarginWidth,!0}onDecorationsChanged(e){return!0}onFlushed(e){return!0}onLinesChanged(e){return!0}onLinesDeleted(e){return!0}onLinesInserted(e){return!0}onScrollChanged(e){return e.scrollTopChanged}onZonesChanged(e){return!0}_getDecorations(e){const t=e.getDecorationsInViewport(),n=[];let r=0;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.options.glyphMarginClassName;s&&(n[r++]=new DecorationToRender(i.range.startLineNumber,i.range.endLineNumber,s))}return n}prepareRender(e){if(!this._glyphMargin)return void(this._renderResult=null);const t=e.visibleRange.startLineNumber,n=e.visibleRange.endLineNumber,r=this._render(t,n,this._getDecorations(e)),i=this._lineHeight.toString(),s='" style="left:'+this._glyphMarginLeft.toString()+"px;width:"+this._glyphMarginWidth.toString()+"px;height:"+i+'px;"></div>',o=[];for(let e=t;e<=n;e++){const n=e-t,i=r[n];0===i.length?o[n]="":o[n]='<div class="cgmr codicon '+i.join(" ")+s}this._renderResult=o}render(e,t){if(!this._renderResult)return"";const n=t-e;return n<0||n>=this._renderResult.length?"":this._renderResult[n]}}