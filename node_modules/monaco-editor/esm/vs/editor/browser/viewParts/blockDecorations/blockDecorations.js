import{createFastDomNode}from"../../../../base/browser/fastDomNode.js";import"./blockDecorations.css";import{ViewPart}from"../../view/viewPart.js";export class BlockDecorations extends ViewPart{constructor(e){super(e),this.blocks=[],this.contentWidth=-1,this.domNode=createFastDomNode(document.createElement("div")),this.domNode.setAttribute("role","presentation"),this.domNode.setAttribute("aria-hidden","true"),this.domNode.setClassName("blockDecorations-container"),this.update()}update(){let e=!1;const t=this._context.configuration.options.get(138),o=t.contentWidth-t.verticalScrollbarWidth;return this.contentWidth!==o&&(this.contentWidth=o,e=!0),e}dispose(){super.dispose()}onConfigurationChanged(e){return this.update()}onScrollChanged(e){return e.scrollTopChanged||e.scrollLeftChanged}onDecorationsChanged(e){return!0}onZonesChanged(e){return!0}prepareRender(e){}render(e){let t=0;const o=e.getDecorationsInViewport();for(const r of o){if(!r.options.blockClassName)continue;let o,s,n=this.blocks[t];n||(n=this.blocks[t]=createFastDomNode(document.createElement("div")),this.domNode.appendChild(n)),r.options.blockIsAfterEnd?(o=e.getVerticalOffsetAfterLineNumber(r.range.endLineNumber,!1),s=e.getVerticalOffsetAfterLineNumber(r.range.endLineNumber,!0)):(o=e.getVerticalOffsetForLineNumber(r.range.startLineNumber,!0),s=r.range.isEmpty()?e.getVerticalOffsetForLineNumber(r.range.startLineNumber,!1):e.getVerticalOffsetAfterLineNumber(r.range.endLineNumber,!0)),n.setClassName("blockDecorations-block "+r.options.blockClassName),n.setLeft(e.scrollLeft),n.setWidth(this.contentWidth),n.setTop(o),n.setHeight(s-o),t++}for(let e=t;e<this.blocks.length;e++)this.blocks[e].domNode.remove();this.blocks.length=t}}