import{Position}from"./core/position.js";import{Range}from"./core/range.js";import{Selection}from"./core/selection.js";import{createScopedLineTokens}from"./languages/supports.js";import{CursorColumns}from"./core/cursorColumns.js";import{normalizeIndentation}from"./core/indentation.js";const autoCloseAlways=()=>!0,autoCloseNever=()=>!1,autoCloseBeforeWhitespace=t=>" "===t||"\t"===t;export class CursorConfiguration{static shouldRecreate(t){return t.hasChanged(138)||t.hasChanged(124)||t.hasChanged(34)||t.hasChanged(73)||t.hasChanged(75)||t.hasChanged(76)||t.hasChanged(5)||t.hasChanged(8)||t.hasChanged(6)||t.hasChanged(7)||t.hasChanged(11)||t.hasChanged(122)||t.hasChanged(47)||t.hasChanged(86)}constructor(t,e,i,o){this.languageConfigurationService=o,this._cursorMoveConfigurationBrand=void 0,this._languageId=t;const s=i.options,n=s.get(138),r=s.get(47);this.readOnly=s.get(86),this.tabSize=e.tabSize,this.indentSize=e.indentSize,this.insertSpaces=e.insertSpaces,this.stickyTabStops=s.get(110),this.lineHeight=r.lineHeight,this.typicalHalfwidthCharacterWidth=r.typicalHalfwidthCharacterWidth,this.pageSize=Math.max(1,Math.floor(n.height/this.lineHeight)-2),this.useTabStops=s.get(122),this.wordSeparators=s.get(124),this.emptySelectionClipboard=s.get(34),this.copyWithSyntaxHighlighting=s.get(22),this.multiCursorMergeOverlapping=s.get(73),this.multiCursorPaste=s.get(75),this.multiCursorLimit=s.get(76),this.autoClosingBrackets=s.get(5),this.autoClosingQuotes=s.get(8),this.autoClosingDelete=s.get(6),this.autoClosingOvertype=s.get(7),this.autoSurround=s.get(11),this.autoIndent=s.get(9),this.surroundingPairs={},this._electricChars=null,this.shouldAutoCloseBefore={quote:this._getShouldAutoClose(t,this.autoClosingQuotes,!0),bracket:this._getShouldAutoClose(t,this.autoClosingBrackets,!1)},this.autoClosingPairs=this.languageConfigurationService.getLanguageConfiguration(t).getAutoClosingPairs();const a=this.languageConfigurationService.getLanguageConfiguration(t).getSurroundingPairs();if(a)for(const t of a)this.surroundingPairs[t.open]=t.close}get electricChars(){var t;if(!this._electricChars){this._electricChars={};const e=null===(t=this.languageConfigurationService.getLanguageConfiguration(this._languageId).electricCharacter)||void 0===t?void 0:t.getElectricCharacters();if(e)for(const t of e)this._electricChars[t]=!0}return this._electricChars}onElectricCharacter(t,e,i){const o=createScopedLineTokens(e,i-1),s=this.languageConfigurationService.getLanguageConfiguration(o.languageId).electricCharacter;return s?s.onElectricCharacter(t,o,i-o.firstCharOffset):null}normalizeIndentation(t){return normalizeIndentation(t,this.indentSize,this.insertSpaces)}_getShouldAutoClose(t,e,i){switch(e){case"beforeWhitespace":return autoCloseBeforeWhitespace;case"languageDefined":return this._getLanguageDefinedShouldAutoClose(t,i);case"always":return autoCloseAlways;case"never":return autoCloseNever}}_getLanguageDefinedShouldAutoClose(t,e){const i=this.languageConfigurationService.getLanguageConfiguration(t).getAutoCloseBeforeSet(e);return t=>-1!==i.indexOf(t)}visibleColumnFromColumn(t,e){return CursorColumns.visibleColumnFromColumn(t.getLineContent(e.lineNumber),e.column,this.tabSize)}columnFromVisibleColumn(t,e,i){const o=CursorColumns.columnFromVisibleColumn(t.getLineContent(e),i,this.tabSize),s=t.getLineMinColumn(e);if(o<s)return s;const n=t.getLineMaxColumn(e);return o>n?n:o}}export class CursorState{static fromModelState(t){return new PartialModelCursorState(t)}static fromViewState(t){return new PartialViewCursorState(t)}static fromModelSelection(t){const e=Selection.liftSelection(t),i=new SingleCursorState(Range.fromPositions(e.getSelectionStart()),0,0,e.getPosition(),0);return CursorState.fromModelState(i)}static fromModelSelections(t){const e=[];for(let i=0,o=t.length;i<o;i++)e[i]=this.fromModelSelection(t[i]);return e}constructor(t,e){this._cursorStateBrand=void 0,this.modelState=t,this.viewState=e}equals(t){return this.viewState.equals(t.viewState)&&this.modelState.equals(t.modelState)}}export class PartialModelCursorState{constructor(t){this.modelState=t,this.viewState=null}}export class PartialViewCursorState{constructor(t){this.modelState=null,this.viewState=t}}export class SingleCursorState{constructor(t,e,i,o,s){this.selectionStart=t,this.selectionStartKind=e,this.selectionStartLeftoverVisibleColumns=i,this.position=o,this.leftoverVisibleColumns=s,this._singleCursorStateBrand=void 0,this.selection=SingleCursorState._computeSelection(this.selectionStart,this.position)}equals(t){return this.selectionStartLeftoverVisibleColumns===t.selectionStartLeftoverVisibleColumns&&this.leftoverVisibleColumns===t.leftoverVisibleColumns&&this.selectionStartKind===t.selectionStartKind&&this.position.equals(t.position)&&this.selectionStart.equalsRange(t.selectionStart)}hasSelection(){return!this.selection.isEmpty()||!this.selectionStart.isEmpty()}move(t,e,i,o){return t?new SingleCursorState(this.selectionStart,this.selectionStartKind,this.selectionStartLeftoverVisibleColumns,new Position(e,i),o):new SingleCursorState(new Range(e,i,e,i),0,o,new Position(e,i),o)}static _computeSelection(t,e){return t.isEmpty()||!e.isBeforeOrEqual(t.getStartPosition())?Selection.fromPositions(t.getStartPosition(),e):Selection.fromPositions(t.getEndPosition(),e)}}export class EditOperationResult{constructor(t,e,i){this._editOperationResultBrand=void 0,this.type=t,this.commands=e,this.shouldPushStackElementBefore=i.shouldPushStackElementBefore,this.shouldPushStackElementAfter=i.shouldPushStackElementAfter}}export function isQuote(t){return"'"===t||'"'===t||"`"===t}