var __decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,a=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,i);else for(var d=e.length-1;d>=0;d--)(r=e[d])&&(a=(n<3?r(a):n>3?r(t,o,a):r(t,o))||a);return n>3&&a&&Object.defineProperty(t,o,a),a},__param=this&&this.__param||function(e,t){return function(o,i){t(o,i,e)}};import*as aria from"../../../base/browser/ui/aria/aria.js";import{Disposable,toDisposable,DisposableStore}from"../../../base/common/lifecycle.js";import{ICodeEditorService}from"../../browser/services/codeEditorService.js";import{CodeEditorWidget}from"../../browser/widget/codeEditorWidget.js";import{DiffEditorWidget}from"../../browser/widget/diffEditorWidget.js";import{InternalEditorAction}from"../../common/editorAction.js";import{StandaloneKeybindingService,updateConfigurationService}from"./standaloneServices.js";import{IStandaloneThemeService}from"../common/standaloneTheme.js";import{MenuId,MenuRegistry}from"../../../platform/actions/common/actions.js";import{CommandsRegistry,ICommandService}from"../../../platform/commands/common/commands.js";import{IConfigurationService}from"../../../platform/configuration/common/configuration.js";import{ContextKeyExpr,IContextKeyService}from"../../../platform/contextkey/common/contextkey.js";import{IContextMenuService}from"../../../platform/contextview/browser/contextView.js";import{IInstantiationService}from"../../../platform/instantiation/common/instantiation.js";import{IKeybindingService}from"../../../platform/keybinding/common/keybinding.js";import{INotificationService}from"../../../platform/notification/common/notification.js";import{IThemeService}from"../../../platform/theme/common/themeService.js";import{IAccessibilityService}from"../../../platform/accessibility/common/accessibility.js";import{StandaloneCodeEditorNLS}from"../../common/standaloneStrings.js";import{IClipboardService}from"../../../platform/clipboard/common/clipboardService.js";import{IEditorProgressService}from"../../../platform/progress/common/progress.js";import{IModelService}from"../../common/services/model.js";import{ILanguageService}from"../../common/languages/language.js";import{StandaloneCodeEditorService}from"./standaloneCodeEditorService.js";import{PLAINTEXT_LANGUAGE_ID}from"../../common/languages/modesRegistry.js";import{ILanguageConfigurationService}from"../../common/languages/languageConfigurationRegistry.js";import{ILanguageFeaturesService}from"../../common/services/languageFeatures.js";let LAST_GENERATED_COMMAND_ID=0,ariaDomNodeCreated=!1;function createAriaDomNode(e){if(!e){if(ariaDomNodeCreated)return;ariaDomNodeCreated=!0}aria.setARIAContainer(e||document.body)}let StandaloneCodeEditor=class extends CodeEditorWidget{constructor(e,t,o,i,r,n,a,d,s,c,m,l){const p=Object.assign({},t);p.ariaLabel=p.ariaLabel||StandaloneCodeEditorNLS.editorViewAccessibleLabel,p.ariaLabel=p.ariaLabel+";"+StandaloneCodeEditorNLS.accessibilityHelpMessage,super(e,p,{},o,i,r,n,d,s,c,m,l),this._standaloneKeybindingService=a instanceof StandaloneKeybindingService?a:null,createAriaDomNode(p.ariaContainerElement)}addCommand(e,t,o){if(!this._standaloneKeybindingService)return console.warn("Cannot add command because the editor is configured with an unrecognized KeybindingService"),null;const i="DYNAMIC_"+ ++LAST_GENERATED_COMMAND_ID,r=ContextKeyExpr.deserialize(o);return this._standaloneKeybindingService.addDynamicKeybinding(i,e,t,r),i}createContextKey(e,t){return this._contextKeyService.createKey(e,t)}addAction(e){if("string"!=typeof e.id||"string"!=typeof e.label||"function"!=typeof e.run)throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");if(!this._standaloneKeybindingService)return console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),Disposable.None;const t=e.id,o=e.label,i=ContextKeyExpr.and(ContextKeyExpr.equals("editorId",this.getId()),ContextKeyExpr.deserialize(e.precondition)),r=e.keybindings,n=ContextKeyExpr.and(i,ContextKeyExpr.deserialize(e.keybindingContext)),a=e.contextMenuGroupId||null,d=e.contextMenuOrder||0,s=(t,...o)=>Promise.resolve(e.run(this,...o)),c=new DisposableStore,m=this.getId()+":"+t;if(c.add(CommandsRegistry.registerCommand(m,s)),a){const e={command:{id:m,title:o},when:i,group:a,order:d};c.add(MenuRegistry.appendMenuItem(MenuId.EditorContext,e))}if(Array.isArray(r))for(const e of r)c.add(this._standaloneKeybindingService.addDynamicKeybinding(m,e,s,n));const l=new InternalEditorAction(m,o,o,i,s,this._contextKeyService);return this._actions.set(t,l),c.add(toDisposable((()=>{this._actions.delete(t)}))),c}_triggerCommand(e,t){if(this._codeEditorService instanceof StandaloneCodeEditorService)try{this._codeEditorService.setActiveCodeEditor(this),super._triggerCommand(e,t)}finally{this._codeEditorService.setActiveCodeEditor(null)}else super._triggerCommand(e,t)}};StandaloneCodeEditor=__decorate([__param(2,IInstantiationService),__param(3,ICodeEditorService),__param(4,ICommandService),__param(5,IContextKeyService),__param(6,IKeybindingService),__param(7,IThemeService),__param(8,INotificationService),__param(9,IAccessibilityService),__param(10,ILanguageConfigurationService),__param(11,ILanguageFeaturesService)],StandaloneCodeEditor);export{StandaloneCodeEditor};let StandaloneEditor=class extends StandaloneCodeEditor{constructor(e,t,o,i,r,n,a,d,s,c,m,l,p,g,u){const f=Object.assign({},t);updateConfigurationService(c,f,!1);const _=d.registerEditorContainer(e);"string"==typeof f.theme&&d.setTheme(f.theme),void 0!==f.autoDetectHighContrast&&d.setAutoDetectHighContrast(Boolean(f.autoDetectHighContrast));const S=f.model;let v;if(delete f.model,super(e,f,o,i,r,n,a,d,s,m,g,u),this._configurationService=c,this._standaloneThemeService=d,this._register(_),void 0===S){const e=p.getLanguageIdByMimeType(f.language)||f.language||PLAINTEXT_LANGUAGE_ID;v=createTextModel(l,p,f.value||"",e,void 0),this._ownsModel=!0}else v=S,this._ownsModel=!1;if(this._attachModel(v),v){const e={oldModelUrl:null,newModelUrl:v.uri};this._onDidChangeModel.fire(e)}}dispose(){super.dispose()}updateOptions(e){updateConfigurationService(this._configurationService,e,!1),"string"==typeof e.theme&&this._standaloneThemeService.setTheme(e.theme),void 0!==e.autoDetectHighContrast&&this._standaloneThemeService.setAutoDetectHighContrast(Boolean(e.autoDetectHighContrast)),super.updateOptions(e)}_postDetachModelCleanup(e){super._postDetachModelCleanup(e),e&&this._ownsModel&&(e.dispose(),this._ownsModel=!1)}};StandaloneEditor=__decorate([__param(2,IInstantiationService),__param(3,ICodeEditorService),__param(4,ICommandService),__param(5,IContextKeyService),__param(6,IKeybindingService),__param(7,IStandaloneThemeService),__param(8,INotificationService),__param(9,IConfigurationService),__param(10,IAccessibilityService),__param(11,IModelService),__param(12,ILanguageService),__param(13,ILanguageConfigurationService),__param(14,ILanguageFeaturesService)],StandaloneEditor);export{StandaloneEditor};let StandaloneDiffEditor=class extends DiffEditorWidget{constructor(e,t,o,i,r,n,a,d,s,c,m){const l=Object.assign({},t);updateConfigurationService(d,l,!0);const p=n.registerEditorContainer(e);"string"==typeof l.theme&&n.setTheme(l.theme),void 0!==l.autoDetectHighContrast&&n.setAutoDetectHighContrast(Boolean(l.autoDetectHighContrast)),super(e,l,{},m,i,o,r,n,a,s,c),this._configurationService=d,this._standaloneThemeService=n,this._register(p)}dispose(){super.dispose()}updateOptions(e){updateConfigurationService(this._configurationService,e,!0),"string"==typeof e.theme&&this._standaloneThemeService.setTheme(e.theme),void 0!==e.autoDetectHighContrast&&this._standaloneThemeService.setAutoDetectHighContrast(Boolean(e.autoDetectHighContrast)),super.updateOptions(e)}_createInnerEditor(e,t,o){return e.createInstance(StandaloneCodeEditor,t,o)}getOriginalEditor(){return super.getOriginalEditor()}getModifiedEditor(){return super.getModifiedEditor()}addCommand(e,t,o){return this.getModifiedEditor().addCommand(e,t,o)}createContextKey(e,t){return this.getModifiedEditor().createContextKey(e,t)}addAction(e){return this.getModifiedEditor().addAction(e)}};StandaloneDiffEditor=__decorate([__param(2,IInstantiationService),__param(3,IContextKeyService),__param(4,ICodeEditorService),__param(5,IStandaloneThemeService),__param(6,INotificationService),__param(7,IConfigurationService),__param(8,IContextMenuService),__param(9,IEditorProgressService),__param(10,IClipboardService)],StandaloneDiffEditor);export{StandaloneDiffEditor};export function createTextModel(e,t,o,i,r){if(o=o||"",!i){const i=o.indexOf("\n");let n=o;return-1!==i&&(n=o.substring(0,i)),doCreateModel(e,o,t.createByFilepathOrFirstLine(r||null,n),r)}return doCreateModel(e,o,t.createById(i),r)}function doCreateModel(e,t,o,i){return e.createModel(t,o,i)}