var __decorate=this&&this.__decorate||function(e,o,r,i){var t,n=arguments.length,s=n<3?o:null===i?i=Object.getOwnPropertyDescriptor(o,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,o,r,i);else for(var a=e.length-1;a>=0;a--)(t=e[a])&&(s=(n<3?t(s):n>3?t(o,r,s):t(o,r))||s);return n>3&&s&&Object.defineProperty(o,r,s),s},__param=this&&this.__param||function(e,o){return function(r,i){o(r,i,e)}},__awaiter=this&&this.__awaiter||function(e,o,r,i){return new(r||(r=Promise))((function(t,n){function s(e){try{c(i.next(e))}catch(e){n(e)}}function a(e){try{c(i.throw(e))}catch(e){n(e)}}function c(e){var o;e.done?t(e.value):(o=e.value,o instanceof r?o:new r((function(e){e(o)}))).then(s,a)}c((i=i.apply(e,o||[])).next())}))};import"../../common/languages/languageConfigurationRegistry.js";import"./standaloneCodeEditorService.js";import"./standaloneLayoutService.js";import"../../../platform/undoRedo/common/undoRedoService.js";import"../../common/services/languageFeatureDebounce.js";import*as strings from"../../../base/common/strings.js";import*as dom from"../../../base/browser/dom.js";import{StandardKeyboardEvent}from"../../../base/browser/keyboardEvent.js";import{Emitter}from"../../../base/common/event.js";import{KeyCodeChord,decodeKeybinding}from"../../../base/common/keybindings.js";import{ImmortalReference,toDisposable,DisposableStore,Disposable,combinedDisposable}from"../../../base/common/lifecycle.js";import{OS,isLinux,isMacintosh}from"../../../base/common/platform.js";import Severity from"../../../base/common/severity.js";import{URI}from"../../../base/common/uri.js";import{IBulkEditService,ResourceEdit,ResourceTextEdit}from"../../browser/services/bulkEditService.js";import{isDiffEditorConfigurationKey,isEditorConfigurationKey}from"../../common/config/editorConfigurationSchema.js";import{EditOperation}from"../../common/core/editOperation.js";import{Position as Pos}from"../../common/core/position.js";import{Range}from"../../common/core/range.js";import{IModelService}from"../../common/services/model.js";import{ITextModelService}from"../../common/services/resolverService.js";import{ITextResourceConfigurationService,ITextResourcePropertiesService}from"../../common/services/textResourceConfiguration.js";import{CommandsRegistry,ICommandService}from"../../../platform/commands/common/commands.js";import{IConfigurationService}from"../../../platform/configuration/common/configuration.js";import{Configuration,ConfigurationModel,ConfigurationChangeEvent}from"../../../platform/configuration/common/configurationModels.js";import{IContextKeyService}from"../../../platform/contextkey/common/contextkey.js";import{IDialogService}from"../../../platform/dialogs/common/dialogs.js";import{createDecorator,IInstantiationService}from"../../../platform/instantiation/common/instantiation.js";import{AbstractKeybindingService}from"../../../platform/keybinding/common/abstractKeybindingService.js";import{IKeybindingService}from"../../../platform/keybinding/common/keybinding.js";import{KeybindingResolver}from"../../../platform/keybinding/common/keybindingResolver.js";import{KeybindingsRegistry}from"../../../platform/keybinding/common/keybindingsRegistry.js";import{ResolvedKeybindingItem}from"../../../platform/keybinding/common/resolvedKeybindingItem.js";import{USLayoutResolvedKeybinding}from"../../../platform/keybinding/common/usLayoutResolvedKeybinding.js";import{ILabelService}from"../../../platform/label/common/label.js";import{INotificationService,NoOpNotification}from"../../../platform/notification/common/notification.js";import{IEditorProgressService,IProgressService}from"../../../platform/progress/common/progress.js";import{ITelemetryService}from"../../../platform/telemetry/common/telemetry.js";import{IWorkspaceContextService,WorkspaceFolder}from"../../../platform/workspace/common/workspace.js";import{ILayoutService}from"../../../platform/layout/browser/layoutService.js";import{StandaloneServicesNLS}from"../../common/standaloneStrings.js";import{basename}from"../../../base/common/resources.js";import{ICodeEditorService}from"../../browser/services/codeEditorService.js";import{ConsoleLogger,ILogService}from"../../../platform/log/common/log.js";import{IWorkspaceTrustManagementService}from"../../../platform/workspace/common/workspaceTrust.js";import{IContextMenuService,IContextViewService}from"../../../platform/contextview/browser/contextView.js";import{ContextViewService}from"../../../platform/contextview/browser/contextViewService.js";import{LanguageService}from"../../common/services/languageService.js";import{ContextMenuService}from"../../../platform/contextview/browser/contextMenuService.js";import{getSingletonServiceDescriptors,registerSingleton}from"../../../platform/instantiation/common/extensions.js";import{OpenerService}from"../../browser/services/openerService.js";import{IEditorWorkerService}from"../../common/services/editorWorker.js";import{EditorWorkerService}from"../../browser/services/editorWorkerService.js";import{ILanguageService}from"../../common/languages/language.js";import{MarkerDecorationsService}from"../../common/services/markerDecorationsService.js";import{IMarkerDecorationsService}from"../../common/services/markerDecorations.js";import{ModelService}from"../../common/services/modelService.js";import{StandaloneQuickInputService}from"./quickInput/standaloneQuickInputService.js";import{StandaloneThemeService}from"./standaloneThemeService.js";import{IStandaloneThemeService}from"../common/standaloneTheme.js";import{AccessibilityService}from"../../../platform/accessibility/browser/accessibilityService.js";import{IAccessibilityService}from"../../../platform/accessibility/common/accessibility.js";import{IMenuService}from"../../../platform/actions/common/actions.js";import{MenuService}from"../../../platform/actions/common/menuService.js";import{BrowserClipboardService}from"../../../platform/clipboard/browser/clipboardService.js";import{IClipboardService}from"../../../platform/clipboard/common/clipboardService.js";import{ContextKeyService}from"../../../platform/contextkey/browser/contextKeyService.js";import{SyncDescriptor}from"../../../platform/instantiation/common/descriptors.js";import{InstantiationService}from"../../../platform/instantiation/common/instantiationService.js";import{ServiceCollection}from"../../../platform/instantiation/common/serviceCollection.js";import{IListService,ListService}from"../../../platform/list/browser/listService.js";import{IMarkerService}from"../../../platform/markers/common/markers.js";import{MarkerService}from"../../../platform/markers/common/markerService.js";import{IOpenerService}from"../../../platform/opener/common/opener.js";import{IQuickInputService}from"../../../platform/quickinput/common/quickInput.js";import{IStorageService,InMemoryStorageService}from"../../../platform/storage/common/storage.js";import"../../common/services/languageFeaturesService.js";import{DefaultConfiguration}from"../../../platform/configuration/common/configurations.js";import{IAudioCueService}from"../../../platform/audioCues/browser/audioCueService.js";import{LogService}from"../../../platform/log/common/logService.js";class SimpleModel{constructor(e){this.disposed=!1,this.model=e,this._onWillDispose=new Emitter}get textEditorModel(){return this.model}dispose(){this.disposed=!0,this._onWillDispose.fire()}}let StandaloneTextModelService=class{constructor(e){this.modelService=e}createModelReference(e){const o=this.modelService.getModel(e);return o?Promise.resolve(new ImmortalReference(new SimpleModel(o))):Promise.reject(new Error("Model not found"))}};StandaloneTextModelService=__decorate([__param(0,IModelService)],StandaloneTextModelService);class StandaloneEditorProgressService{show(){return StandaloneEditorProgressService.NULL_PROGRESS_RUNNER}showWhile(e,o){return __awaiter(this,void 0,void 0,(function*(){yield e}))}}StandaloneEditorProgressService.NULL_PROGRESS_RUNNER={done:()=>{},total:()=>{},worked:()=>{}};class StandaloneProgressService{withProgress(e,o,r){return o({report:()=>{}})}}class StandaloneDialogService{confirm(e){return this.doConfirm(e).then((e=>({confirmed:e,checkboxChecked:!1})))}doConfirm(e){let o=e.message;return e.detail&&(o=o+"\n\n"+e.detail),Promise.resolve(window.confirm(o))}show(e,o,r,i){return Promise.resolve({choice:0})}}class StandaloneNotificationService{info(e){return this.notify({severity:Severity.Info,message:e})}warn(e){return this.notify({severity:Severity.Warning,message:e})}error(e){return this.notify({severity:Severity.Error,message:e})}notify(e){switch(e.severity){case Severity.Error:console.error(e.message);break;case Severity.Warning:console.warn(e.message);break;default:console.log(e.message)}return StandaloneNotificationService.NO_OP}prompt(e,o,r,i){return StandaloneNotificationService.NO_OP}status(e,o){return Disposable.None}}StandaloneNotificationService.NO_OP=new NoOpNotification;export{StandaloneNotificationService};let StandaloneCommandService=class{constructor(e){this._onWillExecuteCommand=new Emitter,this._onDidExecuteCommand=new Emitter,this.onDidExecuteCommand=this._onDidExecuteCommand.event,this._instantiationService=e}executeCommand(e,...o){const r=CommandsRegistry.getCommand(e);if(!r)return Promise.reject(new Error(`command '${e}' not found`));try{this._onWillExecuteCommand.fire({commandId:e,args:o});const i=this._instantiationService.invokeFunction.apply(this._instantiationService,[r.handler,...o]);return this._onDidExecuteCommand.fire({commandId:e,args:o}),Promise.resolve(i)}catch(e){return Promise.reject(e)}}};StandaloneCommandService=__decorate([__param(0,IInstantiationService)],StandaloneCommandService);export{StandaloneCommandService};let StandaloneKeybindingService=class extends AbstractKeybindingService{constructor(e,o,r,i,t,n){super(e,o,r,i,t),this._cachedResolver=null,this._dynamicKeybindings=[],this._domNodeListeners=[];const s=e=>{const o=new DisposableStore;o.add(dom.addDisposableListener(e,dom.EventType.KEY_DOWN,(e=>{const o=new StandardKeyboardEvent(e);this._dispatch(o,o.target)&&(o.preventDefault(),o.stopPropagation())}))),o.add(dom.addDisposableListener(e,dom.EventType.KEY_UP,(e=>{const o=new StandardKeyboardEvent(e);this._singleModifierDispatch(o,o.target)&&o.preventDefault()}))),this._domNodeListeners.push(new DomNodeListeners(e,o))},a=e=>{for(let o=0;o<this._domNodeListeners.length;o++){const r=this._domNodeListeners[o];r.domNode===e&&(this._domNodeListeners.splice(o,1),r.dispose())}},c=e=>{e.getOption(58)||s(e.getContainerDomNode())};this._register(n.onCodeEditorAdd(c)),this._register(n.onCodeEditorRemove((e=>{e.getOption(58)||a(e.getContainerDomNode())}))),n.listCodeEditors().forEach(c);const m=e=>{s(e.getContainerDomNode())};this._register(n.onDiffEditorAdd(m)),this._register(n.onDiffEditorRemove((e=>{a(e.getContainerDomNode())}))),n.listDiffEditors().forEach(m)}addDynamicKeybinding(e,o,r,i){return combinedDisposable(CommandsRegistry.registerCommand(e,r),this.addDynamicKeybindings([{keybinding:o,command:e,when:i}]))}addDynamicKeybindings(e){const o=e.map((e=>{var o;return{keybinding:decodeKeybinding(e.keybinding,OS),command:null!==(o=e.command)&&void 0!==o?o:null,commandArgs:e.commandArgs,when:e.when,weight1:1e3,weight2:0,extensionId:null,isBuiltinExtension:!1}}));return this._dynamicKeybindings=this._dynamicKeybindings.concat(o),this.updateResolver(),toDisposable((()=>{for(let e=0;e<this._dynamicKeybindings.length;e++)if(this._dynamicKeybindings[e]===o[0])return this._dynamicKeybindings.splice(e,o.length),void this.updateResolver()}))}updateResolver(){this._cachedResolver=null,this._onDidUpdateKeybindings.fire()}_getResolver(){if(!this._cachedResolver){const e=this._toNormalizedKeybindingItems(KeybindingsRegistry.getDefaultKeybindings(),!0),o=this._toNormalizedKeybindingItems(this._dynamicKeybindings,!1);this._cachedResolver=new KeybindingResolver(e,o,(e=>this._log(e)))}return this._cachedResolver}_documentHasFocus(){return document.hasFocus()}_toNormalizedKeybindingItems(e,o){const r=[];let i=0;for(const t of e){const e=t.when||void 0,n=t.keybinding;if(n){const s=USLayoutResolvedKeybinding.resolveKeybinding(n,OS);for(const n of s)r[i++]=new ResolvedKeybindingItem(n,t.command,t.commandArgs,e,o,null,!1)}else r[i++]=new ResolvedKeybindingItem(void 0,t.command,t.commandArgs,e,o,null,!1)}return r}resolveKeyboardEvent(e){const o=new KeyCodeChord(e.ctrlKey,e.shiftKey,e.altKey,e.metaKey,e.keyCode);return new USLayoutResolvedKeybinding([o],OS)}};StandaloneKeybindingService=__decorate([__param(0,IContextKeyService),__param(1,ICommandService),__param(2,ITelemetryService),__param(3,INotificationService),__param(4,ILogService),__param(5,ICodeEditorService)],StandaloneKeybindingService);export{StandaloneKeybindingService};class DomNodeListeners extends Disposable{constructor(e,o){super(),this.domNode=e,this._register(o)}}function isConfigurationOverrides(e){return e&&"object"==typeof e&&(!e.overrideIdentifier||"string"==typeof e.overrideIdentifier)&&(!e.resource||e.resource instanceof URI)}export class StandaloneConfigurationService{constructor(){this._onDidChangeConfiguration=new Emitter,this.onDidChangeConfiguration=this._onDidChangeConfiguration.event;const e=new DefaultConfiguration;this._configuration=new Configuration(e.reload(),new ConfigurationModel,new ConfigurationModel,new ConfigurationModel),e.dispose()}getValue(e,o){const r="string"==typeof e?e:void 0,i=isConfigurationOverrides(e)?e:isConfigurationOverrides(o)?o:{};return this._configuration.getValue(r,i,void 0)}updateValues(e){const o={data:this._configuration.toData()},r=[];for(const o of e){const[e,i]=o;this.getValue(e)!==i&&(this._configuration.updateValue(e,i),r.push(e))}if(r.length>0){const e=new ConfigurationChangeEvent({keys:r,overrides:[]},o,this._configuration);e.source=8,e.sourceConfig=null,this._onDidChangeConfiguration.fire(e)}return Promise.resolve()}updateValue(e,o,r,i){return this.updateValues([[e,o]])}inspect(e,o={}){return this._configuration.inspect(e,o,void 0)}}let StandaloneResourceConfigurationService=class{constructor(e,o,r){this.configurationService=e,this.modelService=o,this.languageService=r,this._onDidChangeConfiguration=new Emitter,this.configurationService.onDidChangeConfiguration((e=>{this._onDidChangeConfiguration.fire({affectedKeys:e.affectedKeys,affectsConfiguration:(o,r)=>e.affectsConfiguration(r)})}))}getValue(e,o,r){const i=Pos.isIPosition(o)?o:null,t=i?"string"==typeof r?r:void 0:"string"==typeof o?o:void 0,n=e?this.getLanguage(e,i):void 0;return void 0===t?this.configurationService.getValue({resource:e,overrideIdentifier:n}):this.configurationService.getValue(t,{resource:e,overrideIdentifier:n})}getLanguage(e,o){const r=this.modelService.getModel(e);return r?o?r.getLanguageIdAtPosition(o.lineNumber,o.column):r.getLanguageId():this.languageService.guessLanguageIdByFilepathOrFirstLine(e)}};StandaloneResourceConfigurationService=__decorate([__param(0,IConfigurationService),__param(1,IModelService),__param(2,ILanguageService)],StandaloneResourceConfigurationService);let StandaloneResourcePropertiesService=class{constructor(e){this.configurationService=e}getEOL(e,o){const r=this.configurationService.getValue("files.eol",{overrideIdentifier:o,resource:e});return r&&"string"==typeof r&&"auto"!==r?r:isLinux||isMacintosh?"\n":"\r\n"}};StandaloneResourcePropertiesService=__decorate([__param(0,IConfigurationService)],StandaloneResourcePropertiesService);class StandaloneTelemetryService{publicLog(e,o){return Promise.resolve(void 0)}publicLog2(e,o){return this.publicLog(e,o)}}class StandaloneWorkspaceContextService{constructor(){const e=URI.from({scheme:StandaloneWorkspaceContextService.SCHEME,authority:"model",path:"/"});this.workspace={id:"4064f6ec-cb38-4ad0-af64-ee6467e63c82",folders:[new WorkspaceFolder({uri:e,name:"",index:0})]}}getWorkspace(){return this.workspace}getWorkspaceFolder(e){return e&&e.scheme===StandaloneWorkspaceContextService.SCHEME?this.workspace.folders[0]:null}}StandaloneWorkspaceContextService.SCHEME="inmemory";export function updateConfigurationService(e,o,r){if(!o)return;if(!(e instanceof StandaloneConfigurationService))return;const i=[];Object.keys(o).forEach((e=>{isEditorConfigurationKey(e)&&i.push([`editor.${e}`,o[e]]),r&&isDiffEditorConfigurationKey(e)&&i.push([`diffEditor.${e}`,o[e]])})),i.length>0&&e.updateValues(i)}let StandaloneBulkEditService=class{constructor(e){this._modelService=e}hasPreviewHandler(){return!1}apply(e,o){return __awaiter(this,void 0,void 0,(function*(){const o=Array.isArray(e)?e:ResourceEdit.convert(e),r=new Map;for(const e of o){if(!(e instanceof ResourceTextEdit))throw new Error("bad edit - only text edits are supported");const o=this._modelService.getModel(e.resource);if(!o)throw new Error("bad edit - model not found");if("number"==typeof e.versionId&&o.getVersionId()!==e.versionId)throw new Error("bad state - model changed in the meantime");let i=r.get(o);i||(i=[],r.set(o,i)),i.push(EditOperation.replaceMove(Range.lift(e.textEdit.range),e.textEdit.text))}let i=0,t=0;for(const[e,o]of r)e.pushStackElement(),e.pushEditOperations([],o,(()=>[])),e.pushStackElement(),t+=1,i+=o.length;return{ariaSummary:strings.format(StandaloneServicesNLS.bulkEditServiceSummary,i,t),isApplied:i>0}}))}};StandaloneBulkEditService=__decorate([__param(0,IModelService)],StandaloneBulkEditService);class StandaloneUriLabelService{getUriLabel(e,o){return"file"===e.scheme?e.fsPath:e.path}getUriBasenameLabel(e){return basename(e)}}let StandaloneContextViewService=class extends ContextViewService{constructor(e,o){super(e),this._codeEditorService=o}showContextView(e,o,r){if(!o){const e=this._codeEditorService.getFocusedCodeEditor()||this._codeEditorService.getActiveCodeEditor();e&&(o=e.getContainerDomNode())}return super.showContextView(e,o,r)}};StandaloneContextViewService=__decorate([__param(0,ILayoutService),__param(1,ICodeEditorService)],StandaloneContextViewService);class StandaloneWorkspaceTrustManagementService{constructor(){this._neverEmitter=new Emitter,this.onDidChangeTrust=this._neverEmitter.event}isWorkspaceTrusted(){return!0}}class StandaloneLanguageService extends LanguageService{constructor(){super()}}class StandaloneLogService extends LogService{constructor(){super(new ConsoleLogger)}}let StandaloneContextMenuService=class extends ContextMenuService{constructor(e,o,r,i,t,n){super(e,o,r,i,t,n),this.configure({blockMouse:!1})}};StandaloneContextMenuService=__decorate([__param(0,ITelemetryService),__param(1,INotificationService),__param(2,IContextViewService),__param(3,IKeybindingService),__param(4,IMenuService),__param(5,IContextKeyService)],StandaloneContextMenuService);class StandaloneAudioService{playAudioCue(e,o){return __awaiter(this,void 0,void 0,(function*(){}))}}registerSingleton(IConfigurationService,StandaloneConfigurationService,0),registerSingleton(ITextResourceConfigurationService,StandaloneResourceConfigurationService,0),registerSingleton(ITextResourcePropertiesService,StandaloneResourcePropertiesService,0),registerSingleton(IWorkspaceContextService,StandaloneWorkspaceContextService,0),registerSingleton(ILabelService,StandaloneUriLabelService,0),registerSingleton(ITelemetryService,StandaloneTelemetryService,0),registerSingleton(IDialogService,StandaloneDialogService,0),registerSingleton(INotificationService,StandaloneNotificationService,0),registerSingleton(IMarkerService,MarkerService,0),registerSingleton(ILanguageService,StandaloneLanguageService,0),registerSingleton(IStandaloneThemeService,StandaloneThemeService,0),registerSingleton(ILogService,StandaloneLogService,0),registerSingleton(IModelService,ModelService,0),registerSingleton(IMarkerDecorationsService,MarkerDecorationsService,0),registerSingleton(IContextKeyService,ContextKeyService,0),registerSingleton(IProgressService,StandaloneProgressService,0),registerSingleton(IEditorProgressService,StandaloneEditorProgressService,0),registerSingleton(IStorageService,InMemoryStorageService,0),registerSingleton(IEditorWorkerService,EditorWorkerService,0),registerSingleton(IBulkEditService,StandaloneBulkEditService,0),registerSingleton(IWorkspaceTrustManagementService,StandaloneWorkspaceTrustManagementService,0),registerSingleton(ITextModelService,StandaloneTextModelService,0),registerSingleton(IAccessibilityService,AccessibilityService,0),registerSingleton(IListService,ListService,0),registerSingleton(ICommandService,StandaloneCommandService,0),registerSingleton(IKeybindingService,StandaloneKeybindingService,0),registerSingleton(IQuickInputService,StandaloneQuickInputService,0),registerSingleton(IContextViewService,StandaloneContextViewService,0),registerSingleton(IOpenerService,OpenerService,0),registerSingleton(IClipboardService,BrowserClipboardService,0),registerSingleton(IContextMenuService,StandaloneContextMenuService,0),registerSingleton(IMenuService,MenuService,0),registerSingleton(IAudioCueService,StandaloneAudioService,0);export var StandaloneServices;!function(e){const o=new ServiceCollection;for(const[e,r]of getSingletonServiceDescriptors())o.set(e,r);const r=new InstantiationService(o,!0);o.set(IInstantiationService,r),e.get=function(e){const i=o.get(e);if(!i)throw new Error("Missing service "+e);return i instanceof SyncDescriptor?r.invokeFunction((o=>o.get(e))):i};let i=!1;e.initialize=function(e){if(i)return r;i=!0;for(const[e,r]of getSingletonServiceDescriptors())o.get(e)||o.set(e,r);for(const r in e)if(e.hasOwnProperty(r)){const i=createDecorator(r);o.get(i)instanceof SyncDescriptor&&o.set(i,e[r])}return r}}(StandaloneServices||(StandaloneServices={}));