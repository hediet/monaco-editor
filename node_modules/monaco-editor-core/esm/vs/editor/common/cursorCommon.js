import{Position}from"./core/position.js";import{Range}from"./core/range.js";import{Selection}from"./core/selection.js";import{createScopedLineTokens}from"./languages/supports.js";import{CursorColumns}from"./core/cursorColumns.js";import{normalizeIndentation}from"./core/indentation.js";const autoCloseAlways=()=>!0,autoCloseNever=()=>!1,autoCloseBeforeWhitespace=t=>" "===t||"\t"===t;export class CursorConfiguration{static shouldRecreate(t){return t.hasChanged(133)||t.hasChanged(119)||t.hasChanged(33)||t.hasChanged(70)||t.hasChanged(72)||t.hasChanged(5)||t.hasChanged(8)||t.hasChanged(6)||t.hasChanged(7)||t.hasChanged(11)||t.hasChanged(118)||t.hasChanged(60)||t.hasChanged(82)}constructor(t,e,o,i){this.languageConfigurationService=i,this._cursorMoveConfigurationBrand=void 0,this._languageId=t;const s=o.options,n=s.get(133);this.readOnly=s.get(82),this.tabSize=e.tabSize,this.indentSize=e.indentSize,this.insertSpaces=e.insertSpaces,this.stickyTabStops=s.get(106),this.lineHeight=s.get(60),this.pageSize=Math.max(1,Math.floor(n.height/this.lineHeight)-2),this.useTabStops=s.get(118),this.wordSeparators=s.get(119),this.emptySelectionClipboard=s.get(33),this.copyWithSyntaxHighlighting=s.get(21),this.multiCursorMergeOverlapping=s.get(70),this.multiCursorPaste=s.get(72),this.autoClosingBrackets=s.get(5),this.autoClosingQuotes=s.get(8),this.autoClosingDelete=s.get(6),this.autoClosingOvertype=s.get(7),this.autoSurround=s.get(11),this.autoIndent=s.get(9),this.surroundingPairs={},this._electricChars=null,this.shouldAutoCloseBefore={quote:this._getShouldAutoClose(t,this.autoClosingQuotes),bracket:this._getShouldAutoClose(t,this.autoClosingBrackets)},this.autoClosingPairs=this.languageConfigurationService.getLanguageConfiguration(t).getAutoClosingPairs();const r=this.languageConfigurationService.getLanguageConfiguration(t).getSurroundingPairs();if(r)for(const t of r)this.surroundingPairs[t.open]=t.close}get electricChars(){var t;if(!this._electricChars){this._electricChars={};const e=null===(t=this.languageConfigurationService.getLanguageConfiguration(this._languageId).electricCharacter)||void 0===t?void 0:t.getElectricCharacters();if(e)for(const t of e)this._electricChars[t]=!0}return this._electricChars}onElectricCharacter(t,e,o){const i=createScopedLineTokens(e,o-1),s=this.languageConfigurationService.getLanguageConfiguration(i.languageId).electricCharacter;return s?s.onElectricCharacter(t,i,o-i.firstCharOffset):null}normalizeIndentation(t){return normalizeIndentation(t,this.indentSize,this.insertSpaces)}_getShouldAutoClose(t,e){switch(e){case"beforeWhitespace":return autoCloseBeforeWhitespace;case"languageDefined":return this._getLanguageDefinedShouldAutoClose(t);case"always":return autoCloseAlways;case"never":return autoCloseNever}}_getLanguageDefinedShouldAutoClose(t){const e=this.languageConfigurationService.getLanguageConfiguration(t).getAutoCloseBeforeSet();return t=>-1!==e.indexOf(t)}visibleColumnFromColumn(t,e){return CursorColumns.visibleColumnFromColumn(t.getLineContent(e.lineNumber),e.column,this.tabSize)}columnFromVisibleColumn(t,e,o){const i=CursorColumns.columnFromVisibleColumn(t.getLineContent(e),o,this.tabSize),s=t.getLineMinColumn(e);if(i<s)return s;const n=t.getLineMaxColumn(e);return i>n?n:i}}export class CursorState{static fromModelState(t){return new PartialModelCursorState(t)}static fromViewState(t){return new PartialViewCursorState(t)}static fromModelSelection(t){const e=Selection.liftSelection(t),o=new SingleCursorState(Range.fromPositions(e.getSelectionStart()),0,e.getPosition(),0);return CursorState.fromModelState(o)}static fromModelSelections(t){const e=[];for(let o=0,i=t.length;o<i;o++)e[o]=this.fromModelSelection(t[o]);return e}constructor(t,e){this._cursorStateBrand=void 0,this.modelState=t,this.viewState=e}equals(t){return this.viewState.equals(t.viewState)&&this.modelState.equals(t.modelState)}}export class PartialModelCursorState{constructor(t){this.modelState=t,this.viewState=null}}export class PartialViewCursorState{constructor(t){this.modelState=null,this.viewState=t}}export class SingleCursorState{constructor(t,e,o,i){this._singleCursorStateBrand=void 0,this.selectionStart=t,this.selectionStartLeftoverVisibleColumns=e,this.position=o,this.leftoverVisibleColumns=i,this.selection=SingleCursorState._computeSelection(this.selectionStart,this.position)}equals(t){return this.selectionStartLeftoverVisibleColumns===t.selectionStartLeftoverVisibleColumns&&this.leftoverVisibleColumns===t.leftoverVisibleColumns&&this.position.equals(t.position)&&this.selectionStart.equalsRange(t.selectionStart)}hasSelection(){return!this.selection.isEmpty()||!this.selectionStart.isEmpty()}move(t,e,o,i){return t?new SingleCursorState(this.selectionStart,this.selectionStartLeftoverVisibleColumns,new Position(e,o),i):new SingleCursorState(new Range(e,o,e,o),i,new Position(e,o),i)}static _computeSelection(t,e){return t.isEmpty()||!e.isBeforeOrEqual(t.getStartPosition())?Selection.fromPositions(t.getStartPosition(),e):Selection.fromPositions(t.getEndPosition(),e)}}export class EditOperationResult{constructor(t,e,o){this._editOperationResultBrand=void 0,this.type=t,this.commands=e,this.shouldPushStackElementBefore=o.shouldPushStackElementBefore,this.shouldPushStackElementAfter=o.shouldPushStackElementAfter}}export function isQuote(t){return"'"===t||'"'===t||"`"===t}