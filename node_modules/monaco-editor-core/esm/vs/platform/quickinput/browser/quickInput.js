var __decorate=this&&this.__decorate||function(t,e,r,o){var i,n=arguments.length,c=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(n<3?i(c):n>3?i(e,r,c):i(e,r))||c);return n>3&&c&&Object.defineProperty(e,r,c),c},__param=this&&this.__param||function(t,e){return function(r,o){e(r,o,t)}};import{CancellationToken}from"../../../base/common/cancellation.js";import{Emitter}from"../../../base/common/event.js";import{QuickInputController}from"../../../base/parts/quickinput/browser/quickInput.js";import{IAccessibilityService}from"../../accessibility/common/accessibility.js";import{IContextKeyService,RawContextKey}from"../../contextkey/common/contextkey.js";import{IInstantiationService}from"../../instantiation/common/instantiation.js";import{ILayoutService}from"../../layout/browser/layoutService.js";import{WorkbenchList}from"../../list/browser/listService.js";import{QuickAccessController}from"./quickAccess.js";import{activeContrastBorder,badgeBackground,badgeForeground,buttonBackground,buttonForeground,buttonHoverBackground,contrastBorder,inputBackground,inputBorder,inputForeground,inputValidationErrorBackground,inputValidationErrorBorder,inputValidationErrorForeground,inputValidationInfoBackground,inputValidationInfoBorder,inputValidationInfoForeground,inputValidationWarningBackground,inputValidationWarningBorder,inputValidationWarningForeground,keybindingLabelBackground,keybindingLabelBorder,keybindingLabelBottomBorder,keybindingLabelForeground,pickerGroupBorder,pickerGroupForeground,progressBarBackground,quickInputBackground,quickInputForeground,quickInputListFocusBackground,quickInputListFocusForeground,quickInputListFocusIconForeground,quickInputTitleBackground,widgetShadow}from"../../theme/common/colorRegistry.js";import{computeStyles}from"../../theme/common/styler.js";import{IThemeService,Themable}from"../../theme/common/themeService.js";let QuickInputService=class extends Themable{get controller(){return this._controller||(this._controller=this._register(this.createController())),this._controller}get hasController(){return!!this._controller}get quickAccess(){return this._quickAccess||(this._quickAccess=this._register(this.instantiationService.createInstance(QuickAccessController))),this._quickAccess}constructor(t,e,r,o,i){super(r),this.instantiationService=t,this.contextKeyService=e,this.accessibilityService=o,this.layoutService=i,this._onShow=this._register(new Emitter),this._onHide=this._register(new Emitter),this.contexts=new Map}createController(t=this.layoutService,e){const r={idPrefix:"quickInput_",container:t.container,ignoreFocusOut:()=>!1,isScreenReaderOptimized:()=>this.accessibilityService.isScreenReaderOptimized(),backKeybindingLabel:()=>{},setContextKey:t=>this.setContextKey(t),returnFocus:()=>t.focus(),createList:(t,e,r,o,i)=>this.instantiationService.createInstance(WorkbenchList,t,e,r,o,i),styles:this.computeStyles()},o=this._register(new QuickInputController(Object.assign(Object.assign({},r),e)));return o.layout(t.dimension,t.offset.quickPickTop),this._register(t.onDidLayout((e=>o.layout(e,t.offset.quickPickTop)))),this._register(o.onShow((()=>{this.resetContextKeys(),this._onShow.fire()}))),this._register(o.onHide((()=>{this.resetContextKeys(),this._onHide.fire()}))),o}setContextKey(t){let e;t&&(e=this.contexts.get(t),e||(e=new RawContextKey(t,!1).bindTo(this.contextKeyService),this.contexts.set(t,e))),e&&e.get()||(this.resetContextKeys(),null==e||e.set(!0))}resetContextKeys(){this.contexts.forEach((t=>{t.get()&&t.reset()}))}pick(t,e={},r=CancellationToken.None){return this.controller.pick(t,e,r)}createQuickPick(){return this.controller.createQuickPick()}updateStyles(){this.hasController&&this.controller.applyStyles(this.computeStyles())}computeStyles(){return{widget:Object.assign({},computeStyles(this.theme,{quickInputBackground,quickInputForeground,quickInputTitleBackground,contrastBorder,widgetShadow})),inputBox:computeStyles(this.theme,{inputForeground,inputBackground,inputBorder,inputValidationInfoBackground,inputValidationInfoForeground,inputValidationInfoBorder,inputValidationWarningBackground,inputValidationWarningForeground,inputValidationWarningBorder,inputValidationErrorBackground,inputValidationErrorForeground,inputValidationErrorBorder}),countBadge:computeStyles(this.theme,{badgeBackground,badgeForeground,badgeBorder:contrastBorder}),button:computeStyles(this.theme,{buttonForeground,buttonBackground,buttonHoverBackground,buttonBorder:contrastBorder}),progressBar:computeStyles(this.theme,{progressBarBackground}),keybindingLabel:computeStyles(this.theme,{keybindingLabelBackground,keybindingLabelForeground,keybindingLabelBorder,keybindingLabelBottomBorder,keybindingLabelShadow:widgetShadow}),list:computeStyles(this.theme,{listBackground:quickInputBackground,listInactiveFocusForeground:quickInputListFocusForeground,listInactiveSelectionIconForeground:quickInputListFocusIconForeground,listInactiveFocusBackground:quickInputListFocusBackground,listFocusOutline:activeContrastBorder,listInactiveFocusOutline:activeContrastBorder,pickerGroupBorder,pickerGroupForeground})}}};QuickInputService=__decorate([__param(0,IInstantiationService),__param(1,IContextKeyService),__param(2,IThemeService),__param(3,IAccessibilityService),__param(4,ILayoutService)],QuickInputService);export{QuickInputService};